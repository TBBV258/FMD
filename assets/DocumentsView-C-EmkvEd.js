import{a as q,r as m,c as g,l as A,p as B,w as b,o,h as e,j as v,b as r,e as u,k as x,t as c,s as w,n as C,F as D,i as M,u as J,O as G}from"./vue-vendor-DJ0JNZJp.js";import{u as H}from"./documents-B9k9duUr.js";import{u as K,a as Q,b as z,T as W,s as X}from"./index-CzWhD5j9.js";import{_ as Y}from"./MainLayout.vue_vue_type_script_setup_true_lang-B2JvWauE.js";import{_ as Z}from"./LoadingSkeleton.vue_vue_type_script_setup_true_lang-D4yD_4qG.js";import{_ as tt}from"./EmptyState.vue_vue_type_script_setup_true_lang-BgDaFSAo.js";import"./supabase-aQ0K3vAX.js";import"./logofmd-DeXnOIzE.js";const et={class:"px-4 py-6"},st={class:"flex items-center justify-between mb-6"},at={class:"card mb-6"},ot={class:"grid grid-cols-3 gap-4"},rt={class:"text-center"},lt={class:"text-2xl font-bold text-primary"},nt={class:"text-center"},it={class:"text-2xl font-bold text-danger"},ct={class:"text-center"},dt={class:"text-2xl font-bold text-success"},ut={class:"flex space-x-2 mb-4 overflow-x-auto"},ft=["onClick"],pt={key:0,class:"space-y-4"},mt={key:2,class:"space-y-3"},gt=["onClick"],bt={class:"w-16 h-16 rounded-lg bg-gray-200 dark:bg-gray-700 flex-shrink-0 overflow-hidden cursor-pointer"},vt=["src","alt"],xt={key:1,class:"w-full h-full flex items-center justify-center"},yt={class:"flex-1 min-w-0 cursor-pointer"},kt={class:"flex items-start justify-between mb-1"},_t={class:"font-semibold text-gray-900 dark:text-dark-text truncate"},ht={key:0,class:"text-sm text-gray-600 dark:text-gray-400 line-clamp-1 mb-2"},wt={class:"flex items-center text-xs text-gray-500 space-x-3"},Ct={key:0},Dt=["onClick"],$t={key:0,class:"absolute right-0 mt-2 w-56 bg-white dark:bg-dark-card rounded-lg shadow-lg border border-gray-200 dark:border-dark-border z-10"},St={class:"py-2"},jt=["onClick"],Bt=["onClick"],Mt=["onClick"],Rt=q({__name:"DocumentsView",setup(zt){const $=J(),n=H(),i=K(),{success:S,error:y}=Q(),p=m("all"),k=m(!1),_=m(!1),f=m(null),I=[{label:"Todos",value:"all"},{label:"Perdidos",value:"lost"},{label:"Submetido por utilizador",value:"found"},{label:"Matches",value:"matched"},{label:"Devolvidos",value:"returned"}],j=g(()=>p.value==="all"?n.documents:n.documents.filter(a=>a.status===p.value)),L=g(()=>n.documents.length),T=g(()=>n.documents.filter(a=>a.status==="lost").length),N=g(()=>n.documents.filter(a=>a.status==="found").length),U=a=>{const t="px-4 py-2 rounded-full text-sm font-medium transition-colors whitespace-nowrap";return a===p.value?`${t} bg-primary text-white`:`${t} bg-gray-100 dark:bg-dark-card text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-800`},O=a=>({lost:"badge badge-danger",found:"badge bg-orange-500 text-white",matched:"badge bg-purple-500/10 text-purple-500",returned:"badge badge-success",normal:"badge badge-primary"})[a]||"badge badge-primary",E=a=>({lost:"Perdido",found:"Submetido por utilizador",matched:"Match",returned:"Devolvido",normal:"Normal"})[a]||a,P=a=>({passport:"fas fa-passport",id_card:"fas fa-id-card",bi:"fas fa-id-card",driver_license:"fas fa-id-card",birth_certificate:"fas fa-file-alt",other:"fas fa-file"})[a]||"fas fa-file",R=a=>new Date(a).toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric"}),V=a=>{f.value=f.value===a?null:a},h=async(a,t)=>{f.value=null;const s={lost:"perdido",found:"encontrado",normal:"normal (privado)"};if(confirm(`Tem certeza que deseja marcar "${a.title}" como ${s[t]}?`))try{const l=t==="lost"||t==="found",{error:d}=await X.from("documents").update({status:t,is_public:l}).eq("id",a.id);if(d)throw d;S(`Documento marcado como ${s[t]}!`),i.userId&&await n.fetchUserDocuments(i.userId)}catch(l){y(l.message||"Erro ao atualizar status")}},F=async()=>{try{_.value=!0,i.userId&&await n.fetchUserDocuments(i.userId,!0);const a={user:{id:i.user?.id,email:i.user?.email,profile:i.profile},documents:n.documents,exportDate:new Date().toISOString(),version:"2.0.0"},t=JSON.stringify(a,null,2),s=new Blob([t],{type:"application/json"}),l=URL.createObjectURL(s),d=document.createElement("a");d.href=l,d.download=`findmydocs_backup_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(l),S("Backup baixado com sucesso!")}catch(a){console.error("Download backup error:",a),y("Erro ao baixar backup")}finally{_.value=!1}};return A(async()=>{if(!i.userId){y("Usuário não autenticado");return}k.value=!0,await n.fetchUserDocuments(i.userId,!0),k.value=!1}),(a,t)=>(o(),B(Y,null,{default:b(()=>[e("div",et,[e("div",st,[t[4]||(t[4]=e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-dark-text"},"Meus Documentos",-1)),v(z,{variant:"outline",size:"sm",onClick:F,loading:_.value},{default:b(()=>[...t[3]||(t[3]=[e("i",{class:"fas fa-download mr-2"},null,-1),x(" Backup ",-1)])]),_:1},8,["loading"])]),e("div",at,[e("div",ot,[e("div",rt,[e("p",lt,c(L.value),1),t[5]||(t[5]=e("p",{class:"text-xs text-gray-500"},"Total",-1))]),e("div",nt,[e("p",it,c(T.value),1),t[6]||(t[6]=e("p",{class:"text-xs text-gray-500"},"Perdidos",-1))]),e("div",ct,[e("p",dt,c(N.value),1),t[7]||(t[7]=e("p",{class:"text-xs text-gray-500"},"Submetido por utilizador",-1))])])]),e("div",ut,[(o(),r(D,null,w(I,s=>e("button",{key:s.value,class:C(U(s.value)),onClick:l=>p.value=s.value},c(s.label),11,ft)),64))]),k.value?(o(),r("div",pt,[(o(),r(D,null,w(3,s=>v(Z,{key:s,type:"card"})),64))])):j.value.length===0?(o(),B(tt,{key:1,icon:"fas fa-file-alt",title:"Nenhum documento encontrado",description:"Você ainda não cadastrou nenhum documento."},{default:b(()=>[v(z,{variant:"primary",onClick:t[0]||(t[0]=s=>M($).push("/report-lost"))},{default:b(()=>[...t[8]||(t[8]=[e("i",{class:"fas fa-plus mr-2"},null,-1),x(" Adicionar Documento ",-1)])]),_:1})]),_:1})):(o(),r("div",mt,[(o(!0),r(D,null,w(j.value,s=>(o(),r("div",{key:s.id,class:"card card-hover relative group"},[e("div",{class:"flex items-start space-x-3",onClick:l=>M($).push(`/document/${s.id}`)},[e("div",bt,[s.thumbnail_url||s.file_url?(o(),r("img",{key:0,src:s.thumbnail_url||s.file_url,alt:s.title,class:"w-full h-full object-cover"},null,8,vt)):(o(),r("div",xt,[e("i",{class:C([P(s.type),"text-gray-400 text-2xl"])},null,2)]))]),e("div",yt,[e("div",kt,[e("h3",_t,c(s.title),1),e("span",{class:C([O(s.status),"ml-2"])},c(E(s.status)),3)]),s.description?(o(),r("p",ht,c(s.description),1)):u("",!0),e("div",wt,[e("span",null,[t[9]||(t[9]=e("i",{class:"fas fa-calendar mr-1"},null,-1)),x(" "+c(R(s.created_at)),1)]),s.location?(o(),r("span",Ct,[t[10]||(t[10]=e("i",{class:"fas fa-map-marker-alt mr-1"},null,-1)),x(" "+c(s.location),1)])):u("",!0)])]),e("div",{class:"relative flex-shrink-0",onClick:t[1]||(t[1]=G(()=>{},["stop"]))},[e("button",{onClick:l=>V(s.id),class:"btn-icon opacity-0 group-hover:opacity-100 transition-opacity",title:"Opções"},[...t[11]||(t[11]=[e("i",{class:"fas fa-ellipsis-v"},null,-1)])],8,Dt),f.value===s.id?(o(),r("div",$t,[e("div",St,[s.status!=="lost"?(o(),r("button",{key:0,onClick:l=>h(s,"lost"),class:"w-full flex items-center space-x-3 px-4 py-2 text-sm text-left hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"},[...t[12]||(t[12]=[e("i",{class:"fas fa-exclamation-triangle text-danger w-5"},null,-1),e("span",null,"Marcar como Perdido",-1)])],8,jt)):u("",!0),s.status!=="found"?(o(),r("button",{key:1,onClick:l=>h(s,"found"),class:"w-full flex items-center space-x-3 px-4 py-2 text-sm text-left hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"},[...t[13]||(t[13]=[e("i",{class:"fas fa-check-circle text-success w-5"},null,-1),e("span",null,"Marcar como Encontrado",-1)])],8,Bt)):u("",!0),s.status!=="normal"?(o(),r("button",{key:2,onClick:l=>h(s,"normal"),class:"w-full flex items-center space-x-3 px-4 py-2 text-sm text-left hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"},[...t[14]||(t[14]=[e("i",{class:"fas fa-lock text-primary w-5"},null,-1),e("span",null,"Marcar como Normal (Privado)",-1)])],8,Mt)):u("",!0)])])):u("",!0)])],8,gt)]))),128))])),f.value?(o(),r("div",{key:3,class:"fixed inset-0 z-0",onClick:t[2]||(t[2]=s=>f.value=null)})):u("",!0)]),v(W)]),_:1}))}});export{Rt as default};
