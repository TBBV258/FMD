import{a as h,r as d,c as q,M as A,p as G,w as v,o as p,h as t,j as m,i as S,u as O,O as i,b as g,e as j,R as f,_ as R,S as k,n as J,t as y,k as w}from"./vue-vendor-DJ0JNZJp.js";import{u as K,b as E,T as L,s as D,a as H}from"./index-DomtK_OL.js";import{_ as Q}from"./MainLayout.vue_vue_type_script_setup_true_lang-s1TSJ6UG.js";import{_ as W}from"./PhotoPickerModal.vue_vue_type_script_setup_true_lang-DU88BwuB.js";import"./supabase-aQ0K3vAX.js";import"./logofmd-DeXnOIzE.js";import"./BaseModal-C7Axm7lT.js";const X={class:"max-w-2xl mx-auto px-4 py-6 space-y-6"},Y={class:"flex items-center justify-between mb-6"},Z={key:0},ee={key:1,class:"flex items-center justify-center space-x-3"},te={class:"text-left"},re={class:"font-medium text-gray-900 dark:text-dark-text"},ae={class:"text-xs text-gray-500"},oe={key:0,class:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg"},le={class:"text-sm text-red-600 dark:text-red-400"},se={class:"flex space-x-3"},be=h({__name:"SaveDocumentView",setup(de){const n=O(),c=K(),{success:P,error:T}=H(),C=d(null),o=d(null),u=d(!1),x=d(!1),l=d(""),b=d(!1),V=q(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)),s=A({type:"",title:"",document_number:"",description:""}),I=()=>{V.value?b.value=!0:C.value?.click()},$=r=>{const e=r.target;if(e.files&&e.files[0]){const a=e.files[0];if(a.size>10*1024*1024){l.value="Arquivo muito grande. Máximo 10MB.";return}o.value=a,l.value=""}},N=r=>{if(r.size>10*1024*1024){l.value="Arquivo muito grande. Máximo 10MB.";return}o.value=r,l.value=""},U=r=>{if(u.value=!1,r.dataTransfer?.files&&r.dataTransfer.files[0]){const e=r.dataTransfer.files[0];if(e.size>10*1024*1024){l.value="Arquivo muito grande. Máximo 10MB.";return}o.value=e,l.value=""}},z=r=>r<1024?r+" B":r<1024*1024?(r/1024).toFixed(1)+" KB":(r/(1024*1024)).toFixed(1)+" MB",F=async()=>{if(!o.value){l.value="Selecione um arquivo";return}if(!c.userId){n.push({name:"Login"});return}x.value=!0,l.value="";try{const r=o.value.name.split(".").pop(),e=`${c.userId}/${Date.now()}.${r}`,{data:a,error:M}=await D.storage.from("documents").upload(e,o.value,{cacheControl:"3600",upsert:!1});if(M)throw M;const{data:{publicUrl:_}}=D.storage.from("documents").getPublicUrl(a.path),{data:ie,error:B}=await D.from("documents").insert([{user_id:c.userId,title:s.title,type:s.type,status:"normal",is_public:!1,document_number:s.document_number||null,description:s.description||null,file_url:_,file_name:o.value.name,file_path:a.path,file_size:o.value.size,file_type:o.value.type}]).select().single();if(B)throw B;P("Documento guardado com sucesso!"),setTimeout(()=>{n.push("/documents")},1500)}catch(r){console.error("Error saving document:",r),l.value=r.message||"Erro ao guardar documento",T(l.value)}finally{x.value=!1}};return(r,e)=>(p(),G(Q,null,{default:v(()=>[t("div",X,[t("div",Y,[e[11]||(e[11]=t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-dark-text"}," Guardar Documento ",-1)),t("button",{onClick:e[0]||(e[0]=a=>S(n).back()),class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},[...e[10]||(e[10]=[t("i",{class:"fas fa-times text-xl"},null,-1)])])]),e[24]||(e[24]=t("div",{class:"card p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800"},[t("div",{class:"flex items-start space-x-3"},[t("i",{class:"fas fa-info-circle text-blue-600 dark:text-blue-400 mt-1"}),t("div",{class:"flex-1"},[t("h3",{class:"font-semibold text-blue-900 dark:text-blue-100 mb-1"}," Documento Privado "),t("p",{class:"text-sm text-blue-700 dark:text-blue-300"},' Este documento ficará guardado apenas no seu perfil. Para reportá-lo como perdido, vá em "Meus Documentos" e mude o status. ')])])],-1)),t("form",{onSubmit:i(F,["prevent"]),class:"space-y-6"},[t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Tipo de Documento * ",-1)),f(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>s.type=a),required:"",class:"w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-input text-gray-900 dark:text-dark-text focus:ring-2 focus:ring-primary focus:border-transparent"},[...e[12]||(e[12]=[t("option",{value:""},"Selecione o tipo",-1),t("option",{value:"bi"},"Bilhete de Identidade (BI)",-1),t("option",{value:"passport"},"Passaporte",-1),t("option",{value:"driver_license"},"Carta de Condução",-1),t("option",{value:"dire"},"DIRE",-1),t("option",{value:"nuit"},"NUIT",-1),t("option",{value:"work_card"},"Cartão de Trabalho",-1),t("option",{value:"student_card"},"Cartão de Estudante",-1),t("option",{value:"voter_card"},"Cartão de Eleitor",-1),t("option",{value:"birth_certificate"},"Certidão de Nascimento",-1),t("option",{value:"title_deed"},"Título de Propriedade",-1),t("option",{value:"other"},"Outro",-1)])],512),[[R,s.type]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Título * ",-1)),f(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>s.title=a),type:"text",required:"",placeholder:"Ex: Meu BI",class:"w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-input text-gray-900 dark:text-dark-text focus:ring-2 focus:ring-primary focus:border-transparent"},null,512),[[k,s.title]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Número do Documento ",-1)),f(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>s.document_number=a),type:"text",placeholder:"Ex: 110100123456A",class:"w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-input text-gray-900 dark:text-dark-text focus:ring-2 focus:ring-primary focus:border-transparent"},null,512),[[k,s.document_number]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Descrição ",-1)),f(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=a=>s.description=a),rows:"3",placeholder:"Notas adicionais sobre o documento...",class:"w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-input text-gray-900 dark:text-dark-text focus:ring-2 focus:ring-primary focus:border-transparent"},null,512),[[k,s.description]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Foto/Scan do Documento * ",-1)),t("div",{class:J(["border-2 border-dashed border-gray-300 dark:border-dark-border rounded-lg p-6 text-center hover:border-primary transition-colors cursor-pointer",{"border-primary bg-primary/5":u.value}]),onClick:I,onDragover:e[6]||(e[6]=i(a=>u.value=!0,["prevent"])),onDragleave:e[7]||(e[7]=i(a=>u.value=!1,["prevent"])),onDrop:i(U,["prevent"])},[t("input",{ref_key:"fileInput",ref:C,type:"file",accept:"image/*,.pdf",onChange:$,class:"hidden",required:""},null,544),o.value?(p(),g("div",ee,[e[19]||(e[19]=t("i",{class:"fas fa-file text-2xl text-primary"},null,-1)),t("div",te,[t("p",re,y(o.value.name),1),t("p",ae,y(z(o.value.size)),1)]),t("button",{onClick:e[5]||(e[5]=i(a=>o.value=null,["stop"])),class:"text-red-500 hover:text-red-700"},[...e[18]||(e[18]=[t("i",{class:"fas fa-times"},null,-1)])])])):(p(),g("div",Z,[...e[17]||(e[17]=[t("i",{class:"fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"},null,-1),t("p",{class:"text-gray-600 dark:text-gray-400 mb-1"}," Clique ou arraste para fazer upload ",-1),t("p",{class:"text-xs text-gray-500"}," PNG, JPG, PDF (máx. 10MB) ",-1)])]))],34)]),m(W,{modelValue:b.value,"onUpdate:modelValue":e[8]||(e[8]=a=>b.value=a),onFileSelected:N},null,8,["modelValue"]),l.value?(p(),g("div",oe,[t("p",le,[e[21]||(e[21]=t("i",{class:"fas fa-exclamation-circle mr-1"},null,-1)),w(" "+y(l.value),1)])])):j("",!0),t("div",se,[m(E,{type:"button",variant:"secondary","full-width":"",onClick:e[9]||(e[9]=a=>S(n).back())},{default:v(()=>[...e[22]||(e[22]=[w(" Cancelar ",-1)])]),_:1}),m(E,{type:"submit",variant:"primary","full-width":"",loading:x.value},{default:v(()=>[...e[23]||(e[23]=[t("i",{class:"fas fa-save mr-2"},null,-1),w(" Guardar Documento ",-1)])]),_:1},8,["loading"])])],32)]),m(L)]),_:1}))}});export{be as default};
