import{a as F,r as d,M as P,p as U,w as b,o as p,h as t,j as c,i as T,u as q,O as i,b as v,e as _,R as m,_ as A,S as g,n as G,t as k,k as y}from"./vue-vendor-BHw4onN5.js";import{u as j,b as B,T as R,s as w,a as h}from"./index-mP60vrJ3.js";import{_ as O}from"./MainLayout.vue_vue_type_script_setup_true_lang-BUzgcg3_.js";import"./supabase-aQ0K3vAX.js";import"./logofmd-DeXnOIzE.js";const J={class:"max-w-2xl mx-auto px-4 py-6 space-y-6"},K={class:"flex items-center justify-between mb-6"},L={key:0},H={key:1,class:"flex items-center justify-center space-x-3"},Q={class:"text-left"},W={class:"font-medium text-gray-900 dark:text-dark-text"},X={class:"text-xs text-gray-500"},Y={key:0,class:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg"},Z={class:"text-sm text-red-600 dark:text-red-400"},ee={class:"flex space-x-3"},ie=F({__name:"SaveDocumentView",setup(te){const n=q(),f=j(),{success:E,error:M}=h(),S=d(null),o=d(null),u=d(!1),x=d(!1),l=d(""),s=P({type:"",title:"",document_number:"",description:""}),$=a=>{const e=a.target;if(e.files&&e.files[0]){const r=e.files[0];if(r.size>10*1024*1024){l.value="Arquivo muito grande. Máximo 10MB.";return}o.value=r,l.value=""}},I=a=>{if(u.value=!1,a.dataTransfer?.files&&a.dataTransfer.files[0]){const e=a.dataTransfer.files[0];if(e.size>10*1024*1024){l.value="Arquivo muito grande. Máximo 10MB.";return}o.value=e,l.value=""}},N=a=>a<1024?a+" B":a<1024*1024?(a/1024).toFixed(1)+" KB":(a/(1024*1024)).toFixed(1)+" MB",V=async()=>{if(!o.value){l.value="Selecione um arquivo";return}if(!f.userId){n.push({name:"Login"});return}x.value=!0,l.value="";try{const a=o.value.name.split(".").pop(),e=`${f.userId}/${Date.now()}.${a}`,{data:r,error:D}=await w.storage.from("documents").upload(e,o.value,{cacheControl:"3600",upsert:!1});if(D)throw D;const{data:{publicUrl:z}}=w.storage.from("documents").getPublicUrl(r.path),{data:re,error:C}=await w.from("documents").insert([{user_id:f.userId,title:s.title,type:s.type,status:"normal",is_public:!1,document_number:s.document_number||null,description:s.description||null,file_url:z,file_name:o.value.name,file_path:r.path,file_size:o.value.size,file_type:o.value.type}]).select().single();if(C)throw C;E("Documento guardado com sucesso!"),setTimeout(()=>{n.push("/documents")},1500)}catch(a){console.error("Error saving document:",a),l.value=a.message||"Erro ao guardar documento",M(l.value)}finally{x.value=!1}};return(a,e)=>(p(),U(O,null,{default:b(()=>[t("div",J,[t("div",K,[e[11]||(e[11]=t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-dark-text"}," Guardar Documento ",-1)),t("button",{onClick:e[0]||(e[0]=r=>T(n).back()),class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},[...e[10]||(e[10]=[t("i",{class:"fas fa-times text-xl"},null,-1)])])]),e[24]||(e[24]=t("div",{class:"card p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800"},[t("div",{class:"flex items-start space-x-3"},[t("i",{class:"fas fa-info-circle text-blue-600 dark:text-blue-400 mt-1"}),t("div",{class:"flex-1"},[t("h3",{class:"font-semibold text-blue-900 dark:text-blue-100 mb-1"}," Documento Privado "),t("p",{class:"text-sm text-blue-700 dark:text-blue-300"},' Este documento ficará guardado apenas no seu perfil. Para reportá-lo como perdido, vá em "Meus Documentos" e mude o status. ')])])],-1)),t("form",{onSubmit:i(V,["prevent"]),class:"space-y-6"},[t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Tipo de Documento * ",-1)),m(t("select",{"onUpdate:modelValue":e[1]||(e[1]=r=>s.type=r),required:"",class:"w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-input text-gray-900 dark:text-dark-text focus:ring-2 focus:ring-primary focus:border-transparent"},[...e[12]||(e[12]=[t("option",{value:""},"Selecione o tipo",-1),t("option",{value:"bi"},"Bilhete de Identidade (BI)",-1),t("option",{value:"passport"},"Passaporte",-1),t("option",{value:"driver_license"},"Carta de Condução",-1),t("option",{value:"dire"},"DIRE",-1),t("option",{value:"nuit"},"NUIT",-1),t("option",{value:"work_card"},"Cartão de Trabalho",-1),t("option",{value:"student_card"},"Cartão de Estudante",-1),t("option",{value:"voter_card"},"Cartão de Eleitor",-1),t("option",{value:"birth_certificate"},"Certidão de Nascimento",-1),t("option",{value:"title_deed"},"Título de Propriedade",-1),t("option",{value:"other"},"Outro",-1)])],512),[[A,s.type]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Título * ",-1)),m(t("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>s.title=r),type:"text",required:"",placeholder:"Ex: Meu BI",class:"w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-input text-gray-900 dark:text-dark-text focus:ring-2 focus:ring-primary focus:border-transparent"},null,512),[[g,s.title]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Número do Documento ",-1)),m(t("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>s.document_number=r),type:"text",placeholder:"Ex: 110100123456A",class:"w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-input text-gray-900 dark:text-dark-text focus:ring-2 focus:ring-primary focus:border-transparent"},null,512),[[g,s.document_number]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Descrição ",-1)),m(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=r=>s.description=r),rows:"3",placeholder:"Notas adicionais sobre o documento...",class:"w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-input text-gray-900 dark:text-dark-text focus:ring-2 focus:ring-primary focus:border-transparent"},null,512),[[g,s.description]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Foto/Scan do Documento * ",-1)),t("div",{class:G(["border-2 border-dashed border-gray-300 dark:border-dark-border rounded-lg p-6 text-center hover:border-primary transition-colors cursor-pointer",{"border-primary bg-primary/5":u.value}]),onClick:e[6]||(e[6]=r=>a.$refs.fileInput.click()),onDragover:e[7]||(e[7]=i(r=>u.value=!0,["prevent"])),onDragleave:e[8]||(e[8]=i(r=>u.value=!1,["prevent"])),onDrop:i(I,["prevent"])},[t("input",{ref_key:"fileInput",ref:S,type:"file",accept:"image/*,.pdf",onChange:$,class:"hidden",required:""},null,544),o.value?(p(),v("div",H,[e[19]||(e[19]=t("i",{class:"fas fa-file text-2xl text-primary"},null,-1)),t("div",Q,[t("p",W,k(o.value.name),1),t("p",X,k(N(o.value.size)),1)]),t("button",{onClick:e[5]||(e[5]=i(r=>o.value=null,["stop"])),class:"text-red-500 hover:text-red-700"},[...e[18]||(e[18]=[t("i",{class:"fas fa-times"},null,-1)])])])):(p(),v("div",L,[...e[17]||(e[17]=[t("i",{class:"fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"},null,-1),t("p",{class:"text-gray-600 dark:text-gray-400 mb-1"}," Clique ou arraste para fazer upload ",-1),t("p",{class:"text-xs text-gray-500"}," PNG, JPG, PDF (máx. 10MB) ",-1)])]))],34)]),l.value?(p(),v("div",Y,[t("p",Z,[e[21]||(e[21]=t("i",{class:"fas fa-exclamation-circle mr-1"},null,-1)),y(" "+k(l.value),1)])])):_("",!0),t("div",ee,[c(B,{type:"button",variant:"secondary","full-width":"",onClick:e[9]||(e[9]=r=>T(n).back())},{default:b(()=>[...e[22]||(e[22]=[y(" Cancelar ",-1)])]),_:1}),c(B,{type:"submit",variant:"primary","full-width":"",loading:x.value},{default:b(()=>[...e[23]||(e[23]=[t("i",{class:"fas fa-save mr-2"},null,-1),y(" Guardar Documento ",-1)])]),_:1},8,["loading"])])],32)]),c(R)]),_:1}))}});export{ie as default};
