import{r as w,a as R,U as te,V as Z,p as A,o,i as M,w as k,h as e,b as u,e as S,n as T,t as d,j as h,k as $,c as C,O as G,W as ie,T as ae,l as re,Q as de,F as B,s as z,C as ce,R as q,S as H,u as ue}from"./vue-vendor-uTGeEaNR.js";import{b as V,u as L,s as se,a as Y,_ as le,c as O,g as X,d as W,P as F,T as me}from"./index-rFd8u1B7.js";import{u as fe}from"./useDocuments-DsX-w4WZ.js";import{_ as pe}from"./MainLayout.vue_vue_type_script_setup_true_lang-DG2jyWrq.js";import{B as Q}from"./BaseModal-CkAi3-se.js";import{s as xe}from"./supabase-ChPLGw3M.js";import"./supabase-aQ0K3vAX.js";import"./logofmd-DeXnOIzE.js";function ve(){const f=w({granted:!1,denied:!1,prompt:!0}),c=w(!1),m=w(null);async function r(){try{if(!navigator.permissions)return f.value;const s=await navigator.permissions.query({name:"camera"});return f.value={granted:s.state==="granted",denied:s.state==="denied",prompt:s.state==="prompt"},s.onchange=()=>{f.value={granted:s.state==="granted",denied:s.state==="denied",prompt:s.state==="prompt"}},f.value}catch(s){return console.error("Error checking camera permission:",s),f.value}}async function i(){try{if(c.value=!0,m.value=null,/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&"mediaDevices"in navigator){const p=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1});f.value.granted=!0,f.value.denied=!1,f.value.prompt=!1;const g=document.createElement("video");g.srcObject=p,g.play(),await new Promise(t=>{g.onloadedmetadata=t});const n=document.createElement("canvas");return n.width=g.videoWidth,n.height=g.videoHeight,n.getContext("2d")?.drawImage(g,0,0),p.getTracks().forEach(t=>t.stop()),new Promise(t=>{n.toBlob(l=>{if(l){const _=new File([l],`photo_${Date.now()}.jpg`,{type:"image/jpeg"});t(_)}},"image/jpeg",.9)})}else return await v()}catch(s){return console.error("Camera capture error:",s),s.name==="NotAllowedError"?(m.value="PermissÃ£o da cÃ¢mera negada",f.value.denied=!0,f.value.granted=!1):s.name==="NotFoundError"?m.value="CÃ¢mera nÃ£o encontrada":m.value="Erro ao acessar a cÃ¢mera",null}finally{c.value=!1}}async function v(){return new Promise(s=>{const p=document.createElement("input");p.type="file",p.accept="image/*",p.onchange=g=>{const n=g.target.files?.[0];s(n||null)},p.oncancel=()=>{s(null)},p.click()})}function b(){const s=navigator.userAgent.toLowerCase();return s.includes("chrome")?"Chrome: Clique no Ã­cone de cÃ¢mera na barra de endereÃ§o e permita o acesso.":s.includes("firefox")?"Firefox: Clique no Ã­cone de permissÃµes ao lado do endereÃ§o e permita a cÃ¢mera.":s.includes("safari")?"Safari: VÃ¡ em ConfiguraÃ§Ãµes > Safari > CÃ¢mera e permita para este site.":"Permita o acesso Ã  cÃ¢mera nas configuraÃ§Ãµes do seu navegador."}return{permissionState:f,isCapturing:c,error:m,checkPermission:r,capturePhoto:i,selectFromGallery:v,showPermissionHelp:b}}async function ge(f,c={}){const{maxWidth:m=1920,maxHeight:r=1920,quality:i=.8,mimeType:v="image/jpeg"}=c;return new Promise((b,s)=>{const p=new FileReader;p.onload=g=>{const n=new Image;n.onload=()=>{let{width:a,height:t}=n;if(a>m||t>r){const E=Math.min(m/a,r/t);a*=E,t*=E}const l=document.createElement("canvas");l.width=a,l.height=t;const _=l.getContext("2d");if(!_){s(new Error("Failed to get canvas context"));return}_.drawImage(n,0,0,a,t),l.toBlob(E=>{if(!E){s(new Error("Failed to compress image"));return}const N=new File([E],f.name,{type:v,lastModified:Date.now()});b(N)},v,i)},n.onerror=()=>s(new Error("Failed to load image")),n.src=g.target?.result},p.onerror=()=>s(new Error("Failed to read file")),p.readAsDataURL(f)})}const ye={class:"space-y-4"},be={class:"flex justify-center"},ke={class:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center"},he={class:"text-center"},_e={class:"text-gray-600 dark:text-gray-400 mb-4"},we={class:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 text-left"},$e={class:"text-sm text-gray-600 dark:text-gray-400"},Pe={key:0,class:"bg-danger/10 border border-danger/20 rounded-lg p-3"},Ce={class:"flex space-x-2"},Ee=R({__name:"PermissionModal",props:te({type:{},denied:{type:Boolean,default:!1},helpText:{default:""}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:te(["allow"],["update:modelValue"]),setup(f,{emit:c}){const m=f,r=Z(f,"modelValue"),i=c,v=m.type==="camera"?"PermissÃ£o de CÃ¢mera":"PermissÃ£o de LocalizaÃ§Ã£o",b=m.type==="camera"?"fas fa-camera":"fas fa-map-marker-alt",s=m.type==="camera"?"Precisamos de acesso Ã  cÃ¢mera para tirar fotos dos documentos.":"Precisamos de acesso Ã  sua localizaÃ§Ã£o para mostrar documentos prÃ³ximos.",p=()=>{i("allow"),m.denied||(r.value=!1)};return(g,n)=>(o(),A(Q,{modelValue:r.value,"onUpdate:modelValue":n[1]||(n[1]=a=>r.value=a),title:M(v),maxWidth:"md"},{footer:k(()=>[e("div",Ce,[h(V,{variant:"outline",onClick:n[0]||(n[0]=a=>r.value=!1),class:"flex-1"},{default:k(()=>[...n[4]||(n[4]=[$(" Cancelar ",-1)])]),_:1}),h(V,{variant:"primary",onClick:p,class:"flex-1",disabled:f.denied},{default:k(()=>[$(d(f.denied?"Negado":"Permitir"),1)]),_:1},8,["disabled"])])]),default:k(()=>[e("div",ye,[e("div",be,[e("div",ke,[e("i",{class:T([M(b),"text-3xl text-primary"])},null,2)])]),e("div",he,[e("p",_e,d(M(s)),1),e("div",we,[n[2]||(n[2]=e("h4",{class:"font-medium text-sm text-gray-900 dark:text-dark-text mb-2"}," Como permitir: ",-1)),e("p",$e,d(f.helpText),1)])]),f.denied?(o(),u("div",Pe,[...n[3]||(n[3]=[e("div",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-exclamation-triangle text-danger mt-0.5"}),e("div",{class:"flex-1 text-sm text-danger"},[e("p",{class:"font-medium"},"PermissÃ£o Negada"),e("p",{class:"mt-1"},"VocÃª precisarÃ¡ permitir manualmente nas configuraÃ§Ãµes do navegador.")])],-1)])])):S("",!0)])]),_:1},8,["modelValue","title"]))}}),Ve={class:"relative inline-block"},Me=["src","alt"],Se={key:1,class:"text-3xl font-bold text-gray-600 dark:text-gray-400"},Ue={key:0,class:"absolute inset-0 bg-white/90 dark:bg-dark-bg/90 rounded-full flex items-center justify-center"},Ne=R({__name:"ProfilePhotoUpload",setup(f){const c=L(),{capturePhoto:m,selectFromGallery:r,permissionState:i,showPermissionHelp:v,checkPermission:b}=ve(),{success:s,error:p}=Y(),g=w(!1),n=w(!1),a=w(!1),t=C(()=>c.profile?.avatar_url),l=C(()=>c.profile?.full_name||"User"),_=C(()=>l.value.split(" ").map(U=>U[0]).slice(0,2).join("").toUpperCase()),E=C(()=>v()),N=()=>{g.value=!0},j=async()=>{if(g.value=!1,await b(),i.value.denied){n.value=!0;return}if(i.value.prompt){n.value=!0;return}await I(!0)},y=async()=>{g.value=!1,await I(!1)},P=async()=>{await I(!0)},I=async U=>{try{a.value=!0;const x=U?await m():await r();if(!x){a.value=!1;return}const D=await ge(x,{maxWidth:500,maxHeight:500,quality:.8}),J=`avatar_${c.user?.id}_${Date.now()}.jpg`,{error:K}=await se.storage.from("profiles").upload(J,D,{upsert:!0});if(K)throw K;const{data:ne}=se.storage.from("profiles").getPublicUrl(J),ee=await c.updateProfile({avatar_url:ne.publicUrl});if(ee.success)s("Foto de perfil atualizada!");else throw new Error(ee.error)}catch(x){console.error("Upload error:",x),p(x.message||"Erro ao fazer upload da foto")}finally{a.value=!1}},oe=async()=>{g.value=!1;try{a.value=!0;const U=await c.updateProfile({avatar_url:""});if(U.success)s("Foto de perfil removida!");else throw new Error(U.error)}catch(U){p(U.message||"Erro ao remover foto")}finally{a.value=!1}};return(U,x)=>(o(),u("div",Ve,[e("div",{class:"w-24 h-24 rounded-full overflow-hidden bg-gray-200 dark:bg-gray-700 flex items-center justify-center cursor-pointer group",onClick:N},[t.value?(o(),u("img",{key:0,src:t.value,alt:l.value,class:"w-full h-full object-cover"},null,8,Me)):(o(),u("span",Se,d(_.value),1)),x[4]||(x[4]=e("div",{class:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"},[e("i",{class:"fas fa-camera text-white text-2xl"})],-1))]),e("button",{class:"absolute bottom-0 right-0 w-8 h-8 bg-primary text-white rounded-full flex items-center justify-center shadow-lg hover:bg-primary-dark transition-colors",onClick:G(N,["stop"]),"aria-label":"Alterar foto"},[...x[5]||(x[5]=[e("i",{class:"fas fa-camera text-sm"},null,-1)])]),a.value?(o(),u("div",Ue,[...x[6]||(x[6]=[e("div",{class:"spinner"},null,-1)])])):S("",!0),(o(),A(ie,{to:"body"},[h(ae,{name:"fade"},{default:k(()=>[g.value?(o(),u("div",{key:0,class:"fixed inset-0 bg-black/50 z-50 flex items-end md:items-center justify-center p-4",onClick:x[2]||(x[2]=D=>g.value=!1)},[e("div",{class:"bg-white dark:bg-dark-card rounded-t-xl md:rounded-xl w-full max-w-sm p-4 space-y-2",onClick:x[1]||(x[1]=G(()=>{},["stop"]))},[x[11]||(x[11]=e("h3",{class:"font-bold text-lg mb-4 text-center"},"Alterar Foto de Perfil",-1)),h(V,{variant:"outline","full-width":"",onClick:j,disabled:a.value},{default:k(()=>[...x[7]||(x[7]=[e("i",{class:"fas fa-camera mr-2"},null,-1),$(" Tirar Foto ",-1)])]),_:1},8,["disabled"]),h(V,{variant:"outline","full-width":"",onClick:y,disabled:a.value},{default:k(()=>[...x[8]||(x[8]=[e("i",{class:"fas fa-images mr-2"},null,-1),$(" Escolher da Galeria ",-1)])]),_:1},8,["disabled"]),t.value?(o(),A(V,{key:0,variant:"outline","full-width":"",onClick:oe,disabled:a.value,class:"text-danger"},{default:k(()=>[...x[9]||(x[9]=[e("i",{class:"fas fa-trash mr-2"},null,-1),$(" Remover Foto ",-1)])]),_:1},8,["disabled"])):S("",!0),h(V,{variant:"secondary","full-width":"",onClick:x[0]||(x[0]=D=>g.value=!1)},{default:k(()=>[...x[10]||(x[10]=[$(" Cancelar ",-1)])]),_:1})])])):S("",!0)]),_:1})])),h(Ee,{modelValue:n.value,"onUpdate:modelValue":x[3]||(x[3]=D=>n.value=D),type:"camera",denied:M(i).denied,helpText:E.value,onAllow:P},null,8,["modelValue","denied","helpText"])]))}}),Te=le(Ne,[["__scopeId","data-v-9c9b31e4"]]),Fe={class:"space-y-4"},Ae={class:"grid md:grid-cols-3 gap-4"},Re=R({__name:"SubscriptionPlansModal",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:["update:modelValue"],setup(f){const c=Z(f,"modelValue"),m=L(),{success:r}=Y(),i=C(()=>m.profile?.plan||"free"),v=b=>{r(`Funcionalidade de pagamento em breve para o plano ${b}!`),c.value=!1};return(b,s)=>(o(),A(Q,{modelValue:c.value,"onUpdate:modelValue":s[3]||(s[3]=p=>c.value=p),title:"Planos de SubscriÃ§Ã£o",maxWidth:"lg"},{default:k(()=>[e("div",Fe,[s[12]||(s[12]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400 mb-6"}," Escolha o plano que melhor se adapta Ã s suas necessidades. Economize mais com planos de longo prazo! ",-1)),e("div",Ae,[e("div",{class:T(["border-2 rounded-xl p-6 transition-all hover:shadow-lg",i.value==="monthly"?"border-primary bg-primary/5":"border-gray-200 dark:border-gray-700"])},[s[4]||(s[4]=e("div",{class:"text-center mb-4"},[e("h3",{class:"text-xl font-bold text-gray-900 dark:text-dark-text"},"Mensal"),e("p",{class:"text-3xl font-bold text-gray-900 dark:text-dark-text mt-2"},"10 MZN"),e("p",{class:"text-sm text-gray-500"},"por mÃªs")],-1)),s[5]||(s[5]=e("ul",{class:"space-y-3 mb-6 text-sm"},[e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",null,"Uploads ilimitados")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",null,"Sem anÃºncios")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",null,"Busca avanÃ§ada")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",null,"NotificaÃ§Ãµes push")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",null,"Suporte prioritÃ¡rio")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",null,"Backup automÃ¡tico")])],-1)),h(V,{variant:"primary","full-width":"",onClick:s[0]||(s[0]=p=>v("monthly")),disabled:i.value==="monthly"},{default:k(()=>[$(d(i.value==="monthly"?"Plano Atual":"Selecionar"),1)]),_:1},8,["disabled"])],2),e("div",{class:T(["border-2 rounded-xl p-6 relative transition-all hover:shadow-lg",i.value==="quarterly"?"border-primary bg-primary/5":"border-primary"])},[s[6]||(s[6]=e("div",{class:"absolute -top-3 left-1/2 transform -translate-x-1/2"},[e("span",{class:"bg-primary text-white px-4 py-1 rounded-full text-xs font-bold"}," POPULAR ")],-1)),s[7]||(s[7]=e("div",{class:"text-center mb-4"},[e("h3",{class:"text-xl font-bold text-primary"},"Trimestral"),e("p",{class:"text-3xl font-bold text-gray-900 dark:text-dark-text mt-2"},"27 MZN"),e("p",{class:"text-sm text-gray-500"},"a cada 3 meses"),e("p",{class:"text-xs text-success font-semibold mt-1"},"Economize 10%")],-1)),s[8]||(s[8]=e("ul",{class:"space-y-3 mb-6 text-sm"},[e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-primary mt-1"}),e("span",{class:"font-medium"},"Uploads ilimitados")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-primary mt-1"}),e("span",{class:"font-medium"},"Sem anÃºncios")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-primary mt-1"}),e("span",{class:"font-medium"},"Busca avanÃ§ada")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-primary mt-1"}),e("span",{class:"font-medium"},"NotificaÃ§Ãµes push")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-primary mt-1"}),e("span",{class:"font-medium"},"Suporte prioritÃ¡rio")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-primary mt-1"}),e("span",{class:"font-medium"},"Backup automÃ¡tico")])],-1)),h(V,{variant:"primary","full-width":"",onClick:s[1]||(s[1]=p=>v("quarterly")),disabled:i.value==="quarterly"},{default:k(()=>[$(d(i.value==="quarterly"?"Plano Atual":"Selecionar"),1)]),_:1},8,["disabled"])],2),e("div",{class:T(["border-2 rounded-xl p-6 transition-all hover:shadow-lg",i.value==="annual"?"border-success bg-success/5":"border-success"])},[s[9]||(s[9]=e("div",{class:"absolute -top-3 left-1/2 transform -translate-x-1/2"},[e("span",{class:"bg-success text-white px-4 py-1 rounded-full text-xs font-bold"}," MELHOR VALOR ")],-1)),s[10]||(s[10]=e("div",{class:"text-center mb-4 mt-2"},[e("h3",{class:"text-xl font-bold text-success"},"Anual"),e("p",{class:"text-3xl font-bold text-gray-900 dark:text-dark-text mt-2"},"96 MZN"),e("p",{class:"text-sm text-gray-500"},"por ano"),e("p",{class:"text-xs text-success font-semibold mt-1"},"Economize 20%")],-1)),s[11]||(s[11]=e("ul",{class:"space-y-3 mb-6 text-sm"},[e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",{class:"font-medium"},"Uploads ilimitados")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",{class:"font-medium"},"Sem anÃºncios")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",{class:"font-medium"},"Busca avanÃ§ada")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",{class:"font-medium"},"NotificaÃ§Ãµes push")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",{class:"font-medium"},"Suporte prioritÃ¡rio")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",{class:"font-medium"},"Backup automÃ¡tico")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-star text-warning-dark mt-1"}),e("span",{class:"font-medium text-warning-dark"},"2 meses grÃ¡tis")])],-1)),h(V,{variant:"success","full-width":"",onClick:s[2]||(s[2]=p=>v("annual")),disabled:i.value==="annual"},{default:k(()=>[$(d(i.value==="annual"?"Plano Atual":"Selecionar"),1)]),_:1},8,["disabled"])],2)]),s[13]||(s[13]=e("div",{class:"mt-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg text-center"},[e("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," ðŸ’³ Aceitamos M-Pesa, CartÃ£o de CrÃ©dito e TransferÃªncia BancÃ¡ria ")],-1))])]),_:1},8,["modelValue"]))}}),De={class:"space-y-6"},je={class:"card bg-gradient-to-br from-primary/10 to-primary/5 border border-primary/20"},Oe={class:"text-center mb-4"},Be={class:"text-5xl mb-2"},ze={class:"text-2xl font-bold text-gray-900 dark:text-dark-text"},Le={class:"text-sm text-gray-600 dark:text-gray-400"},Ie={class:"text-center mb-4"},qe={class:"text-4xl font-bold text-primary"},He={key:0,class:"space-y-2"},Xe={class:"flex justify-between text-sm"},We={class:"font-semibold"},Ge={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3"},Ze={class:"text-xs text-gray-600 dark:text-gray-400 text-center"},Ye={key:1,class:"text-center text-sm text-success font-semibold"},Qe={class:"card"},Je={class:"space-y-2"},Ke={class:"text-sm text-gray-600 dark:text-gray-400"},et={class:"text-sm font-semibold text-primary"},tt={class:"card"},st={class:"flex items-center justify-between mb-4"},at=["disabled"],rt={key:0,class:"text-center py-6 text-gray-500"},lt={key:1,class:"text-center py-6 text-gray-500"},ot={key:2,class:"space-y-2"},nt={class:"flex-shrink-0 w-8 text-center"},it={key:0,class:"text-2xl"},dt={key:1,class:"text-2xl"},ct={key:2,class:"text-2xl"},ut={key:3,class:"text-lg font-semibold text-gray-500"},mt=["src","alt"],ft={class:"flex-1 min-w-0"},pt={class:"font-semibold text-gray-900 dark:text-dark-text truncate"},xt={key:0,class:"text-xs text-primary ml-1"},vt={class:"text-xs text-gray-500"},gt={class:"flex-shrink-0 text-right"},yt={class:"font-bold text-primary"},bt=R({__name:"RankingsSection",props:{userPoints:{},currentUserId:{}},setup(f){const c=f,m=w([]),r=w(!1),i=C(()=>{const a=O(c.userPoints);return X(a)}),v=C(()=>{const a=O(c.userPoints),t=W(a);return t?X(t.rank):null}),b=C(()=>{const a=O(c.userPoints),t=W(a);return t?t.pointsNeeded:0}),s=C(()=>{const a=O(c.userPoints),t=W(a);if(!t)return 100;const l=g(a),_=t.pointsNeeded+l,E=c.userPoints-l,N=_-l;return Math.min(Math.round(E/N*100),100)}),p=C(()=>({documentMatch:{label:"Match de documento",points:F.DOCUMENT_MATCH},reportDocument:{label:"Reportar documento",points:F.REPORT_DOCUMENT},verifyDocument:{label:"Verificar documento",points:F.VERIFY_DOCUMENT},helpOthers:{label:"Ajudar outros usuÃ¡rios",points:F.HELP_OTHERS},completeProfile:{label:"Completar perfil",points:F.COMPLETE_PROFILE},dailyLogin:{label:"Login diÃ¡rio",points:F.DAILY_LOGIN}})),g=a=>({bronze:0,silver:100,gold:500,platinum:1e3})[a]||0,n=async()=>{r.value=!0;try{const{data:a,error:t}=await xe.from("user_profiles").select("id, full_name, points, avatar_url").order("points",{ascending:!1}).limit(10);if(t)throw t;m.value=a||[]}catch(a){console.error("Erro ao carregar leaderboard:",a)}finally{r.value=!1}};return re(()=>{n()}),(a,t)=>(o(),u("div",De,[e("div",je,[e("div",Oe,[e("div",Be,d(i.value.icon),1),e("h3",ze,d(i.value.name),1),e("p",Le,d(i.value.description),1)]),e("div",Ie,[e("p",qe,d(f.userPoints),1),t[0]||(t[0]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"pontos",-1))]),v.value?(o(),u("div",He,[e("div",Xe,[t[1]||(t[1]=e("span",{class:"text-gray-600 dark:text-gray-400"},"PrÃ³ximo nÃ­vel:",-1)),e("span",We,d(v.value.name)+" "+d(v.value.icon),1)]),e("div",Ge,[e("div",{class:"bg-gradient-to-r from-primary to-primary-dark h-3 rounded-full transition-all duration-500",style:de({width:`${s.value}%`})},null,4)]),e("p",Ze," Faltam "+d(b.value)+" pontos para o prÃ³ximo nÃ­vel ",1)])):(o(),u("div",Ye," ðŸŽ‰ VocÃª atingiu o nÃ­vel mÃ¡ximo! "))]),e("div",Qe,[t[2]||(t[2]=e("h4",{class:"font-semibold text-gray-900 dark:text-dark-text mb-3"}," Como ganhar pontos? ",-1)),e("div",Je,[(o(!0),u(B,null,z(p.value,(l,_)=>(o(),u("div",{key:_,class:"flex items-center justify-between"},[e("span",Ke,d(l.label),1),e("span",et,"+"+d(l.points),1)]))),128))])]),e("div",tt,[e("div",st,[t[4]||(t[4]=e("h4",{class:"font-semibold text-gray-900 dark:text-dark-text"}," ðŸ† Top UsuÃ¡rios ",-1)),e("button",{onClick:n,class:"text-sm text-primary hover:underline",disabled:r.value},[e("i",{class:T(["fas fa-sync-alt",{"fa-spin":r.value}])},null,2),t[3]||(t[3]=$(" Atualizar ",-1))],8,at)]),r.value?(o(),u("div",rt," Carregando ranking... ")):m.value.length===0?(o(),u("div",lt," Nenhum usuÃ¡rio no ranking ainda ")):(o(),u("div",ot,[(o(!0),u(B,null,z(m.value,(l,_)=>(o(),u("div",{key:l.id,class:T(["flex items-center space-x-3 p-3 rounded-lg transition-colors",l.id===f.currentUserId?"bg-primary/10 border border-primary/30":"hover:bg-gray-50 dark:hover:bg-gray-800"])},[e("div",nt,[_===0?(o(),u("span",it,"ðŸ¥‡")):_===1?(o(),u("span",dt,"ðŸ¥ˆ")):_===2?(o(),u("span",ct,"ðŸ¥‰")):(o(),u("span",ut,d(_+1),1))]),e("img",{src:l.avatar_url||"https://placehold.co/48x48",alt:l.full_name,class:"w-12 h-12 rounded-full object-cover"},null,8,mt),e("div",ft,[e("p",pt,[$(d(l.full_name||"UsuÃ¡rio")+" ",1),l.id===f.currentUserId?(o(),u("span",xt,"(VocÃª)")):S("",!0)]),e("p",vt,d(M(X)(l.points||0).name),1)]),e("div",gt,[e("p",yt,d(l.points||0),1),t[5]||(t[5]=e("p",{class:"text-xs text-gray-500"},"pontos",-1))])],2))),128))]))])]))}}),kt={key:0,class:"text-xs text-red-500 mt-1"},ht={class:"flex"},_t={key:0,class:"text-xs text-red-500 mt-1"},wt={class:"text-xs text-gray-500 mt-1"},$t={key:0,class:"text-xs text-red-500 mt-1"},Pt={key:0,class:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg"},Ct={class:"text-sm text-red-600 dark:text-red-400"},Et={key:1,class:"p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg"},Vt={class:"text-sm text-green-600 dark:text-green-400"},Mt={class:"flex space-x-3"},St=R({__name:"ProfileEditModal",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:["update:modelValue"],setup(f){const c=Z(f,"modelValue"),m=L(),r=w({full_name:"",phone_number:"",delivery_address:""}),i=w({}),v=w(""),b=w(""),s=w(!1);ce(c,a=>{a&&m.profile&&(r.value={full_name:m.profile.full_name||"",phone_number:m.profile.phone_number?.replace("+258","")||"",delivery_address:m.profile.delivery_address||""},i.value={},v.value="",b.value="")});const p=C(()=>r.value.full_name.length>=3&&r.value.phone_number.length===9&&/^[0-9]{9}$/.test(r.value.phone_number)&&(r.value.delivery_address?.length||0)<=200),g=()=>{i.value={};let a=!0;return r.value.full_name.length<3&&(i.value.full_name="Nome deve ter pelo menos 3 caracteres",a=!1),/^[0-9]{9}$/.test(r.value.phone_number)||(i.value.phone_number="Telefone deve ter 9 dÃ­gitos",a=!1),(r.value.delivery_address?.length||0)>200&&(i.value.delivery_address="EndereÃ§o deve ter no mÃ¡ximo 200 caracteres",a=!1),a},n=async()=>{if(v.value="",b.value="",!g()){v.value="Por favor, corrija os erros no formulÃ¡rio";return}s.value=!0;try{const a={full_name:r.value.full_name,phone_number:`+258${r.value.phone_number}`,delivery_address:r.value.delivery_address||null},t=await m.updateProfile(a);t.success?(b.value="Perfil atualizado com sucesso!",setTimeout(()=>{c.value=!1},1500)):v.value=t.error||"Erro ao atualizar perfil"}catch(a){v.value=a.message||"Erro inesperado ao atualizar perfil"}finally{s.value=!1}};return(a,t)=>(o(),A(Q,{modelValue:c.value,"onUpdate:modelValue":t[4]||(t[4]=l=>c.value=l),title:"Editar Perfil",maxWidth:"lg"},{footer:k(()=>[e("div",Mt,[h(V,{variant:"secondary","full-width":"",onClick:t[3]||(t[3]=l=>c.value=!1),disabled:s.value},{default:k(()=>[...t[12]||(t[12]=[$(" Cancelar ",-1)])]),_:1},8,["disabled"]),h(V,{variant:"primary","full-width":"",onClick:n,loading:s.value,disabled:!p.value},{default:k(()=>[...t[13]||(t[13]=[$(" Salvar AlteraÃ§Ãµes ",-1)])]),_:1},8,["loading","disabled"])])]),default:k(()=>[e("form",{onSubmit:G(n,["prevent"]),class:"space-y-4"},[e("div",null,[t[5]||(t[5]=e("label",{for:"fullName",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Nome Completo * ",-1)),q(e("input",{id:"fullName","onUpdate:modelValue":t[0]||(t[0]=l=>r.value.full_name=l),type:"text",required:"",minlength:"3",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-dark-card dark:text-dark-text",placeholder:"Digite seu nome completo"},null,512),[[H,r.value.full_name]]),i.value.full_name?(o(),u("p",kt,d(i.value.full_name),1)):S("",!0)]),e("div",null,[t[7]||(t[7]=e("label",{for:"phoneNumber",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Telefone Celular * ",-1)),e("div",ht,[t[6]||(t[6]=e("span",{class:"inline-flex items-center px-3 text-sm text-gray-900 bg-gray-200 border border-r-0 border-gray-300 rounded-l-lg dark:bg-gray-600 dark:text-gray-400 dark:border-gray-600"}," +258 ",-1)),q(e("input",{id:"phoneNumber","onUpdate:modelValue":t[1]||(t[1]=l=>r.value.phone_number=l),type:"tel",required:"",pattern:"[0-9]{9}",maxlength:"9",class:"rounded-none rounded-r-lg flex-1 min-w-0 px-4 py-2 border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-dark-card dark:text-dark-text",placeholder:"XX XXX XXXX"},null,512),[[H,r.value.phone_number]])]),t[8]||(t[8]=e("p",{class:"text-xs text-gray-500 mt-1"},"Formato: 9 dÃ­gitos (ex: 841234567)",-1)),i.value.phone_number?(o(),u("p",_t,d(i.value.phone_number),1)):S("",!0)]),e("div",null,[t[9]||(t[9]=e("label",{for:"deliveryAddress",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," EndereÃ§o para Entrega de Documentos ",-1)),q(e("textarea",{id:"deliveryAddress","onUpdate:modelValue":t[2]||(t[2]=l=>r.value.delivery_address=l),rows:"3",maxlength:"200",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-dark-card dark:text-dark-text resize-none",placeholder:"Rua, bairro, cidade... (opcional)"},null,512),[[H,r.value.delivery_address]]),e("p",wt,d(r.value.delivery_address?.length||0)+"/200 caracteres ",1),i.value.delivery_address?(o(),u("p",$t,d(i.value.delivery_address),1)):S("",!0)]),v.value?(o(),u("div",Pt,[e("p",Ct,[t[10]||(t[10]=e("i",{class:"fas fa-exclamation-circle mr-1"},null,-1)),$(" "+d(v.value),1)])])):S("",!0),b.value?(o(),u("div",Et,[e("p",Vt,[t[11]||(t[11]=e("i",{class:"fas fa-check-circle mr-1"},null,-1)),$(" "+d(b.value),1)])])):S("",!0)],32)]),_:1},8,["modelValue"]))}}),Ut={class:"px-4 py-6 space-y-6"},Nt={class:"card text-center"},Tt={class:"flex justify-center mb-4"},Ft={class:"text-xl font-bold text-gray-900 dark:text-dark-text mb-1"},At={class:"text-gray-600 dark:text-gray-400 mb-4"},Rt={class:"grid grid-cols-3 gap-4 pt-4 border-t border-gray-200 dark:border-dark-border"},Dt={class:"text-2xl font-bold text-primary"},jt={class:"text-2xl font-bold text-success"},Ot={class:"text-xs text-gray-500"},Bt={class:"text-xs text-gray-500 capitalize"},zt={key:0,class:"mt-6"},Lt={class:"card divide-y divide-gray-200 dark:divide-dark-border"},It=["onClick"],qt={class:"flex items-center space-x-3"},Ht={class:"text-gray-900 dark:text-dark-text"},Xt={class:"card mt-6"},Wt={class:"flex items-center justify-between mb-3"},Gt={key:0,class:"text-gray-500"},Zt={key:1,class:"text-red-500"},Yt={key:2,class:"text-gray-500"},Qt={key:3,class:"space-y-3"},Jt={class:"min-w-0"},Kt={class:"font-medium text-gray-900 dark:text-dark-text truncate"},es={class:"text-xs text-gray-500 capitalize"},ts={class:"text-xs text-gray-400"},ss=R({__name:"ProfileView",setup(f){const c=ue(),m=L(),{success:r}=Y(),{items:i,loading:v,error:b,fetchMyDocuments:s}=fe(),p=w(!1),g=w(!1),n=w(!1),a=w(!1),t=C(()=>m.user),l=C(()=>m.profile),_=()=>{n.value=!n.value},E=async()=>{p.value=!0;const j=await m.signOut();p.value=!1,j.success&&(r("Logout realizado com sucesso!"),c.push("/login"))},N=[{icon:"fas fa-user-edit",label:"Editar Perfil",action:()=>a.value=!0},{icon:"fas fa-file-alt",label:"Meus Documentos",action:()=>c.push("/documents")},{icon:"fas fa-crown",label:"Planos de SubscriÃ§Ã£o",action:()=>g.value=!0},{icon:"fas fa-bell",label:"NotificaÃ§Ãµes",action:()=>c.push("/notifications")},{icon:"fas fa-lock",label:"Privacidade e SeguranÃ§a",action:()=>{r("Funcionalidade em breve!")}},{icon:"fas fa-question-circle",label:"Ajuda e Suporte",action:()=>{r("Funcionalidade em breve!")}},{icon:"fas fa-cog",label:"ConfiguraÃ§Ãµes",action:()=>{r("Funcionalidade em breve!")}},{icon:"fas fa-sign-out-alt",label:"Sair",action:E}];return re(async()=>{m.user?.id&&await s(m.user.id)}),(j,y)=>(o(),A(pe,null,{default:k(()=>[e("div",Ut,[e("div",Nt,[e("div",Tt,[h(Te)]),e("h2",Ft,d(l.value?.full_name||"UsuÃ¡rio"),1),e("p",At,d(t.value?.email),1),e("div",Rt,[e("div",null,[e("p",Dt,d(l.value?.document_count||0),1),y[3]||(y[3]=e("p",{class:"text-xs text-gray-500"},"Documentos",-1))]),e("div",{class:"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg p-2 -m-2 transition-colors",onClick:_},[e("p",jt,d(l.value?.points||0),1),e("p",Ot,[y[4]||(y[4]=$(" Pontos ",-1)),e("i",{class:T(["fas fa-chevron-down ml-1 text-xs",{"rotate-180":n.value}])},null,2)])]),e("div",null,[y[5]||(y[5]=e("p",{class:"text-2xl font-bold text-warning-dark"},[e("i",{class:"fas fa-crown"})],-1)),e("p",Bt,d(l.value?.plan||"Free"),1)])])]),h(ae,{name:"slide-fade"},{default:k(()=>[n.value?(o(),u("div",zt,[h(bt,{"user-points":l.value?.points||0,"current-user-id":t.value?.id||""},null,8,["user-points","current-user-id"])])):S("",!0)]),_:1}),e("div",Lt,[(o(),u(B,null,z(N,P=>e("button",{key:P.label,class:"flex items-center justify-between px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors w-full text-left",onClick:P.action},[e("div",qt,[e("i",{class:T([P.icon,"text-gray-600 dark:text-gray-400 w-5"])},null,2),e("span",Ht,d(P.label),1)]),y[6]||(y[6]=e("i",{class:"fas fa-chevron-right text-gray-400 text-sm"},null,-1))],8,It)),64))]),h(V,{variant:"danger",size:"lg","full-width":"",onClick:E,loading:p.value},{default:k(()=>[...y[7]||(y[7]=[e("i",{class:"fas fa-sign-out-alt mr-2"},null,-1),$(" Sair ",-1)])]),_:1},8,["loading"]),y[8]||(y[8]=e("p",{class:"text-center text-sm text-gray-500"}," VersÃ£o 2.0.0 ",-1))]),h(Re,{modelValue:g.value,"onUpdate:modelValue":y[0]||(y[0]=P=>g.value=P)},null,8,["modelValue"]),h(St,{modelValue:a.value,"onUpdate:modelValue":y[1]||(y[1]=P=>a.value=P)},null,8,["modelValue"]),e("div",Xt,[e("div",Wt,[y[9]||(y[9]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-dark-text"},"Meus documentos",-1)),e("button",{class:"text-primary text-sm",onClick:y[2]||(y[2]=P=>M(c).push("/documents"))}," Ver todos ")]),M(v)?(o(),u("div",Gt,"Carregando documentos...")):M(b)?(o(),u("div",Zt,d(M(b)),1)):M(i).length===0?(o(),u("div",Yt," Nenhum documento cadastrado. ")):(o(),u("ul",Qt,[(o(!0),u(B,null,z(M(i).slice(0,3),P=>(o(),u("li",{key:P.id,class:"flex items-center justify-between border border-gray-200 dark:border-dark-border rounded-lg px-3 py-2"},[e("div",Jt,[e("p",Kt,d(P.title),1),e("p",es,d(P.status),1)]),e("span",ts,d(new Date(P.created_at).toLocaleDateString("pt-BR")),1)]))),128))]))]),h(me)]),_:1}))}}),us=le(ss,[["__scopeId","data-v-ab337b0f"]]);export{us as default};
