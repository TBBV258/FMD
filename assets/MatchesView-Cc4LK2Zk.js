import{_ as D}from"./MainLayout.vue_vue_type_script_setup_true_lang-s1TSJ6UG.js";import{u as A,s as h,a as R}from"./index-DomtK_OL.js";import{a as P,c as v,b as c,o,h as t,n as z,t as f,k as g,F as S,s as q,r as N,l as F,p as $,w as T,e as B,i as u}from"./vue-vendor-DJ0JNZJp.js";import"./logofmd-DeXnOIzE.js";import"./supabase-aQ0K3vAX.js";const V={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-md transition-shadow"},L={class:"relative"},U={class:"absolute top-3 right-3 z-10"},O={key:0,class:"h-48 overflow-hidden"},Q=["src","alt"],G={key:1,class:"h-48 bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center"},H={class:"p-4"},I={class:"mb-4"},J={class:"text-lg font-semibold text-gray-900 dark:text-white mb-1"},K={class:"text-sm text-gray-600 dark:text-gray-400 mb-2"},W={class:"flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400"},X={class:"bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded"},Y={class:"bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded"},Z={class:"mb-4"},tt={class:"space-y-1"},et={class:"flex items-center gap-2 mb-4 p-2 bg-gray-50 dark:bg-gray-700/50 rounded"},st=["src","alt"],at={key:1,class:"w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center"},rt={class:"flex-1 min-w-0"},ot={class:"text-sm font-medium text-gray-900 dark:text-white truncate"},nt={class:"text-xs text-gray-500 dark:text-gray-400"},ct={key:0,class:"flex gap-2"},it={key:1,class:"text-center py-2 bg-success/10 rounded-lg"},E=P({__name:"MatchCard",props:{match:{},confirmed:{type:Boolean}},emits:["confirm","reject"],setup(e){const s=e,n=A(),l=v(()=>s.match.lost_document?.user_id===n.user?.id?s.match.lost_document:s.match.found_document),i=v(()=>s.match.lost_document?.user_id===n.user?.id?s.match.found_document:s.match.lost_document),_=v(()=>i.value?.user_profiles),b=v(()=>{const y=s.match.match_score;return y>=70?"bg-success text-white":y>=40?"bg-warning-dark text-white":"bg-gray-500 text-white"});return(y,r)=>(o(),c("div",V,[t("div",L,[t("div",U,[t("div",{class:z(["px-3 py-1 rounded-full text-xs font-bold shadow-lg",b.value])},f(Math.round(e.match.match_score))+"% ",3)]),i.value?.file_url?(o(),c("div",O,[t("img",{src:i.value.file_url,alt:i.value.title,class:"w-full h-full object-cover"},null,8,Q)])):(o(),c("div",G,[...r[2]||(r[2]=[t("i",{class:"fas fa-file-alt text-6xl text-primary/30"},null,-1)])]))]),t("div",H,[t("div",I,[t("h3",J,f(i.value?.title),1),t("p",K,f(i.value?.description),1),t("div",W,[t("span",X,[r[3]||(r[3]=t("i",{class:"fas fa-id-card mr-1"},null,-1)),g(" "+f(i.value?.document_type),1)]),t("span",Y,[r[4]||(r[4]=t("i",{class:"fas fa-map-marker-alt mr-1"},null,-1)),g(" "+f(i.value?.location),1)])])]),t("div",Z,[r[6]||(r[6]=t("p",{class:"text-xs font-semibold text-gray-700 dark:text-gray-300 mb-2"},[t("i",{class:"fas fa-lightbulb text-warning-dark mr-1"}),g(" Por que Ã© um match: ")],-1)),t("ul",tt,[(o(!0),c(S,null,q(e.match.match_reasons.slice(0,3),(w,p)=>(o(),c("li",{key:p,class:"text-xs text-gray-600 dark:text-gray-400 flex items-start"},[r[5]||(r[5]=t("i",{class:"fas fa-check text-success mr-2 mt-0.5"},null,-1)),t("span",null,f(w.description),1)]))),128))])]),t("div",et,[_.value?.avatar_url?(o(),c("img",{key:0,src:_.value.avatar_url,alt:_.value.full_name,class:"w-8 h-8 rounded-full"},null,8,st)):(o(),c("div",at,[...r[7]||(r[7]=[t("i",{class:"fas fa-user text-primary text-sm"},null,-1)])])),t("div",rt,[t("p",ot,f(_.value?.full_name),1),t("p",nt,f(l.value?.status==="lost"?"Encontrou":"Perdeu"),1)])]),e.confirmed?(o(),c("div",it,[...r[10]||(r[10]=[t("p",{class:"text-success font-semibold text-sm"},[t("i",{class:"fas fa-check-circle mr-1"}),g(" Match Confirmado! ")],-1)])])):(o(),c("div",ct,[t("button",{onClick:r[0]||(r[0]=w=>y.$emit("confirm",e.match.id)),class:"flex-1 bg-success hover:bg-success-dark text-white py-2 px-4 rounded-lg transition-colors text-sm font-medium"},[...r[8]||(r[8]=[t("i",{class:"fas fa-check mr-1"},null,-1),g(" Ã‰ meu documento! ",-1)])]),t("button",{onClick:r[1]||(r[1]=w=>y.$emit("reject",e.match.id)),class:"flex-1 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded-lg transition-colors text-sm font-medium"},[...r[9]||(r[9]=[t("i",{class:"fas fa-times mr-1"},null,-1),g(" NÃ£o Ã© meu ",-1)])])]))])]))}}),j={async getMatchesForDocument(e){const{data:s,error:n}=await h.from("document_matches").select(`
        *,
        lost_document:documents!lost_document_id(
          id,
          title,
          description,
          document_type,
          location,
          location_metadata,
          file_url,
          user_profiles(id, full_name, avatar_url)
        ),
        found_document:documents!found_document_id(
          id,
          title,
          description,
          document_type,
          location,
          location_metadata,
          file_url,
          user_profiles(id, full_name, avatar_url)
        )
      `).or(`lost_document_id.eq.${e},found_document_id.eq.${e}`).order("match_score",{ascending:!1});if(n)throw n;return s||[]},async getMyMatches(){const{data:{user:e}}=await h.auth.getUser();if(!e)throw new Error("Not authenticated");const{data:s,error:n}=await h.from("document_matches").select(`
        *,
        lost_document:documents!lost_document_id(
          id,
          title,
          description,
          document_type,
          location,
          location_metadata,
          file_url,
          user_id,
          user_profiles(id, full_name, avatar_url)
        ),
        found_document:documents!found_document_id(
          id,
          title,
          description,
          document_type,
          location,
          location_metadata,
          file_url,
          user_id,
          user_profiles(id, full_name, avatar_url)
        )
      `).or(`lost_document.user_id.eq.${e.id},found_document.user_id.eq.${e.id}`).eq("status","pending").order("match_score",{ascending:!1});if(n)throw n;return s||[]},async confirmMatch(e){const{error:s}=await h.rpc("confirm_match",{p_match_id:e});if(s)throw s;return!0},async rejectMatch(e){const{error:s}=await h.from("document_matches").update({status:"rejected",updated_at:new Date().toISOString()}).eq("id",e);if(s)throw s;return!0},async findMatches(e,s=30){const{data:n,error:l}=await h.rpc("find_document_matches",{p_document_id:e,p_min_score:s});if(l)throw l;return n||[]},async getMatchStats(){const{data:{user:e}}=await h.auth.getUser();if(!e)throw new Error("Not authenticated");const[s,n,l]=await Promise.all([h.from("document_matches").select("id",{count:"exact",head:!0}).eq("status","pending"),h.from("document_matches").select("id",{count:"exact",head:!0}).eq("status","confirmed"),h.from("document_matches").select("id",{count:"exact",head:!0}).eq("status","rejected")]);return{pending:s.count||0,confirmed:n.count||0,rejected:l.count||0,total:(s.count||0)+(n.count||0)+(l.count||0)}},subscribeToMatches(e,s){const n=h.channel("document-matches").on("postgres_changes",{event:"*",schema:"public",table:"document_matches",filter:`lost_document_id=eq.${e},found_document_id=eq.${e}`},l=>{s(l.new)}).subscribe();return()=>{h.removeChannel(n)}}};function lt(){const e=N([]),s=N(!1),n=N(null),{success:l,showError:i}=R(),_=v(()=>e.value.filter(a=>a.status==="pending")),b=v(()=>e.value.filter(a=>a.status==="confirmed")),y=v(()=>e.value.filter(a=>a.match_score>=70)),r=v(()=>e.value.filter(a=>a.match_score>=40&&a.match_score<70)),w=v(()=>e.value.filter(a=>a.match_score<40)),p=async()=>{s.value=!0,n.value=null;try{e.value=await j.getMyMatches()}catch(a){n.value=a.message,i("Erro ao carregar matches: "+a.message)}finally{s.value=!1}},M=async a=>{s.value=!0,n.value=null;try{e.value=await j.getMatchesForDocument(a)}catch(x){n.value=x.message,i("Erro ao carregar matches: "+x.message)}finally{s.value=!1}};return{matches:e,loading:s,error:n,pendingMatches:_,confirmedMatches:b,highScoreMatches:y,mediumScoreMatches:r,lowScoreMatches:w,fetchMatches:p,fetchMatchesForDocument:M,confirmMatch:async a=>{try{await j.confirmMatch(a),l("Match confirmado com sucesso! ðŸŽ‰"),await p()}catch(x){throw i("Erro ao confirmar match: "+x.message),x}},rejectMatch:async a=>{try{await j.rejectMatch(a),l("Match rejeitado"),await p()}catch(x){throw i("Erro ao rejeitar match: "+x.message),x}},findNewMatches:async(a,x=30)=>{s.value=!0;try{const C=await j.findMatches(a,x);C.length>0?(l(`${C.length} possÃ­veis matches encontrados!`),await M(a)):i("Nenhum match encontrado no momento")}catch(C){i("Erro ao buscar matches: "+C.message)}finally{s.value=!1}},getMatchScoreColor:a=>a>=70?"text-success":a>=40?"text-warning-dark":"text-gray-500",getMatchScoreLabel:a=>a>=70?"Alta Probabilidade":a>=40?"MÃ©dia Probabilidade":"Baixa Probabilidade",getMatchScoreBadge:a=>a>=90?"ðŸŽ¯ Excelente":a>=70?"âœ… Muito Bom":a>=50?"ðŸ‘ Bom":a>=30?"ðŸ¤” PossÃ­vel":"â“ ImprovÃ¡vel"}}const dt={class:"max-w-7xl mx-auto px-4 py-6"},ut={key:0,class:"text-center py-12"},mt={key:1,class:"text-center py-12"},ht={key:2,class:"space-y-6"},ft={key:0},gt={class:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center"},_t={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},xt={key:1},yt={class:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center"},pt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},vt={key:2},bt={class:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center"},wt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Mt={key:3,class:"mt-8"},kt={class:"text-lg font-semibold text-success mb-4 flex items-center"},$t={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Dt=P({__name:"MatchesView",setup(e){const{loading:s,pendingMatches:n,confirmedMatches:l,highScoreMatches:i,mediumScoreMatches:_,lowScoreMatches:b,fetchMatches:y,confirmMatch:r,rejectMatch:w}=lt(),p=async k=>{confirm("Confirmar que este Ã© o seu documento?")&&await r(k)},M=async k=>{confirm("Tem certeza que este NÃƒO Ã© o seu documento?")&&await w(k)};return F(()=>{y()}),(k,d)=>(o(),$(D,null,{default:T(()=>[t("div",dt,[d[6]||(d[6]=t("div",{class:"mb-6"},[t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white mb-2"},[t("i",{class:"fas fa-puzzle-piece mr-2 text-primary"}),g(" Matches Sugeridos ")]),t("p",{class:"text-gray-600 dark:text-gray-400"}," Documentos que podem ser seus, encontrados automaticamente pela IA ")],-1)),u(s)?(o(),c("div",ut,[...d[0]||(d[0]=[t("i",{class:"fas fa-spinner fa-spin text-4xl text-primary mb-4"},null,-1),t("p",{class:"text-gray-600 dark:text-gray-400"},"Procurando matches...",-1)])])):u(n).length===0?(o(),c("div",mt,[...d[1]||(d[1]=[t("i",{class:"fas fa-search text-6xl text-gray-300 dark:text-gray-600 mb-4"},null,-1),t("h3",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-2"}," Nenhum match encontrado ",-1),t("p",{class:"text-gray-600 dark:text-gray-400"}," Quando alguÃ©m reportar um documento similar ao seu, ele aparecerÃ¡ aqui. ",-1)])])):(o(),c("div",ht,[u(i).length>0?(o(),c("div",ft,[t("h2",gt,[d[2]||(d[2]=t("i",{class:"fas fa-fire text-danger mr-2"},null,-1)),g(" Alta Probabilidade ("+f(u(i).length)+") ",1)]),t("div",_t,[(o(!0),c(S,null,q(u(i),m=>(o(),$(E,{key:m.id,match:m,onConfirm:p,onReject:M},null,8,["match"]))),128))])])):B("",!0),u(_).length>0?(o(),c("div",xt,[t("h2",yt,[d[3]||(d[3]=t("i",{class:"fas fa-star text-warning-dark mr-2"},null,-1)),g(" MÃ©dia Probabilidade ("+f(u(_).length)+") ",1)]),t("div",pt,[(o(!0),c(S,null,q(u(_),m=>(o(),$(E,{key:m.id,match:m,onConfirm:p,onReject:M},null,8,["match"]))),128))])])):B("",!0),u(b).length>0?(o(),c("div",vt,[t("h2",bt,[d[4]||(d[4]=t("i",{class:"fas fa-question-circle text-gray-500 mr-2"},null,-1)),g(" Baixa Probabilidade ("+f(u(b).length)+") ",1)]),t("div",wt,[(o(!0),c(S,null,q(u(b),m=>(o(),$(E,{key:m.id,match:m,onConfirm:p,onReject:M},null,8,["match"]))),128))])])):B("",!0)])),u(l).length>0?(o(),c("div",Mt,[t("h2",kt,[d[5]||(d[5]=t("i",{class:"fas fa-check-circle mr-2"},null,-1)),g(" Matches Confirmados ("+f(u(l).length)+") ",1)]),t("div",$t,[(o(!0),c(S,null,q(u(l),m=>(o(),$(E,{key:m.id,match:m,confirmed:!0},null,8,["match"]))),128))])])):B("",!0)])]),_:1}))}});export{Dt as default};
