import{a as E,r as v,c as g,l as L,X as V,p as U,w as z,u as F,o as l,h as a,b as d,n as m,t as f,F as O,s as H,e as P,O as Q}from"./vue-vendor-BHw4onN5.js";import{s as p,u as X,a as G}from"./index-mP60vrJ3.js";import{_ as J}from"./MainLayout.vue_vue_type_script_setup_true_lang-BUzgcg3_.js";import"./supabase-aQ0K3vAX.js";import"./logofmd-DeXnOIzE.js";const x={async fetch(o){const{data:r,error:n}=await p.from("notifications").select("*").eq("user_id",o).order("created_at",{ascending:!1});if(n)throw n;return r||[]},async markAsRead(o){const{data:r,error:n}=await p.from("notifications").update({is_read:!0,read_at:new Date().toISOString()}).eq("id",o).select().single();if(n)throw n;return r},subscribeToUser(o,r){const n=p.channel(`notifications:${o}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`user_id=eq.${o}`},h=>{r(h.new)}).subscribe();return()=>{p.removeChannel(n)}}},K={class:"px-4 py-6 space-y-6"},W={class:"flex rounded-full bg-gray-100 dark:bg-dark-card p-1"},Y={key:0,class:"text-center py-12 card"},Z={class:"text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2"},ee={class:"text-gray-500 dark:text-gray-400"},te={key:1,class:"space-y-3"},se=["onClick"],ae={class:"flex items-start space-x-3"},re={class:"flex-1 min-w-0"},ne={class:"font-semibold text-gray-900 dark:text-dark-text mb-1"},oe={class:"text-sm text-gray-600 dark:text-gray-400 mb-2"},ce={class:"text-xs text-gray-500"},le=["onClick"],he=E({__name:"NotificationsView",setup(o){const r=F(),n=X(),{error:h}=G(),i=v("all"),c=v([]),k=v(!1);let u=null;const S=g(()=>c.value),R=g(()=>c.value.filter(e=>e.type==="message")),w=g(()=>i.value==="all"?S.value:R.value),C=g(()=>i.value==="chats"?{title:"Sem conversas",subtitle:"Quando alguém enviar uma mensagem, ela aparecerá aqui."}:{title:"Sem notificações",subtitle:"Você está em dia!"}),T=e=>e?"opacity-60":"",$=e=>{const t="flex-1 py-2 rounded-full text-sm font-semibold transition-colors";return i.value===e?`${t} bg-white dark:bg-dark-bg text-primary shadow`:`${t} text-gray-500`},M=e=>{const t={document_match:"w-10 h-10 rounded-full bg-success/10 text-success flex items-center justify-center",document_found:"w-10 h-10 rounded-full bg-success/10 text-success flex items-center justify-center",message:"w-10 h-10 rounded-full bg-primary/10 text-primary flex items-center justify-center",system:"w-10 h-10 rounded-full bg-gray-100 dark:bg-dark-card text-gray-600 dark:text-gray-400 flex items-center justify-center",verification:"w-10 h-10 rounded-full bg-warning/10 text-warning-dark flex items-center justify-center"};return t[e]||t.system},A=e=>({document_match:"fas fa-check-double",document_found:"fas fa-search",message:"fas fa-envelope",system:"fas fa-info-circle",verification:"fas fa-shield-alt"})[e]||"fas fa-bell",B=e=>{const t=new Date,s=new Date(e),_=t.getTime()-s.getTime(),y=Math.floor(_/6e4),b=Math.floor(y/60),N=Math.floor(b/24);return y<1?"Agora":y<60?`${y}m atrás`:b<24?`${b}h atrás`:N<7?`${N}d atrás`:s.toLocaleDateString("pt-BR",{day:"2-digit",month:"short"})},D=async()=>{if(!n.userId){r.push({name:"Login",query:{redirect:r.currentRoute.value.fullPath}});return}k.value=!0;try{c.value=await x.fetch(n.userId)}catch(e){h(e.message||"Erro ao carregar notificações")}finally{k.value=!1}},j=()=>{!n.userId||u||(u=x.subscribeToUser(n.userId,e=>{c.value=[e,...c.value]}))},q=async e=>{await I(e.id),e.action_url?r.push(e.action_url):(e.type==="document_match"||e.type==="document_found")&&e.metadata&&"documentId"in e.metadata?r.push(`/document/${e.metadata.documentId}`):e.type==="message"&&e.metadata&&"documentId"in e.metadata?r.push(`/chat/${e.metadata.documentId}`):e.type==="verification"&&e.metadata&&"documentId"in e.metadata&&r.push(`/document/${e.metadata.documentId}`)},I=async e=>{const t=c.value.find(s=>s.id===e);if(!(!t||t.is_read)){t.is_read=!0;try{await x.markAsRead(e)}catch(s){h(s.message||"Erro ao atualizar notificação"),t.is_read=!1}}};return L(async()=>{await D(),j()}),V(()=>{u&&(u(),u=null)}),(e,t)=>(l(),U(J,null,{default:z(()=>[a("div",K,[a("div",W,[a("button",{class:m($("all")),onClick:t[0]||(t[0]=s=>i.value="all")}," Notificações ",2),a("button",{class:m($("chats")),onClick:t[1]||(t[1]=s=>i.value="chats")}," Conversas ",2)]),w.value.length===0?(l(),d("div",Y,[t[2]||(t[2]=a("i",{class:"fas fa-bell-slash text-gray-400 text-6xl mb-4"},null,-1)),a("h3",Z,f(C.value.title),1),a("p",ee,f(C.value.subtitle),1)])):(l(),d("div",te,[(l(!0),d(O,null,H(w.value,s=>(l(),d("div",{key:s.id,class:m([T(s.is_read),"card card-hover"]),onClick:_=>q(s)},[a("div",ae,[a("div",{class:m(M(s.type))},[a("i",{class:m(A(s.type))},null,2)],2),a("div",re,[a("h4",ne,f(s.title),1),a("p",oe,f(s.message),1),a("p",ce,f(B(s.created_at)),1)]),s.is_read?P("",!0):(l(),d("button",{key:0,class:"w-2 h-2 rounded-full bg-primary",onClick:Q(_=>I(s.id),["stop"])},null,8,le))])],10,se))),128))]))])]),_:1}))}});export{he as default};
