import{a as j,r as x,c as g,l as L,X as V,p as U,w as z,u as F,o as c,h as a,b as u,n as f,t as m,F as H,s as O,e as P,O as Q}from"./vue-vendor-uTGeEaNR.js";import{s as p,u as X,a as G}from"./index-B80dBVo-.js";import{_ as J}from"./MainLayout.vue_vue_type_script_setup_true_lang-BjYEJNr9.js";import"./supabase-aQ0K3vAX.js";import"./logofmd-DeXnOIzE.js";const _={async fetch(n){const{data:o,error:r}=await p.from("notifications").select("*").eq("user_id",n).order("created_at",{ascending:!1});if(r)throw r;return o||[]},async markAsRead(n){const{data:o,error:r}=await p.from("notifications").update({read:!0}).eq("id",n).select().single();if(r)throw r;return o},subscribeToUser(n,o){const r=p.channel(`notifications:${n}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`user_id=eq.${n}`},h=>{o(h.new)}).subscribe();return()=>{p.removeChannel(r)}}},K={class:"px-4 py-6 space-y-6"},W={class:"flex rounded-full bg-gray-100 dark:bg-dark-card p-1"},Y={key:0,class:"text-center py-12 card"},Z={class:"text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2"},ee={class:"text-gray-500 dark:text-gray-400"},te={key:1,class:"space-y-3"},se=["onClick"],ae={class:"flex items-start space-x-3"},re={class:"flex-1 min-w-0"},oe={class:"font-semibold text-gray-900 dark:text-dark-text mb-1"},ne={class:"text-sm text-gray-600 dark:text-gray-400 mb-2"},le={class:"text-xs text-gray-500"},ce=["onClick"],he=j({__name:"NotificationsView",setup(n){const o=F(),r=X(),{error:h}=G(),i=x("all"),l=x([]),k=x(!1);let d=null;const R=g(()=>l.value),S=g(()=>l.value.filter(e=>e.type==="message")),w=g(()=>i.value==="all"?R.value:S.value),C=g(()=>i.value==="chats"?{title:"Sem conversas",subtitle:"Quando alguém enviar uma mensagem, ela aparecerá aqui."}:{title:"Sem notificações",subtitle:"Você está em dia!"}),T=e=>e?"opacity-60":"",$=e=>{const t="flex-1 py-2 rounded-full text-sm font-semibold transition-colors";return i.value===e?`${t} bg-white dark:bg-dark-bg text-primary shadow`:`${t} text-gray-500`},M=e=>{const t={match:"w-10 h-10 rounded-full bg-success/10 text-success flex items-center justify-center",message:"w-10 h-10 rounded-full bg-primary/10 text-primary flex items-center justify-center",system:"w-10 h-10 rounded-full bg-gray-100 dark:bg-dark-card text-gray-600 dark:text-gray-400 flex items-center justify-center",verification:"w-10 h-10 rounded-full bg-warning/10 text-warning-dark flex items-center justify-center"};return t[e]||t.system},A=e=>({match:"fas fa-check-double",message:"fas fa-envelope",system:"fas fa-info-circle",verification:"fas fa-shield-alt"})[e]||"fas fa-bell",B=e=>{const t=new Date,s=new Date(e),v=t.getTime()-s.getTime(),y=Math.floor(v/6e4),b=Math.floor(y/60),I=Math.floor(b/24);return y<1?"Agora":y<60?`${y}m atrás`:b<24?`${b}h atrás`:I<7?`${I}d atrás`:s.toLocaleDateString("pt-BR",{day:"2-digit",month:"short"})},q=async()=>{if(!r.userId){o.push({name:"Login",query:{redirect:o.currentRoute.value.fullPath}});return}k.value=!0;try{l.value=await _.fetch(r.userId)}catch(e){h(e.message||"Erro ao carregar notificações")}finally{k.value=!1}},D=()=>{!r.userId||d||(d=_.subscribeToUser(r.userId,e=>{l.value=[e,...l.value]}))},E=async e=>{await N(e.id),e.type==="match"&&e.data?.documentId?o.push(`/document/${e.data.documentId}`):e.type==="message"&&e.data?.documentId?o.push(`/chat/${e.data.documentId}`):e.type==="verification"&&e.data?.documentId&&o.push(`/document/${e.data.documentId}`)},N=async e=>{const t=l.value.find(s=>s.id===e);if(!(!t||t.read)){t.read=!0;try{await _.markAsRead(e)}catch(s){h(s.message||"Erro ao atualizar notificação"),t.read=!1}}};return L(async()=>{await q(),D()}),V(()=>{d&&(d(),d=null)}),(e,t)=>(c(),U(J,null,{default:z(()=>[a("div",K,[a("div",W,[a("button",{class:f($("all")),onClick:t[0]||(t[0]=s=>i.value="all")}," Notificações ",2),a("button",{class:f($("chats")),onClick:t[1]||(t[1]=s=>i.value="chats")}," Conversas ",2)]),w.value.length===0?(c(),u("div",Y,[t[2]||(t[2]=a("i",{class:"fas fa-bell-slash text-gray-400 text-6xl mb-4"},null,-1)),a("h3",Z,m(C.value.title),1),a("p",ee,m(C.value.subtitle),1)])):(c(),u("div",te,[(c(!0),u(H,null,O(w.value,s=>(c(),u("div",{key:s.id,class:f([T(s.read),"card card-hover"]),onClick:v=>E(s)},[a("div",ae,[a("div",{class:f(M(s.type))},[a("i",{class:f(A(s.type))},null,2)],2),a("div",re,[a("h4",oe,m(s.title),1),a("p",ne,m(s.message),1),a("p",le,m(B(s.created_at)),1)]),s.read?P("",!0):(c(),u("button",{key:0,class:"w-2 h-2 rounded-full bg-primary",onClick:Q(v=>N(s.id),["stop"])},null,8,ce))])],10,se))),128))]))])]),_:1}))}});export{he as default};
