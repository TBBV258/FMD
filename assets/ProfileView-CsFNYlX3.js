import{r as C,a as D,U as ae,V as Q,p as A,o as c,i as _,w,h as e,b as y,e as M,n as N,t as n,j as $,k as P,c as U,O as Y,X as ie,T as re,l as oe,Q as de,F as I,s as z,C as ce,R as X,S as W,u as ue}from"./vue-vendor-DJ0JNZJp.js";import{s as q,b as V,u as H,a as J,_ as le,d as B,g as G,e as Z,P as j,c as me,T as fe}from"./index-D4_VJUOs.js";import{u as pe}from"./useDocuments-DuOhFSzX.js";import{_ as xe}from"./MainLayout.vue_vue_type_script_setup_true_lang-BuHbt86I.js";import{B as K}from"./BaseModal-GoklSd8v.js";import"./supabase-aQ0K3vAX.js";import"./logofmd-DeXnOIzE.js";function ve(){const p=C(!1),d=C(null),m=async f=>{try{if(!f.file_url)throw new Error("Documento nÃ£o possui arquivo");const x=await fetch(f.file_url);if(!x.ok)throw new Error("Erro ao baixar arquivo");const s=await x.blob(),g=window.URL.createObjectURL(s),v=document.createElement("a");return v.href=g,v.download=f.file_name||`document_${f.id}.${i(f.file_type||"")}`,document.body.appendChild(v),v.click(),document.body.removeChild(v),window.URL.revokeObjectURL(g),{success:!0}}catch(x){return d.value=x.message,{success:!1,error:x.message}}},a=async f=>{p.value=!0,d.value=null;try{const{data:x,error:s}=await q.from("documents").select("*").eq("user_id",f);if(s)throw s;if(!x||x.length===0)throw new Error("Nenhum documento encontrado para backup");const g=x.filter(o=>o.file_url);if(g.length===0)throw new Error("Nenhum documento com arquivo encontrado para backup");let v=0,u=0;for(const o of g)try{v>0&&await new Promise(R=>setTimeout(R,500));const t=await fetch(o.file_url);if(!t.ok){u++;continue}const r=await t.blob(),b=window.URL.createObjectURL(r),k=document.createElement("a");k.href=b;const E=i(o.file_type||""),S=o.title.replace(/[^a-z0-9]/gi,"_"),F=o.created_at.split("T")[0];k.download=`${S}_${o.type}_${F}.${E}`,document.body.appendChild(k),k.click(),document.body.removeChild(k),window.URL.revokeObjectURL(b),v++}catch(t){console.error("Error downloading document:",o.id,t),u++}if(v===0)throw new Error("Nenhum arquivo foi baixado com sucesso");return{success:!0,message:`Backup concluÃ­do: ${v} arquivo(s) baixado(s)${u>0?`, ${u} falhou`:""}`}}catch(x){return d.value=x.message,{success:!1,error:x.message}}finally{p.value=!1}},i=f=>({"image/jpeg":"jpg","image/jpg":"jpg","image/png":"png","image/gif":"gif","image/webp":"webp","application/pdf":"pdf","application/msword":"doc","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"docx"})[f]||"file";return{isBackingUp:p,error:d,downloadDocument:m,backupAllDocuments:a}}function ge(){const p=C({granted:!1,denied:!1,prompt:!0}),d=C(!1),m=C(null);async function a(){try{if(!navigator.permissions)return p.value;const s=await navigator.permissions.query({name:"camera"});return p.value={granted:s.state==="granted",denied:s.state==="denied",prompt:s.state==="prompt"},s.onchange=()=>{p.value={granted:s.state==="granted",denied:s.state==="denied",prompt:s.state==="prompt"}},p.value}catch(s){return console.error("Error checking camera permission:",s),p.value}}async function i(){try{if(d.value=!0,m.value=null,/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&"mediaDevices"in navigator){const g=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1});p.value.granted=!0,p.value.denied=!1,p.value.prompt=!1;const v=document.createElement("video");v.srcObject=g,v.play(),await new Promise(t=>{v.onloadedmetadata=t});const u=document.createElement("canvas");return u.width=v.videoWidth,u.height=v.videoHeight,u.getContext("2d")?.drawImage(v,0,0),g.getTracks().forEach(t=>t.stop()),new Promise(t=>{u.toBlob(r=>{if(r){const b=new File([r],`photo_${Date.now()}.jpg`,{type:"image/jpeg"});t(b)}},"image/jpeg",.9)})}else return await f()}catch(s){return console.error("Camera capture error:",s),s.name==="NotAllowedError"?(m.value="PermissÃ£o da cÃ¢mera negada",p.value.denied=!0,p.value.granted=!1):s.name==="NotFoundError"?m.value="CÃ¢mera nÃ£o encontrada":m.value="Erro ao acessar a cÃ¢mera",null}finally{d.value=!1}}async function f(){return new Promise(s=>{const g=document.createElement("input");g.type="file",g.accept="image/*",g.onchange=v=>{const u=v.target.files?.[0];s(u||null)},g.oncancel=()=>{s(null)},g.click()})}function x(){const s=navigator.userAgent.toLowerCase();return s.includes("chrome")?"Chrome: Clique no Ã­cone de cÃ¢mera na barra de endereÃ§o e permita o acesso.":s.includes("firefox")?"Firefox: Clique no Ã­cone de permissÃµes ao lado do endereÃ§o e permita a cÃ¢mera.":s.includes("safari")?"Safari: VÃ¡ em ConfiguraÃ§Ãµes > Safari > CÃ¢mera e permita para este site.":"Permita o acesso Ã  cÃ¢mera nas configuraÃ§Ãµes do seu navegador."}return{permissionState:p,isCapturing:d,error:m,checkPermission:a,capturePhoto:i,selectFromGallery:f,showPermissionHelp:x}}async function ye(p,d={}){const{maxWidth:m=1920,maxHeight:a=1920,quality:i=.8,mimeType:f="image/jpeg"}=d;return new Promise((x,s)=>{const g=new FileReader;g.onload=v=>{const u=new Image;u.onload=()=>{let{width:o,height:t}=u;if(o>m||t>a){const k=Math.min(m/o,a/t);o*=k,t*=k}const r=document.createElement("canvas");r.width=o,r.height=t;const b=r.getContext("2d");if(!b){s(new Error("Failed to get canvas context"));return}b.drawImage(u,0,0,o,t),r.toBlob(k=>{if(!k){s(new Error("Failed to compress image"));return}const E=new File([k],p.name,{type:f,lastModified:Date.now()});x(E)},f,i)},u.onerror=()=>s(new Error("Failed to load image")),u.src=v.target?.result},g.onerror=()=>s(new Error("Failed to read file")),g.readAsDataURL(p)})}const be={class:"space-y-4"},he={class:"flex justify-center"},ke={class:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center"},_e={class:"text-center"},we={class:"text-gray-600 dark:text-gray-400 mb-4"},$e={class:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 text-left"},Ce={class:"text-sm text-gray-600 dark:text-gray-400"},Pe={key:0,class:"bg-danger/10 border border-danger/20 rounded-lg p-3"},Ee={class:"flex space-x-2"},Ue=D({__name:"PermissionModal",props:ae({type:{},denied:{type:Boolean,default:!1},helpText:{default:""}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:ae(["allow"],["update:modelValue"]),setup(p,{emit:d}){const m=p,a=Q(p,"modelValue"),i=d,f=m.type==="camera"?"PermissÃ£o de CÃ¢mera":"PermissÃ£o de LocalizaÃ§Ã£o",x=m.type==="camera"?"fas fa-camera":"fas fa-map-marker-alt",s=m.type==="camera"?"Precisamos de acesso Ã  cÃ¢mera para tirar fotos dos documentos.":"Precisamos de acesso Ã  sua localizaÃ§Ã£o para mostrar documentos prÃ³ximos.",g=()=>{i("allow"),m.denied||(a.value=!1)};return(v,u)=>(c(),A(K,{modelValue:a.value,"onUpdate:modelValue":u[1]||(u[1]=o=>a.value=o),title:_(f),maxWidth:"md"},{footer:w(()=>[e("div",Ee,[$(V,{variant:"outline",onClick:u[0]||(u[0]=o=>a.value=!1),class:"flex-1"},{default:w(()=>[...u[4]||(u[4]=[P(" Cancelar ",-1)])]),_:1}),$(V,{variant:"primary",onClick:g,class:"flex-1",disabled:p.denied},{default:w(()=>[P(n(p.denied?"Negado":"Permitir"),1)]),_:1},8,["disabled"])])]),default:w(()=>[e("div",be,[e("div",he,[e("div",ke,[e("i",{class:N([_(x),"text-3xl text-primary"])},null,2)])]),e("div",_e,[e("p",we,n(_(s)),1),e("div",$e,[u[2]||(u[2]=e("h4",{class:"font-medium text-sm text-gray-900 dark:text-dark-text mb-2"}," Como permitir: ",-1)),e("p",Ce,n(p.helpText),1)])]),p.denied?(c(),y("div",Pe,[...u[3]||(u[3]=[e("div",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-exclamation-triangle text-danger mt-0.5"}),e("div",{class:"flex-1 text-sm text-danger"},[e("p",{class:"font-medium"},"PermissÃ£o Negada"),e("p",{class:"mt-1"},"VocÃª precisarÃ¡ permitir manualmente nas configuraÃ§Ãµes do navegador.")])],-1)])])):M("",!0)])]),_:1},8,["modelValue","title"]))}}),Ve={class:"relative inline-block"},Me=["src","alt"],Te={key:1,class:"text-3xl font-bold text-gray-600 dark:text-gray-400"},Ne={key:0,class:"absolute inset-0 bg-white/90 dark:bg-dark-bg/90 rounded-full flex items-center justify-center"},Se=D({__name:"ProfilePhotoUpload",setup(p){const d=H(),{capturePhoto:m,selectFromGallery:a,permissionState:i,showPermissionHelp:f,checkPermission:x}=ge(),{success:s,error:g}=J(),v=C(!1),u=C(!1),o=C(!1),t=U(()=>d.profile?.avatar_url),r=U(()=>d.profile?.full_name||"User"),b=U(()=>r.value.split(" ").map(h=>h[0]).slice(0,2).join("").toUpperCase()),k=U(()=>f()),E=()=>{v.value=!0},S=async()=>{if(v.value=!1,await x(),i.value.denied){u.value=!0;return}if(i.value.prompt){u.value=!0;return}await L(!0)},F=async()=>{v.value=!1,await L(!1)},R=async()=>{await L(!0)},L=async h=>{try{o.value=!0;const l=h?await m():await a();if(!l){o.value=!1;return}const O=await ye(l,{maxWidth:500,maxHeight:500,quality:.8}),ee=`avatar_${d.user?.id}_${Date.now()}.jpg`,{error:te}=await q.storage.from("profiles").upload(ee,O,{upsert:!0});if(te)throw te;const{data:ne}=q.storage.from("profiles").getPublicUrl(ee),se=await d.updateProfile({avatar_url:ne.publicUrl});if(se.success)s("Foto de perfil atualizada!");else throw new Error(se.error)}catch(l){console.error("Upload error:",l),g(l.message||"Erro ao fazer upload da foto")}finally{o.value=!1}},T=async()=>{v.value=!1;try{o.value=!0;const h=await d.updateProfile({avatar_url:""});if(h.success)s("Foto de perfil removida!");else throw new Error(h.error)}catch(h){g(h.message||"Erro ao remover foto")}finally{o.value=!1}};return(h,l)=>(c(),y("div",Ve,[e("div",{class:"w-24 h-24 rounded-full overflow-hidden bg-gray-200 dark:bg-gray-700 flex items-center justify-center cursor-pointer group",onClick:E},[t.value?(c(),y("img",{key:0,src:t.value,alt:r.value,class:"w-full h-full object-cover"},null,8,Me)):(c(),y("span",Te,n(b.value),1)),l[4]||(l[4]=e("div",{class:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"},[e("i",{class:"fas fa-camera text-white text-2xl"})],-1))]),e("button",{class:"absolute bottom-0 right-0 w-8 h-8 bg-primary text-white rounded-full flex items-center justify-center shadow-lg hover:bg-primary-dark transition-colors",onClick:Y(E,["stop"]),"aria-label":"Alterar foto"},[...l[5]||(l[5]=[e("i",{class:"fas fa-camera text-sm"},null,-1)])]),o.value?(c(),y("div",Ne,[...l[6]||(l[6]=[e("div",{class:"spinner"},null,-1)])])):M("",!0),(c(),A(ie,{to:"body"},[$(re,{name:"fade"},{default:w(()=>[v.value?(c(),y("div",{key:0,class:"fixed inset-0 bg-black/50 z-50 flex items-end md:items-center justify-center p-4",onClick:l[2]||(l[2]=O=>v.value=!1)},[e("div",{class:"bg-white dark:bg-dark-card rounded-t-xl md:rounded-xl w-full max-w-sm p-4 space-y-2",onClick:l[1]||(l[1]=Y(()=>{},["stop"]))},[l[11]||(l[11]=e("h3",{class:"font-bold text-lg mb-4 text-center"},"Alterar Foto de Perfil",-1)),$(V,{variant:"outline","full-width":"",onClick:S,disabled:o.value},{default:w(()=>[...l[7]||(l[7]=[e("i",{class:"fas fa-camera mr-2"},null,-1),P(" Tirar Foto ",-1)])]),_:1},8,["disabled"]),$(V,{variant:"outline","full-width":"",onClick:F,disabled:o.value},{default:w(()=>[...l[8]||(l[8]=[e("i",{class:"fas fa-images mr-2"},null,-1),P(" Escolher da Galeria ",-1)])]),_:1},8,["disabled"]),t.value?(c(),A(V,{key:0,variant:"outline","full-width":"",onClick:T,disabled:o.value,class:"text-danger"},{default:w(()=>[...l[9]||(l[9]=[e("i",{class:"fas fa-trash mr-2"},null,-1),P(" Remover Foto ",-1)])]),_:1},8,["disabled"])):M("",!0),$(V,{variant:"secondary","full-width":"",onClick:l[0]||(l[0]=O=>v.value=!1)},{default:w(()=>[...l[10]||(l[10]=[P(" Cancelar ",-1)])]),_:1})])])):M("",!0)]),_:1})])),$(Ue,{modelValue:u.value,"onUpdate:modelValue":l[3]||(l[3]=O=>u.value=O),type:"camera",denied:_(i).denied,helpText:k.value,onAllow:R},null,8,["modelValue","denied","helpText"])]))}}),Re=le(Se,[["__scopeId","data-v-ff90dd30"]]),je={class:"space-y-4"},Ae={class:"grid md:grid-cols-3 gap-4"},De=D({__name:"SubscriptionPlansModal",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:["update:modelValue"],setup(p){const d=Q(p,"modelValue"),m=H(),{success:a}=J(),i=U(()=>m.profile?.plan||"free"),f=x=>{a(`Funcionalidade de pagamento em breve para o plano ${x}!`),d.value=!1};return(x,s)=>(c(),A(K,{modelValue:d.value,"onUpdate:modelValue":s[3]||(s[3]=g=>d.value=g),title:"Planos de SubscriÃ§Ã£o",maxWidth:"lg"},{default:w(()=>[e("div",je,[s[12]||(s[12]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400 mb-6"}," Escolha o plano que melhor se adapta Ã s suas necessidades. Economize mais com planos de longo prazo! ",-1)),e("div",Ae,[e("div",{class:N(["border-2 rounded-xl p-6 transition-all hover:shadow-lg",i.value==="monthly"?"border-primary bg-primary/5":"border-gray-200 dark:border-gray-700"])},[s[4]||(s[4]=e("div",{class:"text-center mb-4"},[e("h3",{class:"text-xl font-bold text-gray-900 dark:text-dark-text"},"Mensal"),e("p",{class:"text-3xl font-bold text-gray-900 dark:text-dark-text mt-2"},"10 MZN"),e("p",{class:"text-sm text-gray-500"},"por mÃªs")],-1)),s[5]||(s[5]=e("ul",{class:"space-y-3 mb-6 text-sm"},[e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",null,"Uploads ilimitados")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",null,"Sem anÃºncios")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",null,"Busca avanÃ§ada")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",null,"NotificaÃ§Ãµes push")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",null,"Suporte prioritÃ¡rio")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",null,"Backup automÃ¡tico")])],-1)),$(V,{variant:"primary","full-width":"",onClick:s[0]||(s[0]=g=>f("monthly")),disabled:i.value==="monthly"},{default:w(()=>[P(n(i.value==="monthly"?"Plano Atual":"Selecionar"),1)]),_:1},8,["disabled"])],2),e("div",{class:N(["border-2 rounded-xl p-6 relative transition-all hover:shadow-lg",i.value==="quarterly"?"border-primary bg-primary/5":"border-primary"])},[s[6]||(s[6]=e("div",{class:"absolute -top-3 left-1/2 transform -translate-x-1/2"},[e("span",{class:"bg-primary text-white px-4 py-1 rounded-full text-xs font-bold"}," POPULAR ")],-1)),s[7]||(s[7]=e("div",{class:"text-center mb-4"},[e("h3",{class:"text-xl font-bold text-primary"},"Trimestral"),e("p",{class:"text-3xl font-bold text-gray-900 dark:text-dark-text mt-2"},"27 MZN"),e("p",{class:"text-sm text-gray-500"},"a cada 3 meses"),e("p",{class:"text-xs text-success font-semibold mt-1"},"Economize 10%")],-1)),s[8]||(s[8]=e("ul",{class:"space-y-3 mb-6 text-sm"},[e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-primary mt-1"}),e("span",{class:"font-medium"},"Uploads ilimitados")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-primary mt-1"}),e("span",{class:"font-medium"},"Sem anÃºncios")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-primary mt-1"}),e("span",{class:"font-medium"},"Busca avanÃ§ada")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-primary mt-1"}),e("span",{class:"font-medium"},"NotificaÃ§Ãµes push")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-primary mt-1"}),e("span",{class:"font-medium"},"Suporte prioritÃ¡rio")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-primary mt-1"}),e("span",{class:"font-medium"},"Backup automÃ¡tico")])],-1)),$(V,{variant:"primary","full-width":"",onClick:s[1]||(s[1]=g=>f("quarterly")),disabled:i.value==="quarterly"},{default:w(()=>[P(n(i.value==="quarterly"?"Plano Atual":"Selecionar"),1)]),_:1},8,["disabled"])],2),e("div",{class:N(["border-2 rounded-xl p-6 transition-all hover:shadow-lg",i.value==="annual"?"border-success bg-success/5":"border-success"])},[s[9]||(s[9]=e("div",{class:"absolute -top-3 left-1/2 transform -translate-x-1/2"},[e("span",{class:"bg-success text-white px-4 py-1 rounded-full text-xs font-bold"}," MELHOR VALOR ")],-1)),s[10]||(s[10]=e("div",{class:"text-center mb-4 mt-2"},[e("h3",{class:"text-xl font-bold text-success"},"Anual"),e("p",{class:"text-3xl font-bold text-gray-900 dark:text-dark-text mt-2"},"96 MZN"),e("p",{class:"text-sm text-gray-500"},"por ano"),e("p",{class:"text-xs text-success font-semibold mt-1"},"Economize 20%")],-1)),s[11]||(s[11]=e("ul",{class:"space-y-3 mb-6 text-sm"},[e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",{class:"font-medium"},"Uploads ilimitados")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",{class:"font-medium"},"Sem anÃºncios")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",{class:"font-medium"},"Busca avanÃ§ada")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",{class:"font-medium"},"NotificaÃ§Ãµes push")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",{class:"font-medium"},"Suporte prioritÃ¡rio")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",{class:"font-medium"},"Backup automÃ¡tico")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-star text-warning-dark mt-1"}),e("span",{class:"font-medium text-warning-dark"},"2 meses grÃ¡tis")])],-1)),$(V,{variant:"success","full-width":"",onClick:s[2]||(s[2]=g=>f("annual")),disabled:i.value==="annual"},{default:w(()=>[P(n(i.value==="annual"?"Plano Atual":"Selecionar"),1)]),_:1},8,["disabled"])],2)]),s[13]||(s[13]=e("div",{class:"mt-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg text-center"},[e("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," ðŸ’³ Aceitamos M-Pesa, CartÃ£o de CrÃ©dito e TransferÃªncia BancÃ¡ria ")],-1))])]),_:1},8,["modelValue"]))}}),Fe={class:"space-y-6"},Le={class:"card bg-gradient-to-br from-primary/10 to-primary/5 border border-primary/20"},Oe={class:"text-center mb-4"},Be={class:"text-5xl mb-2"},Ie={class:"text-2xl font-bold text-gray-900 dark:text-dark-text"},ze={class:"text-sm text-gray-600 dark:text-gray-400"},qe={class:"text-center mb-4"},He={class:"text-4xl font-bold text-primary"},Xe={key:0,class:"space-y-2"},We={class:"flex justify-between text-sm"},Ge={class:"font-semibold"},Ze={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3"},Ye={class:"text-xs text-gray-600 dark:text-gray-400 text-center"},Qe={key:1,class:"text-center text-sm text-success font-semibold"},Je={class:"card"},Ke={class:"space-y-2"},et={class:"text-sm text-gray-600 dark:text-gray-400"},tt={class:"text-sm font-semibold text-primary"},st={class:"card"},at={class:"flex items-center justify-between mb-4"},rt=["disabled"],ot={key:0,class:"text-center py-6 text-gray-500"},lt={key:1,class:"text-center py-6 text-gray-500"},nt={key:2,class:"space-y-2"},it={class:"flex-shrink-0 w-8 text-center"},dt={key:0,class:"text-2xl"},ct={key:1,class:"text-2xl"},ut={key:2,class:"text-2xl"},mt={key:3,class:"text-lg font-semibold text-gray-500"},ft=["src","alt"],pt={class:"flex-1 min-w-0"},xt={class:"font-semibold text-gray-900 dark:text-dark-text truncate"},vt={key:0,class:"text-xs text-primary ml-1"},gt={class:"text-xs text-gray-500"},yt={class:"flex-shrink-0 text-right"},bt={class:"font-bold text-primary"},ht=D({__name:"RankingsSection",props:{userPoints:{},currentUserId:{}},setup(p){const d=p,m=C([]),a=C(!1),i=U(()=>{const t=B(d.userPoints);return G(t)}),f=U(()=>{const t=B(d.userPoints),r=Z(t);return r?G(r.rank):null}),x=U(()=>{const t=B(d.userPoints),r=Z(t);return r?r.pointsNeeded:0}),s=U(()=>{const t=B(d.userPoints),r=Z(t);if(!r)return 100;const b=v(t),k=r.pointsNeeded+b,E=d.userPoints-b,S=k-b;return Math.min(Math.round(E/S*100),100)}),g=U(()=>({documentMatch:{label:"Match de documento",points:j.DOCUMENT_MATCH},reportDocument:{label:"Reportar documento",points:j.REPORT_DOCUMENT},verifyDocument:{label:"Verificar documento",points:j.VERIFY_DOCUMENT},helpOthers:{label:"Ajudar outros usuÃ¡rios",points:j.HELP_OTHERS},completeProfile:{label:"Completar perfil",points:j.COMPLETE_PROFILE},dailyLogin:{label:"Login diÃ¡rio",points:j.DAILY_LOGIN}})),v=t=>({bronze:0,silver:100,gold:500,platinum:1e3})[t]||0,u=t=>{const r=B(t);return G(r)?.name||"Bronze"},o=async()=>{a.value=!0;try{const{data:t,error:r}=await q.from("user_profiles").select("id, full_name, points, avatar_url").order("points",{ascending:!1}).limit(10);if(r)throw r;m.value=t||[]}catch(t){console.error("Erro ao carregar leaderboard:",t)}finally{a.value=!1}};return oe(()=>{o()}),(t,r)=>(c(),y("div",Fe,[e("div",Le,[e("div",Oe,[e("div",Be,n(i.value.icon),1),e("h3",Ie,n(i.value.name),1),e("p",ze,n(i.value.description),1)]),e("div",qe,[e("p",He,n(p.userPoints),1),r[0]||(r[0]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"pontos",-1))]),f.value?(c(),y("div",Xe,[e("div",We,[r[1]||(r[1]=e("span",{class:"text-gray-600 dark:text-gray-400"},"PrÃ³ximo nÃ­vel:",-1)),e("span",Ge,n(f.value.name)+" "+n(f.value.icon),1)]),e("div",Ze,[e("div",{class:"bg-gradient-to-r from-primary to-primary-dark h-3 rounded-full transition-all duration-500",style:de({width:`${s.value}%`})},null,4)]),e("p",Ye," Faltam "+n(x.value)+" pontos para o prÃ³ximo nÃ­vel ",1)])):(c(),y("div",Qe," ðŸŽ‰ VocÃª atingiu o nÃ­vel mÃ¡ximo! "))]),e("div",Je,[r[2]||(r[2]=e("h4",{class:"font-semibold text-gray-900 dark:text-dark-text mb-3"}," Como ganhar pontos? ",-1)),e("div",Ke,[(c(!0),y(I,null,z(g.value,(b,k)=>(c(),y("div",{key:k,class:"flex items-center justify-between"},[e("span",et,n(b.label),1),e("span",tt,"+"+n(b.points),1)]))),128))])]),e("div",st,[e("div",at,[r[4]||(r[4]=e("h4",{class:"font-semibold text-gray-900 dark:text-dark-text"}," ðŸ† Top UsuÃ¡rios ",-1)),e("button",{onClick:o,class:"text-sm text-primary hover:underline",disabled:a.value},[e("i",{class:N(["fas fa-sync-alt",{"fa-spin":a.value}])},null,2),r[3]||(r[3]=P(" Atualizar ",-1))],8,rt)]),a.value?(c(),y("div",ot," Carregando ranking... ")):m.value.length===0?(c(),y("div",lt," Nenhum usuÃ¡rio no ranking ainda ")):(c(),y("div",nt,[(c(!0),y(I,null,z(m.value,(b,k)=>(c(),y("div",{key:b.id,class:N(["flex items-center space-x-3 p-3 rounded-lg transition-colors",b.id===p.currentUserId?"bg-primary/10 border border-primary/30":"hover:bg-gray-50 dark:hover:bg-gray-800"])},[e("div",it,[k===0?(c(),y("span",dt,"ðŸ¥‡")):k===1?(c(),y("span",ct,"ðŸ¥ˆ")):k===2?(c(),y("span",ut,"ðŸ¥‰")):(c(),y("span",mt,n(k+1),1))]),e("img",{src:b.avatar_url||"https://placehold.co/48x48",alt:b.full_name,class:"w-12 h-12 rounded-full object-cover"},null,8,ft),e("div",pt,[e("p",xt,[P(n(b.full_name||"UsuÃ¡rio")+" ",1),b.id===p.currentUserId?(c(),y("span",vt,"(VocÃª)")):M("",!0)]),e("p",gt,n(u(b.points||0)),1)]),e("div",yt,[e("p",bt,n(b.points||0),1),r[5]||(r[5]=e("p",{class:"text-xs text-gray-500"},"pontos",-1))])],2))),128))]))])]))}}),kt={key:0,class:"text-xs text-red-500 mt-1"},_t={class:"flex"},wt={key:0,class:"text-xs text-red-500 mt-1"},$t={class:"text-xs text-gray-500 mt-1"},Ct={key:0,class:"text-xs text-red-500 mt-1"},Pt={key:0,class:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg"},Et={class:"text-sm text-red-600 dark:text-red-400"},Ut={key:1,class:"p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg"},Vt={class:"text-sm text-green-600 dark:text-green-400"},Mt={class:"flex space-x-3"},Tt=D({__name:"ProfileEditModal",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:["update:modelValue"],setup(p){const d=Q(p,"modelValue"),m=H(),a=C({full_name:"",phone_number:"",delivery_address:""}),i=C({}),f=C(""),x=C(""),s=C(!1);ce(d,o=>{o&&m.profile&&(a.value={full_name:m.profile.full_name||"",phone_number:m.profile.phone_number?.replace("+258","")||"",delivery_address:m.profile.delivery_address||""},i.value={},f.value="",x.value="")});const g=U(()=>a.value.full_name.length>=3&&a.value.phone_number.length===9&&/^[0-9]{9}$/.test(a.value.phone_number)&&(a.value.delivery_address?.length||0)<=200),v=()=>{i.value={};let o=!0;return a.value.full_name.length<3&&(i.value.full_name="Nome deve ter pelo menos 3 caracteres",o=!1),/^[0-9]{9}$/.test(a.value.phone_number)||(i.value.phone_number="Telefone deve ter 9 dÃ­gitos",o=!1),(a.value.delivery_address?.length||0)>200&&(i.value.delivery_address="EndereÃ§o deve ter no mÃ¡ximo 200 caracteres",o=!1),o},u=async()=>{if(f.value="",x.value="",!v()){f.value="Por favor, corrija os erros no formulÃ¡rio";return}s.value=!0;try{let o={full_name:a.value.full_name,phone_number:`+258${a.value.phone_number}`};a.value.delivery_address&&(o.delivery_address=a.value.delivery_address);const t=await m.updateProfile(o);if(t.success)x.value="Perfil atualizado com sucesso!",setTimeout(()=>{d.value=!1},1500);else if(t.error?.includes("delivery_address")||t.error?.includes("column")){console.warn("Campo delivery_address nÃ£o existe, tentando sem ele...");const r={full_name:a.value.full_name,phone_number:`+258${a.value.phone_number}`},b=await m.updateProfile(r);b.success?(x.value="Perfil atualizado! (EndereÃ§o nÃ£o salvo - execute a migraÃ§Ã£o do banco)",setTimeout(()=>{d.value=!1},2e3)):f.value=b.error||"Erro ao atualizar perfil"}else f.value=t.error||"Erro ao atualizar perfil"}catch(o){f.value=o.message||"Erro inesperado ao atualizar perfil"}finally{s.value=!1}};return(o,t)=>(c(),A(K,{modelValue:d.value,"onUpdate:modelValue":t[4]||(t[4]=r=>d.value=r),title:"Editar Perfil",maxWidth:"lg"},{footer:w(()=>[e("div",Mt,[$(V,{variant:"secondary","full-width":"",onClick:t[3]||(t[3]=r=>d.value=!1),disabled:s.value},{default:w(()=>[...t[12]||(t[12]=[P(" Cancelar ",-1)])]),_:1},8,["disabled"]),$(V,{variant:"primary","full-width":"",onClick:u,loading:s.value,disabled:!g.value},{default:w(()=>[...t[13]||(t[13]=[P(" Salvar AlteraÃ§Ãµes ",-1)])]),_:1},8,["loading","disabled"])])]),default:w(()=>[e("form",{onSubmit:Y(u,["prevent"]),class:"space-y-4"},[e("div",null,[t[5]||(t[5]=e("label",{for:"fullName",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Nome Completo * ",-1)),X(e("input",{id:"fullName","onUpdate:modelValue":t[0]||(t[0]=r=>a.value.full_name=r),type:"text",required:"",minlength:"3",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-dark-card dark:text-dark-text",placeholder:"Digite seu nome completo"},null,512),[[W,a.value.full_name]]),i.value.full_name?(c(),y("p",kt,n(i.value.full_name),1)):M("",!0)]),e("div",null,[t[7]||(t[7]=e("label",{for:"phoneNumber",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Telefone Celular * ",-1)),e("div",_t,[t[6]||(t[6]=e("span",{class:"inline-flex items-center px-3 text-sm text-gray-900 bg-gray-200 border border-r-0 border-gray-300 rounded-l-lg dark:bg-gray-600 dark:text-gray-400 dark:border-gray-600"}," +258 ",-1)),X(e("input",{id:"phoneNumber","onUpdate:modelValue":t[1]||(t[1]=r=>a.value.phone_number=r),type:"tel",required:"",pattern:"[0-9]{9}",maxlength:"9",class:"rounded-none rounded-r-lg flex-1 min-w-0 px-4 py-2 border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-dark-card dark:text-dark-text",placeholder:"XX XXX XXXX"},null,512),[[W,a.value.phone_number]])]),t[8]||(t[8]=e("p",{class:"text-xs text-gray-500 mt-1"},"Formato: 9 dÃ­gitos (ex: 841234567)",-1)),i.value.phone_number?(c(),y("p",wt,n(i.value.phone_number),1)):M("",!0)]),e("div",null,[t[9]||(t[9]=e("label",{for:"deliveryAddress",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," EndereÃ§o para Entrega de Documentos ",-1)),X(e("textarea",{id:"deliveryAddress","onUpdate:modelValue":t[2]||(t[2]=r=>a.value.delivery_address=r),rows:"3",maxlength:"200",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-dark-card dark:text-dark-text resize-none",placeholder:"Rua, bairro, cidade... (opcional)"},null,512),[[W,a.value.delivery_address]]),e("p",$t,n(a.value.delivery_address?.length||0)+"/200 caracteres ",1),i.value.delivery_address?(c(),y("p",Ct,n(i.value.delivery_address),1)):M("",!0)]),f.value?(c(),y("div",Pt,[e("p",Et,[t[10]||(t[10]=e("i",{class:"fas fa-exclamation-circle mr-1"},null,-1)),P(" "+n(f.value),1)])])):M("",!0),x.value?(c(),y("div",Ut,[e("p",Vt,[t[11]||(t[11]=e("i",{class:"fas fa-check-circle mr-1"},null,-1)),P(" "+n(x.value),1)])])):M("",!0)],32)]),_:1},8,["modelValue"]))}}),Nt={class:"px-4 py-6 space-y-6"},St={class:"card text-center"},Rt={class:"flex justify-center mb-4"},jt={class:"text-xl font-bold text-gray-900 dark:text-dark-text mb-1"},At={class:"text-gray-600 dark:text-gray-400 mb-4"},Dt={class:"grid grid-cols-3 gap-4 pt-4 border-t border-gray-200 dark:border-dark-border"},Ft={class:"text-2xl font-bold text-primary"},Lt={class:"text-xs text-gray-500"},Ot={class:"text-2xl font-bold text-success"},Bt={class:"text-xs text-gray-500"},It={class:"text-xs text-gray-500 capitalize"},zt={key:0,class:"mt-6"},qt={class:"card divide-y divide-gray-200 dark:divide-dark-border"},Ht=["onClick"],Xt={class:"flex items-center space-x-3"},Wt={class:"text-gray-900 dark:text-dark-text"},Gt={class:"text-center text-sm text-gray-500"},Zt={class:"card mt-6"},Yt={class:"flex items-center justify-between mb-3"},Qt={class:"text-lg font-semibold text-gray-900 dark:text-dark-text"},Jt={class:"flex items-center space-x-2"},Kt={key:0,class:"text-gray-500"},es={key:1,class:"text-red-500"},ts={key:2,class:"text-gray-500"},ss={key:3,class:"space-y-3"},as={class:"min-w-0"},rs={class:"font-medium text-gray-900 dark:text-dark-text truncate"},os={class:"text-xs text-gray-500 capitalize"},ls={class:"text-xs text-gray-400"},ns=D({__name:"ProfileView",setup(p){const d=ue(),m=H(),{t:a}=me(),{success:i,error:f}=J(),{items:x,loading:s,error:g,fetchMyDocuments:v}=pe(),{backupAllDocuments:u}=ve(),o=C(!1),t=C(!1),r=C(!1),b=C(!1),k=U(()=>m.user),E=U(()=>m.profile),S=()=>{r.value=!r.value},F=async()=>{if(!m.userId)return;const T=await u(m.userId);T.success?i(T.message||a("profile.backupSuccess")):f(T.error||a("profile.backupError"))},R=async()=>{o.value=!0;const T=await m.signOut();o.value=!1,T.success&&(i(a("auth.logoutSuccess")),d.push("/login"))},L=U(()=>[{icon:"fas fa-user-edit",label:a("profile.menu.editProfile"),action:()=>b.value=!0},{icon:"fas fa-file-alt",label:a("profile.menu.myDocuments"),action:()=>d.push("/documents")},{icon:"fas fa-crown",label:a("profile.menu.subscriptionPlans"),action:()=>t.value=!0},{icon:"fas fa-bell",label:a("profile.menu.notifications"),action:()=>d.push("/notifications")},{icon:"fas fa-lock",label:a("profile.menu.privacy"),action:()=>{i(a("profile.featureSoon"))}},{icon:"fas fa-question-circle",label:a("profile.menu.help"),action:()=>{i(a("profile.featureSoon"))}},{icon:"fas fa-download",label:a("profile.menu.backup"),action:F},{icon:"fas fa-cog",label:a("profile.menu.settings"),action:()=>{i(a("profile.featureSoon"))}},{icon:"fas fa-sign-out-alt",label:a("profile.menu.logout"),action:R}]);return oe(async()=>{m.user?.id&&await v(m.user.id)}),(T,h)=>(c(),A(xe,null,{default:w(()=>[e("div",Nt,[e("div",St,[e("div",Rt,[$(Re)]),e("h2",jt,n(E.value?.full_name||_(a)("profile.user")),1),e("p",At,n(k.value?.email),1),e("div",Dt,[e("div",null,[e("p",Ft,n(E.value?.document_count||0),1),e("p",Lt,n(_(a)("profile.documents")),1)]),e("div",{class:"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg p-2 -m-2 transition-colors",onClick:S},[e("p",Ot,n(E.value?.points||0),1),e("p",Bt,[P(n(_(a)("profile.points"))+" ",1),e("i",{class:N(["fas fa-chevron-down ml-1 text-xs",{"rotate-180":r.value}])},null,2)])]),e("div",null,[h[4]||(h[4]=e("p",{class:"text-2xl font-bold text-warning-dark"},[e("i",{class:"fas fa-crown"})],-1)),e("p",It,n(E.value?.plan?_(a)(`profile.plans.${E.value.plan}`):_(a)("profile.plans.free")),1)])])]),$(re,{name:"slide-fade"},{default:w(()=>[r.value?(c(),y("div",zt,[$(ht,{"user-points":E.value?.points||0,"current-user-id":k.value?.id||""},null,8,["user-points","current-user-id"])])):M("",!0)]),_:1}),e("div",qt,[(c(!0),y(I,null,z(L.value,l=>(c(),y("button",{key:l.label,class:"flex items-center justify-between px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors w-full text-left",onClick:l.action},[e("div",Xt,[e("i",{class:N([l.icon,"text-gray-600 dark:text-gray-400 w-5"])},null,2),e("span",Wt,n(l.label),1)]),h[5]||(h[5]=e("i",{class:"fas fa-chevron-right text-gray-400 text-sm"},null,-1))],8,Ht))),128))]),$(V,{variant:"danger",size:"lg","full-width":"",onClick:R,loading:o.value},{default:w(()=>[h[6]||(h[6]=e("i",{class:"fas fa-sign-out-alt mr-2"},null,-1)),P(" "+n(_(a)("profile.menu.logout")),1)]),_:1},8,["loading"]),e("p",Gt,n(_(a)("profile.version"))+" 0.2.1 ",1)]),$(De,{modelValue:t.value,"onUpdate:modelValue":h[0]||(h[0]=l=>t.value=l)},null,8,["modelValue"]),$(Tt,{modelValue:b.value,"onUpdate:modelValue":h[1]||(h[1]=l=>b.value=l)},null,8,["modelValue"]),e("div",Zt,[e("div",Yt,[e("h3",Qt,n(_(a)("profile.myDocs")),1),e("div",Jt,[e("button",{class:"text-primary text-sm flex items-center space-x-1 hover:underline",onClick:h[2]||(h[2]=l=>_(d).push("/save-document"))},[h[7]||(h[7]=e("i",{class:"fas fa-plus text-xs"},null,-1)),e("span",null,n(_(a)("profile.addDocument")),1)]),e("button",{class:"text-primary text-sm hover:underline",onClick:h[3]||(h[3]=l=>_(d).push("/documents"))},n(_(a)("profile.viewAll")),1)])]),_(s)?(c(),y("div",Kt,n(_(a)("profile.loading")),1)):_(g)?(c(),y("div",es,n(_(g)),1)):_(x).length===0?(c(),y("div",ts,n(_(a)("profile.noDocs")),1)):(c(),y("ul",ss,[(c(!0),y(I,null,z(_(x).slice(0,3),l=>(c(),y("li",{key:l.id,class:"flex items-center justify-between border border-gray-200 dark:border-dark-border rounded-lg px-3 py-2"},[e("div",as,[e("p",rs,n(l.title),1),e("p",os,n(l.status),1)]),e("span",ls,n(new Date(l.created_at).toLocaleDateString("pt-BR")),1)]))),128))]))]),$(fe)]),_:1}))}}),xs=le(ns,[["__scopeId","data-v-adfb1a1f"]]);export{xs as default};
