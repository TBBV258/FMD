import{a as L,r as b,c as k,b as m,o as c,h as t,Q as j,n as M,t as w,f as V,e as B,u as U,p as E,w as Y,j as X,i as z,k as F,O as A,F as N,s as P,N as q,l as G,R as H,S as Q}from"./vue-vendor-DJ0JNZJp.js";import{u as J,b as O,c as K,a as W,T as Z}from"./index-DomtK_OL.js";import{u as ee}from"./useDocuments-wUpUaVtL.js";import{_ as te}from"./MainLayout.vue_vue_type_script_setup_true_lang-s1TSJ6UG.js";import"./supabase-aQ0K3vAX.js";import"./logofmd-DeXnOIzE.js";const se={class:"flex flex-col items-center"},ae={key:0,class:"w-8 h-8 rounded-full border-2 border-primary border-t-transparent animate-spin"},le={class:"text-xs text-gray-500 mt-1"},ne=L({__name:"PullToRefresh",props:{threshold:{default:80},disabled:{type:Boolean,default:!1}},emits:["refresh"],setup(i,{expose:_,emit:s}){const o=i,$=s,d=b(null),a=b(0),h=b(0),u=b(!1),r=b(!1),p=k(()=>Math.min(a.value/o.threshold,1)),y=x=>{o.disabled||u.value||(window.scrollY===0||d.value&&d.value.scrollTop===0)&&(h.value=x.touches[0].clientY,r.value=!0)},D=x=>{if(!r.value||o.disabled||u.value)return;const g=x.touches[0].clientY-h.value;g>0&&(a.value=Math.min(g*.5,o.threshold*1.5),a.value>10&&x.preventDefault())},T=()=>{if(!r.value||o.disabled){r.value=!1,a.value=0;return}r.value=!1,a.value>o.threshold&&!u.value?(u.value=!0,a.value=o.threshold,$("refresh"),setTimeout(()=>{C()},2e3)):a.value=0},C=()=>{u.value=!1,a.value=0};return _({finishRefresh:C}),(x,S)=>(c(),m("div",{ref_key:"containerRef",ref:d,class:"relative overflow-hidden",onTouchstart:y,onTouchmove:D,onTouchend:T},[t("div",{class:"absolute top-0 left-0 right-0 flex items-center justify-center transition-all duration-200",style:j({height:`${a.value}px`,opacity:p.value})},[t("div",se,[u.value?(c(),m("div",ae)):(c(),m("i",{key:1,class:M(["fas fa-arrow-down text-primary text-xl",{"rotate-180":a.value>i.threshold}]),style:j({transform:`rotate(${Math.min(a.value/i.threshold*180,180)}deg)`})},null,6)),t("span",le,w(a.value>i.threshold?"Solte para atualizar":"Puxe para atualizar"),1)])],4),t("div",{style:j({transform:`translateY(${a.value}px)`,transition:u.value?"transform 0.2s":"none"})},[V(x.$slots,"default")],4)],544))}}),oe=L({__name:"BaseCard",props:{hover:{type:Boolean,default:!1},padding:{default:"md"},clickable:{type:Boolean,default:!1}},emits:["click"],setup(i,{emit:_}){const s=i,o=_,$=k(()=>{const a="card",h=s.hover||s.clickable?"card-hover cursor-pointer":"";return`${a} ${h} ${{none:"p-0",sm:"p-3",md:"p-4",lg:"p-6"}[s.padding]}`}),d=a=>{s.clickable&&o("click",a)};return(a,h)=>(c(),m("div",{class:M($.value),onClick:d},[V(a.$slots,"default")],2))}}),re={key:0,class:"absolute inset-0 pointer-events-none"},ie={key:0,class:"absolute right-0 top-0 bottom-0 w-20 bg-danger/20 flex items-center justify-start px-4"},ue={key:1,class:"absolute left-0 top-0 bottom-0 w-20 bg-success/20 flex items-center justify-end px-4"},ce=L({__name:"SwipeGestures",props:{threshold:{default:100},showIndicators:{type:Boolean,default:!0},enabled:{type:Boolean,default:!0}},emits:["swipeLeft","swipeRight","swipeUp","swipeDown"],setup(i,{emit:_}){const s=i,o=_,$=b(null),d=b(!1),a=b(null),h=b(0),u=b(0),r=b(0),p=b(0),y=b(!1),D=k(()=>"relative touch-pan-y select-none"),T=k(()=>{if(!d.value||!s.enabled)return{};const e=r.value-h.value,l=p.value-u.value;return{transform:`translate(${e}px, ${l}px)`,transition:"none"}}),C=e=>{if(!s.enabled)return;const l=e.touches[0];h.value=l.clientX,u.value=l.clientY,r.value=l.clientX,p.value=l.clientY,d.value=!1},x=e=>{if(!s.enabled)return;const l=e.touches[0];r.value=l.clientX,p.value=l.clientY;const R=Math.abs(r.value-h.value),I=Math.abs(p.value-u.value);(R>10||I>10)&&(d.value=!0,R>I?a.value=r.value>h.value?"right":"left":a.value=p.value>u.value?"down":"up")},S=()=>{if(!s.enabled||!d.value){n();return}const e=r.value-h.value,l=p.value-u.value;Math.abs(e)>s.threshold?e>0?o("swipeRight"):o("swipeLeft"):Math.abs(l)>s.threshold&&(l>0?o("swipeDown"):o("swipeUp")),n()},g=e=>{s.enabled&&(y.value=!0,h.value=e.clientX,u.value=e.clientY,r.value=e.clientX,p.value=e.clientY)},f=e=>{if(!s.enabled||!y.value)return;r.value=e.clientX,p.value=e.clientY;const l=Math.abs(r.value-h.value),R=Math.abs(p.value-u.value);(l>10||R>10)&&(d.value=!0,l>R?a.value=r.value>h.value?"right":"left":a.value=p.value>u.value?"down":"up")},v=()=>{if(!s.enabled||!y.value){y.value=!1,n();return}S(),y.value=!1},n=()=>{setTimeout(()=>{d.value=!1,a.value=null,r.value=h.value,p.value=u.value},200)};return(e,l)=>(c(),m("div",{ref_key:"containerRef",ref:$,class:M(D.value),style:j(T.value),onTouchstart:C,onTouchmove:x,onTouchend:S,onMousedown:g,onMousemove:f,onMouseup:v,onMouseleave:v},[V(e.$slots,"default",{swiping:d.value,direction:a.value}),i.showIndicators&&d.value?(c(),m("div",re,[a.value==="left"?(c(),m("div",ie,[...l[0]||(l[0]=[t("i",{class:"fas fa-times text-danger text-2xl"},null,-1)])])):a.value==="right"?(c(),m("div",ue,[...l[1]||(l[1]=[t("i",{class:"fas fa-check text-success text-2xl"},null,-1)])])):B("",!0)])):B("",!0)],38))}}),de={class:"relative aspect-square bg-gray-200 dark:bg-dark-card"},fe=["src","alt"],ve={key:1,class:"w-full h-full flex items-center justify-center"},he={key:2,class:"absolute inset-0 flex items-center justify-center bg-black/10"},pe={class:"absolute top-3 right-3"},me={class:"absolute top-3 left-3"},be={class:"badge bg-black/50 text-white"},ge={class:"p-4 space-y-2"},ye={class:"font-semibold text-lg text-gray-900 dark:text-dark-text truncate"},xe={class:"flex items-center justify-between text-sm text-gray-500 dark:text-gray-400"},we={class:"flex items-center space-x-1"},ke={class:"flex items-center space-x-1"},_e={class:"flex items-center space-x-2 pt-2"},$e=L({__name:"FeedCard",props:{document:{}},emits:["interested","dismiss","share"],setup(i,{emit:_}){const s=i,o=_,$=U(),d=J(),a=k(()=>({lost:"badge badge-danger",found:"badge bg-orange-500 text-white",matched:"badge bg-purple-500/10 text-purple-500",returned:"badge badge-success"})[s.document.status]||"badge badge-primary"),h=k(()=>({lost:"Perdido",found:"Submetido por utilizador",matched:"Match",returned:"Devolvido",normal:"Normal"})[s.document.status]||s.document.status),u=k(()=>({passport:"fas fa-passport",id_card:"fas fa-id-card",driver_license:"fas fa-id-card-alt",birth_certificate:"fas fa-file-alt",other:"fas fa-file"})[s.document.type]||"fas fa-file"),r=k(()=>({passport:"Passaporte",id_card:"BI",driver_license:"Carta",birth_certificate:"Certidão",other:"Outro"})[s.document.type]||"Documento"),p=k(()=>{const g=new Date,f=new Date(s.document.created_at),v=g.getTime()-f.getTime(),n=Math.floor(v/6e4),e=Math.floor(n/60),l=Math.floor(e/24);return n<1?"Agora":n<60?`${n}m`:e<24?`${e}h`:l<7?`${l}d`:f.toLocaleDateString("pt-BR",{day:"2-digit",month:"short"})}),y=()=>{$.push(`/document/${s.document.id}`)},D=()=>{o("interested",s.document.id)},T=()=>{o("dismiss",s.document.id)},C=()=>{o("interested",s.document.id)},x=()=>{o("share",s.document.id)},S=g=>{const f=g.target;f.style.display="none"};return(g,f)=>(c(),E(ce,{onSwipeLeft:T,onSwipeRight:C,"show-indicators":!0},{default:Y(()=>[X(oe,{padding:"none",hover:"",clickable:"",onClick:y},{default:Y(()=>[t("div",de,[i.document.thumbnail_url||i.document.file_url?(c(),m("img",{key:0,src:i.document.thumbnail_url||i.document.file_url,alt:i.document.title,class:M(["w-full h-full object-cover",z(d).isAuthenticated?"":"blur-md"]),loading:"lazy",onError:S},null,42,fe)):(c(),m("div",ve,[...f[0]||(f[0]=[t("i",{class:"fas fa-file text-gray-400 text-6xl"},null,-1)])])),z(d).isAuthenticated?B("",!0):(c(),m("div",he,[...f[1]||(f[1]=[t("i",{class:"fas fa-lock text-white text-xl drop-shadow-lg"},null,-1)])])),t("div",pe,[t("span",{class:M(a.value)},w(h.value),3)]),t("div",me,[t("span",be,[t("i",{class:M([u.value,"mr-1"])},null,2),F(" "+w(r.value),1)])])]),t("div",ge,[t("h3",ye,w(i.document.title),1),i.document.description?(c(),m("p",{key:0,class:M(["text-sm text-gray-600 dark:text-gray-400 truncate-2",z(d).isAuthenticated?"":"blur-sm select-none"])},w(i.document.description),3)):B("",!0),t("div",xe,[t("div",we,[f[2]||(f[2]=t("i",{class:"fas fa-map-marker-alt"},null,-1)),t("span",null,w(i.document.location||"Não especificado"),1)]),t("div",ke,[f[3]||(f[3]=t("i",{class:"fas fa-clock"},null,-1)),t("span",null,w(p.value),1)])]),t("div",_e,[X(O,{variant:"primary",size:"sm",class:"flex-1",onClick:A(D,["stop"])},{default:Y(()=>[...f[4]||(f[4]=[t("i",{class:"fas fa-hand-paper mr-2"},null,-1),F(" Interessado ",-1)])]),_:1}),X(O,{variant:"outline",size:"sm",onClick:A(x,["stop"])},{default:Y(()=>[...f[5]||(f[5]=[t("i",{class:"fas fa-share-alt"},null,-1)])]),_:1})])])]),_:1})]),_:1}))}}),Me={class:"space-y-4"},Te=L({__name:"FeedSkeleton",props:{count:{default:3}},setup(i){return(_,s)=>(c(),m("div",Me,[(c(!0),m(N,null,P(i.count,o=>(c(),m("div",{key:o,class:"card p-0"},[...s[0]||(s[0]=[q('<div class="skeleton-image"></div><div class="p-4 space-y-3"><div class="skeleton-text w-3/4"></div><div class="skeleton-text w-full"></div><div class="skeleton-text w-1/2"></div><div class="flex items-center justify-between pt-2"><div class="skeleton h-8 w-24 rounded"></div><div class="skeleton h-8 w-8 rounded"></div></div></div>',2)])]))),128))]))}}),Ce={class:"bg-white dark:bg-dark-card border-b border-gray-200 dark:border-dark-border px-4 py-3 sticky top-14 z-10 space-y-3"},Se={class:"flex items-center space-x-2 overflow-x-auto scrollbar-hide"},De=["onClick"],Re={class:"relative"},Ye={class:"sr-only",for:"feed-search"},Be=["placeholder"],Le={class:"px-4 py-4 space-y-4"},Xe={key:0,class:"text-center py-12"},ze={class:"text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2"},Ie={class:"text-gray-500 dark:text-gray-400"},Ae=L({__name:"FeedView",setup(i){const _=U(),{t:s}=K(),{success:o,error:$}=W(),{items:d,loading:a,error:h,fetchPublicFeed:u}=ee(),r=b("all"),p=b(null),y=b(""),D=k(()=>[{label:s("feed.filters.all"),value:"all",icon:"fas fa-th"},{label:s("feed.filters.lost"),value:"lost",icon:"fas fa-search"},{label:s("feed.filters.found"),value:"found",icon:"fas fa-check"}]),T=k(()=>{const v=r.value==="all"?d.value:d.value.filter(e=>e.status===r.value),n=y.value.trim().toLowerCase();return n?v.filter(e=>{const l=e.title?.toLowerCase()||"",R=e.description?.toLowerCase()||"",I=e.type?.toLowerCase?.()||"";return l.includes(n)||R.includes(n)||I.includes(n)}):v}),C=v=>{const n="px-4 py-2 rounded-full text-sm font-medium transition-all whitespace-nowrap";return v===r.value?`${n} bg-primary text-white`:`${n} bg-gray-100 dark:bg-dark-card text-gray-700 dark:text-gray-300`};async function x(){await u(),p.value&&p.value.finishRefresh(),o("Feed atualizado!")}function S(v){_.push(`/document/${v}`),o("Abrindo detalhes do documento...")}function g(v){o("Documento dispensado")}async function f(v){const n=d.value.find(l=>l.id===v);if(!n)return;const e={title:n.title,text:`${n.title} - ${n.description||"Ver documento"}`,url:`${window.location.origin}/document/${v}`};try{navigator.share?(await navigator.share(e),o("Documento compartilhado!")):(await navigator.clipboard.writeText(e.url),o("Link copiado para área de transferência!"))}catch(l){console.error("Error sharing:",l)}}return G(async()=>{!await u()&&h.value&&$(h.value)}),(v,n)=>(c(),E(te,{"notification-count":0},{default:Y(()=>[X(ne,{onRefresh:x,ref_key:"pullToRefreshRef",ref:p},{default:Y(()=>[t("div",Ce,[t("div",Se,[(c(!0),m(N,null,P(D.value,e=>(c(),m("button",{key:e.value,class:M(C(e.value)),onClick:l=>r.value=e.value},[t("i",{class:M([e.icon,"mr-1"])},null,2),F(" "+w(e.label),1)],10,De))),128))]),t("div",Re,[t("label",Ye,w(v.$t("feed.searchPlaceholder")),1),H(t("input",{id:"feed-search","onUpdate:modelValue":n[0]||(n[0]=e=>y.value=e),type:"search",placeholder:v.$t("feed.searchPlaceholder"),class:"w-full rounded-full border border-gray-200 dark:border-dark-border bg-gray-50 dark:bg-dark-bg px-4 py-2 pr-10 text-sm focus:outline-none focus:ring-2 focus:ring-primary"},null,8,Be),[[Q,y.value]]),n[1]||(n[1]=t("i",{class:"fas fa-search absolute right-3 top-1/2 -translate-y-1/2 text-gray-400"},null,-1))])]),t("div",Le,[!z(a)&&T.value.length===0?(c(),m("div",Xe,[n[2]||(n[2]=t("i",{class:"fas fa-inbox text-gray-400 text-6xl mb-4"},null,-1)),t("h3",ze,w(v.$t("feed.empty")),1),t("p",Ie,w(v.$t("feed.emptySubtitle")),1)])):B("",!0),(c(!0),m(N,null,P(T.value,e=>(c(),E($e,{key:e.id,document:e,onInterested:S,onDismiss:g,onShare:f},null,8,["document"]))),128)),z(a)?(c(),E(Te,{key:1,count:3})):B("",!0)])]),_:1},512),X(Z)]),_:1}))}});export{Ae as default};
