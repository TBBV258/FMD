import{r as c,a as H,c as P,l as U,m as se,C as O,b as g,o as d,h as t,e as w,i as T,n as A,t as $,k as D,U as R,V as oe,p as W,w as z,j as S,F as ie,u as re}from"./vue-vendor-DJ0JNZJp.js";import{_ as le,b as B,u as ne}from"./index-C4pHUPSV.js";import{u as ue}from"./documents-D-VovEtE.js";import{B as G,_ as de}from"./MainLayout.vue_vue_type_script_setup_true_lang-2zwD9oua.js";import{m as M}from"./maplibre-XFgcxNEv.js";import{u as ce}from"./useGeolocation-D46f4tYI.js";import"./supabase-aQ0K3vAX.js";import"./logofmd-DeXnOIzE.js";function me(){const r=c({granted:!1,denied:!1,prompt:!0,checking:!1}),l=c({granted:!1,denied:!1,prompt:!0,checking:!1}),i=c({granted:!1,denied:!1,prompt:!0,checking:!1});return{locationPermission:r,cameraPermission:l,notificationPermission:i,checkLocationPermission:async()=>{if(!("geolocation"in navigator))return r.value.denied=!0,!1;try{if("permissions"in navigator){const s=await navigator.permissions.query({name:"geolocation"});return r.value.granted=s.state==="granted",r.value.denied=s.state==="denied",r.value.prompt=s.state==="prompt",s.state==="granted"}}catch{console.warn("Permissions API not supported")}return!1},requestLocationPermission:()=>new Promise((s,L)=>{r.value.checking=!0,navigator.geolocation.getCurrentPosition(C=>{r.value.granted=!0,r.value.denied=!1,r.value.prompt=!1,r.value.checking=!1,s(C)},C=>{r.value.checking=!1,C.code===C.PERMISSION_DENIED&&(r.value.denied=!0,r.value.granted=!1,r.value.prompt=!1),L(C)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}),checkCameraPermission:async()=>{try{if("permissions"in navigator){const s=await navigator.permissions.query({name:"camera"});return l.value.granted=s.state==="granted",l.value.denied=s.state==="denied",l.value.prompt=s.state==="prompt",s.state==="granted"}}catch{console.warn("Camera permission check not supported")}return!1},requestCameraPermission:async()=>{l.value.checking=!0;try{const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});return l.value.granted=!0,l.value.denied=!1,l.value.prompt=!1,l.value.checking=!1,s}catch(s){throw l.value.checking=!1,(s.name==="NotAllowedError"||s.name==="PermissionDeniedError")&&(l.value.denied=!0,l.value.granted=!1,l.value.prompt=!1),s}},checkNotificationPermission:()=>"Notification"in window?(i.value.granted=Notification.permission==="granted",i.value.denied=Notification.permission==="denied",i.value.prompt=Notification.permission==="default",Notification.permission==="granted"):(i.value.denied=!0,!1),requestNotificationPermission:async()=>{if(!("Notification"in window))throw new Error("Notificações não são suportadas neste navegador");i.value.checking=!0;try{const s=await Notification.requestPermission();return i.value.granted=s==="granted",i.value.denied=s==="denied",i.value.prompt=s==="default",i.value.checking=!1,s==="granted"}catch(s){throw i.value.checking=!1,s}},isMobile:()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isAndroid:()=>/Android/i.test(navigator.userAgent),isIOS:()=>/iPhone|iPad|iPod/i.test(navigator.userAgent)}}function pe(r){const l=new Date,i=typeof r=="string"?new Date(r):r,m=l.getTime()-i.getTime(),p=Math.floor(m/1e3),k=Math.floor(p/60),e=Math.floor(k/60),n=Math.floor(e/24),y=Math.floor(n/7),f=Math.floor(n/30),x=Math.floor(n/365);return p<60?"Agora":k<60?`${k}m`:e<24?`${e}h`:n<7?`${n}d`:y<4?`${y} sem${y>1?"s":""}`:f<12?`${f} mês${f>1?"es":""}`:`${x} ano${x>1?"s":""}`}const fe={class:"relative w-full h-full"},ve={key:0,class:"absolute inset-0 bg-white/80 dark:bg-dark-bg/80 flex items-center justify-center z-10"},ge={class:"absolute top-4 right-4 space-y-2 z-10"},xe=["disabled"],ye={class:"absolute top-4 left-4 bg-white dark:bg-dark-card rounded-lg shadow-lg px-3 py-2 z-10"},be={class:"flex items-center space-x-4 text-sm"},he={class:"flex items-center space-x-1"},ke={class:"font-semibold"},we={class:"flex items-center space-x-1"},Le={class:"font-semibold"},_e={class:"absolute bottom-4 left-4 bg-white dark:bg-dark-card rounded-lg shadow-lg p-3 z-10"},Me={class:"space-y-2 text-sm"},Pe={key:0,class:"flex items-center space-x-2"},Ce={key:1,class:"flex items-center space-x-2 pt-2 border-t border-gray-200 dark:border-dark-border"},$e={key:1,class:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-primary text-white px-4 py-2 rounded-lg shadow-lg z-10 animate-pulse"},ze=H({__name:"MapComponent",props:{documents:{default:()=>[]},center:{default:()=>[-25.9655,32.5832]},zoom:{default:12},enableMarking:{type:Boolean,default:!1}},emits:["markerClick","locationMarked","navigate"],setup(r,{emit:l}){const i=r,m=l,p=c(null),k=c(!0),e=c(null),n=c([]),y=c(null),f=c(null),x=c(!1),b=c(!0),s=c(!1),{coordinates:L,getCurrentPosition:C}=ce(),q=P(()=>i.documents.filter(o=>o.status==="lost").length),I=P(()=>i.documents.filter(o=>o.status==="found").length);U(async()=>{j(),await Y()}),se(()=>{e.value&&e.value.remove()}),O(()=>i.documents,()=>{_()},{deep:!0}),O(b,()=>{_()}),O(s,()=>{Z()});const j=()=>{p.value&&(e.value=new M.Map({container:p.value,style:{version:8,sources:{"osm-tiles":{type:"raster",tiles:["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png","https://c.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,maxzoom:19,attribution:"© OpenStreetMap contributors"}},layers:[{id:"osm-tiles",type:"raster",source:"osm-tiles",minzoom:0,maxzoom:19}]},center:[i.center[1],i.center[0]],zoom:i.zoom,maxTileCacheSize:50,refreshExpiredTiles:!1,renderWorldCopies:!1}),e.value.addControl(new M.NavigationControl,"bottom-right"),e.value.addControl(new M.ScaleControl({maxWidth:100,unit:"metric"}),"bottom-left"),e.value.on("click",o=>{x.value&&te(o.lngLat.lat,o.lngLat.lng)}),e.value.on("load",()=>{k.value=!1,_()}))},_=()=>{!e.value||!e.value.isStyleLoaded()||(b.value?u():E())},u=()=>{if(!e.value)return;e.value.getLayer("clusters")&&e.value.removeLayer("clusters"),e.value.getLayer("cluster-count")&&e.value.removeLayer("cluster-count"),e.value.getLayer("unclustered-point")&&e.value.removeLayer("unclustered-point"),e.value.getSource("documents")&&e.value.removeSource("documents"),n.value.forEach(a=>a.remove()),n.value=[];const o={type:"FeatureCollection",features:i.documents.filter(a=>a.location_metadata?.lat&&a.location_metadata?.lng).map(a=>({type:"Feature",geometry:{type:"Point",coordinates:[a.location_metadata.lng,a.location_metadata.lat]},properties:{id:a.id,title:a.title,description:a.description||"Sem descrição",location:a.location||"Localização não especificada",status:a.status,type:a.type}}))};e.value.addSource("documents",{type:"geojson",data:o,cluster:!0,clusterMaxZoom:16,clusterRadius:60}),e.value.addLayer({id:"clusters",type:"circle",source:"documents",filter:["has","point_count"],paint:{"circle-color":["step",["get","point_count"],"#3B82F6",10,"#F59E0B",30,"#EF4444"],"circle-radius":["step",["get","point_count"],20,10,30,30,40],"circle-opacity":.8,"circle-stroke-width":2,"circle-stroke-color":"#fff"}}),e.value.addLayer({id:"cluster-count",type:"symbol",source:"documents",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":14},paint:{"text-color":"#ffffff"}}),e.value.addLayer({id:"unclustered-point",type:"circle",source:"documents",filter:["!",["has","point_count"]],paint:{"circle-color":["match",["get","status"],"lost","#DC3545","found","#F59E0B","#6C757D"],"circle-radius":10,"circle-stroke-width":2,"circle-stroke-color":"#fff","circle-opacity":.9}}),e.value.on("click","clusters",a=>{const v=e.value.queryRenderedFeatures(a.point,{layers:["clusters"]}),h=v[0].properties.cluster_id;e.value.getSource("documents").getClusterExpansionZoom(h,(V,F)=>{V||e.value.easeTo({center:v[0].geometry.coordinates,zoom:F})})}),e.value.on("click","unclustered-point",a=>{if(!a.features||a.features.length===0)return;const v=a.features[0].properties,h=a.features[0].geometry.coordinates.slice(),N=i.documents.find(V=>V.id===v.id);N&&m("markerClick",N),new M.Popup().setLngLat(h).setHTML(`
        <div class="p-2">
          <h4 class="font-semibold mb-1">${v.title}</h4>
          <p class="text-sm text-gray-600 mb-2">${v.description}</p>
          <p class="text-xs text-gray-500 mb-2">${v.location}</p>
          <button 
            onclick="window.navigateToDocument('${v.id}')" 
            class="text-xs bg-primary text-white px-3 py-1 rounded hover:bg-primary-dark"
          >
            Ver detalhes
          </button>
          <button 
            onclick="window.navigateToLocation(${h[1]}, ${h[0]})" 
            class="text-xs bg-success text-white px-3 py-1 rounded hover:bg-success-dark ml-1"
          >
            <i class="fas fa-directions"></i> Navegar
          </button>
        </div>
      `).addTo(e.value)}),e.value.on("mouseenter","clusters",()=>{e.value.getCanvas().style.cursor="pointer"}),e.value.on("mouseleave","clusters",()=>{e.value.getCanvas().style.cursor=""}),e.value.on("mouseenter","unclustered-point",()=>{e.value.getCanvas().style.cursor="pointer"}),e.value.on("mouseleave","unclustered-point",()=>{e.value.getCanvas().style.cursor=""})},E=()=>{e.value&&(e.value.getLayer("clusters")&&e.value.removeLayer("clusters"),e.value.getLayer("cluster-count")&&e.value.removeLayer("cluster-count"),e.value.getLayer("unclustered-point")&&e.value.removeLayer("unclustered-point"),e.value.getLayer("heatmap-layer")&&e.value.removeLayer("heatmap-layer"),e.value.getSource("documents")&&e.value.removeSource("documents"),n.value.forEach(o=>o.remove()),n.value=[],i.documents.forEach(o=>{if(!o.location_metadata?.lat||!o.location_metadata?.lng)return;const{lat:a,lng:v}=o.location_metadata,h=document.createElement("div");h.className="custom-marker";const N=o.status==="lost"?"#DC3545":"#28A745",V=o.status==="lost"?"fa-search":"fa-check";h.innerHTML=`
      <div style="
        background-color: ${N};
        width: 30px;
        height: 30px;
        border-radius: 50%;
        border: 3px solid white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 14px;
        cursor: pointer;
        transition: transform 0.2s;
      ">
        <i class="fas ${V}"></i>
      </div>
    `,h.addEventListener("mouseenter",()=>{h.style.transform="scale(1.2)"}),h.addEventListener("mouseleave",()=>{h.style.transform="scale(1)"});const F=new M.Popup({offset:25}).setHTML(`
      <div class="p-2">
        <h4 class="font-semibold mb-1">${o.title}</h4>
        <p class="text-sm text-gray-600 mb-2">${o.description||"Sem descrição"}</p>
        <p class="text-xs text-gray-500 mb-2">${o.location||"Localização não especificada"}</p>
        <button 
          onclick="window.navigateToDocument('${o.id}')" 
          class="text-xs bg-primary text-white px-3 py-1 rounded hover:bg-primary-dark"
        >
          Ver detalhes
        </button>
        <button 
          onclick="window.navigateToLocation(${a}, ${v})" 
          class="text-xs bg-success text-white px-3 py-1 rounded hover:bg-success-dark ml-1"
        >
          <i class="fas fa-directions"></i> Navegar
        </button>
      </div>
    `),ae=new M.Marker({element:h}).setLngLat([v,a]).setPopup(F).addTo(e.value);h.addEventListener("click",()=>m("markerClick",o)),n.value.push(ae)}))},Z=()=>{if(!(!e.value||!e.value.isStyleLoaded()))if(s.value){const o={type:"FeatureCollection",features:i.documents.filter(a=>a.location_metadata?.lat&&a.location_metadata?.lng).map(a=>({type:"Feature",geometry:{type:"Point",coordinates:[a.location_metadata.lng,a.location_metadata.lat]},properties:{status:a.status}}))};e.value.getSource("documents-heatmap")||e.value.addSource("documents-heatmap",{type:"geojson",data:o}),e.value.getLayer("heatmap-layer")||e.value.addLayer({id:"heatmap-layer",type:"heatmap",source:"documents-heatmap",maxzoom:16,paint:{"heatmap-weight":1,"heatmap-intensity":["interpolate",["linear"],["zoom"],0,1,16,3],"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(33,102,172,0)",.2,"rgb(103,169,207)",.4,"rgb(209,229,240)",.6,"rgb(253,219,199)",.8,"rgb(239,138,98)",1,"rgb(178,24,43)"],"heatmap-radius":["interpolate",["linear"],["zoom"],0,2,16,40],"heatmap-opacity":["interpolate",["linear"],["zoom"],7,.8,16,.3]}},"clusters")}else e.value.getLayer("heatmap-layer")&&e.value.removeLayer("heatmap-layer"),e.value.getSource("documents-heatmap")&&e.value.removeSource("documents-heatmap")},Y=async()=>{const o=await C();if(o&&e.value){const a=document.createElement("div");a.innerHTML=`
      <div style="
        position: relative;
        width: 20px;
        height: 20px;
      ">
        <div style="
          position: absolute;
          background-color: #007BFF;
          width: 20px;
          height: 20px;
          border-radius: 50%;
          border: 3px solid white;
          box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        "></div>
        <div style="
          position: absolute;
          background-color: rgba(0,123,255,0.3);
          width: 20px;
          height: 20px;
          border-radius: 50%;
          animation: pulse-ring 2s ease-out infinite;
        "></div>
      </div>
    `,y.value&&y.value.remove(),y.value=new M.Marker({element:a}).setLngLat([o.longitude,o.latitude]).setPopup(new M.Popup().setHTML('<p class="p-2 font-semibold">Você está aqui</p>')).addTo(e.value)}},J=()=>{L.value&&e.value&&e.value.flyTo({center:[L.value.longitude,L.value.latitude],zoom:15,duration:1500})},K=()=>{if(!e.value||i.documents.length===0)return;const o=new M.LngLatBounds;i.documents.forEach(a=>{a.location_metadata?.lat&&a.location_metadata?.lng&&o.extend([a.location_metadata.lng,a.location_metadata.lat])}),e.value.fitBounds(o,{padding:80,duration:1500})},Q=()=>{b.value=!b.value},X=()=>{s.value=!s.value},ee=()=>{x.value=!x.value,!x.value&&f.value&&(f.value.remove(),f.value=null)},te=(o,a)=>{if(!e.value)return;f.value&&f.value.remove();const v=document.createElement("div");v.innerHTML=`
    <div style="
      background-color: #FFC107;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 3px solid white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
      animation: pulse 2s infinite;
    ">
      <i class="fas fa-map-marker-alt"></i>
    </div>
  `,f.value=new M.Marker({element:v}).setLngLat([a,o]).addTo(e.value),m("locationMarked",{lat:o,lng:a}),x.value=!1};return typeof window<"u"&&(window.navigateToDocument=o=>{window.location.href=`/document/${o}`},window.navigateToLocation=(o,a)=>{m("navigate",{lat:o,lng:a});const v=`https://www.google.com/maps/dir/?api=1&destination=${o},${a}`;window.open(v,"_blank")}),(o,a)=>(d(),g("div",fe,[t("div",{ref_key:"mapContainer",ref:p,class:"w-full h-full rounded-lg overflow-hidden"},null,512),k.value?(d(),g("div",ve,[...a[0]||(a[0]=[t("div",{class:"text-center"},[t("div",{class:"spinner mb-2"}),t("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Carregando mapa...")],-1)])])):w("",!0),t("div",ge,[t("button",{class:"btn-icon bg-white dark:bg-dark-card shadow-lg",onClick:J,disabled:!T(L),title:"Centralizar na minha localização"},[...a[1]||(a[1]=[t("i",{class:"fas fa-crosshairs"},null,-1)])],8,xe),t("button",{class:A(["btn-icon bg-white dark:bg-dark-card shadow-lg",{"bg-primary text-white":b.value}]),onClick:Q,title:"Agrupar marcadores próximos"},[...a[2]||(a[2]=[t("i",{class:"fas fa-layer-group"},null,-1)])],2),t("button",{class:A(["btn-icon bg-white dark:bg-dark-card shadow-lg",{"bg-danger text-white":s.value}]),onClick:X,title:"Mapa de calor"},[...a[3]||(a[3]=[t("i",{class:"fas fa-fire"},null,-1)])],2),i.documents.length>0?(d(),g("button",{key:0,class:"btn-icon bg-white dark:bg-dark-card shadow-lg",onClick:K,title:"Ver todos os documentos"},[...a[4]||(a[4]=[t("i",{class:"fas fa-expand"},null,-1)])])):w("",!0),r.enableMarking?(d(),g("button",{key:1,class:A(["btn-icon bg-white dark:bg-dark-card shadow-lg",{"bg-primary text-white":x.value}]),onClick:ee,title:"Marcar localização"},[...a[5]||(a[5]=[t("i",{class:"fas fa-map-pin"},null,-1)])],2)):w("",!0)]),t("div",ye,[t("div",be,[t("div",he,[a[6]||(a[6]=t("i",{class:"fas fa-exclamation-circle text-danger"},null,-1)),t("span",ke,$(q.value),1),a[7]||(a[7]=t("span",{class:"text-gray-500 text-xs"},"perdidos",-1))]),t("div",we,[a[8]||(a[8]=t("i",{class:"fas fa-check-circle text-orange-500"},null,-1)),t("span",Le,$(I.value),1),a[9]||(a[9]=t("span",{class:"text-gray-500 text-xs"},"encontrados",-1))])])]),t("div",_e,[t("div",Me,[a[12]||(a[12]=t("div",{class:"flex items-center space-x-2"},[t("div",{class:"w-3 h-3 rounded-full bg-danger"}),t("span",null,"Perdidos")],-1)),a[13]||(a[13]=t("div",{class:"flex items-center space-x-2"},[t("div",{class:"w-3 h-3 rounded-full bg-orange-500"}),t("span",null,"Submetido por utilizador")],-1)),T(L)?(d(),g("div",Pe,[...a[10]||(a[10]=[t("div",{class:"w-3 h-3 rounded-full bg-primary"},null,-1),t("span",null,"Você",-1)])])):w("",!0),b.value?(d(),g("div",Ce,[...a[11]||(a[11]=[t("div",{class:"w-5 h-5 rounded-full bg-primary/20 text-primary text-xs flex items-center justify-center font-bold"},"5+",-1),t("span",{class:"text-xs"},"Grupo",-1)])])):w("",!0)])]),x.value?(d(),g("div",$e,[...a[14]||(a[14]=[t("i",{class:"fas fa-info-circle mr-2"},null,-1),D(" Clique no mapa para marcar a localização ",-1)])])):w("",!0)]))}}),Se=le(ze,[["__scopeId","data-v-97c9c427"]]),Ae={class:"space-y-4"},De={class:"text-center"},Ee={class:"text-lg font-semibold text-gray-900 dark:text-dark-text mb-2"},Te={class:"text-sm text-gray-600 dark:text-gray-400"},Ne={key:0,class:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4"},Ve={key:0,class:"space-y-2 text-xs text-red-700 dark:text-red-300"},Be={key:0},qe={key:1},Ie={key:1,class:"space-y-2 text-xs text-red-700 dark:text-red-300"},je={class:"flex space-x-3"},Fe=H({__name:"LocationPermissionModal",props:R({title:{},message:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:R(["allow","deny"],["update:modelValue"]),setup(r,{emit:l}){const i=oe(r,"modelValue"),m=l,p=c(!1),k=c(!1),e=P(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)),n=P(()=>/Android/i.test(navigator.userAgent)),y=P(()=>/iPhone|iPad|iPod/i.test(navigator.userAgent)),f=async()=>{p.value=!0,k.value=!1;try{"geolocation"in navigator?navigator.geolocation.getCurrentPosition(()=>{p.value=!1,m("allow"),i.value=!1},b=>{p.value=!1,b.code===b.PERMISSION_DENIED&&(k.value=!0),m("deny")}):(p.value=!1,alert("Geolocalização não é suportada neste navegador"),m("deny"))}catch{p.value=!1,m("deny")}},x=()=>{m("deny"),i.value=!1};return(b,s)=>(d(),W(G,{modelValue:i.value,"onUpdate:modelValue":s[0]||(s[0]=L=>i.value=L),title:"Permissão de Localização",maxWidth:"md"},{footer:z(()=>[t("div",je,[S(B,{variant:"secondary","full-width":"",onClick:x},{default:z(()=>[...s[9]||(s[9]=[D(" Agora não ",-1)])]),_:1}),S(B,{variant:"primary","full-width":"",onClick:f,loading:p.value},{default:z(()=>[...s[10]||(s[10]=[D(" Permitir Localização ",-1)])]),_:1},8,["loading"])])]),default:z(()=>[t("div",Ae,[s[6]||(s[6]=t("div",{class:"flex justify-center"},[t("div",{class:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center"},[t("i",{class:"fas fa-map-marker-alt text-3xl text-primary"})])],-1)),t("div",De,[t("h3",Ee,$(r.title||"Precisamos da sua localização"),1),t("p",Te,$(r.message||"Para ajudar a encontrar documentos perdidos próximos a você."),1)]),s[7]||(s[7]=t("div",{class:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 space-y-2"},[t("p",{class:"text-sm font-semibold text-blue-900 dark:text-blue-100"}," Por que precisamos disso? "),t("ul",{class:"space-y-1 text-sm text-blue-700 dark:text-blue-300"},[t("li",{class:"flex items-start space-x-2"},[t("i",{class:"fas fa-check text-xs mt-0.5"}),t("span",null,"Mostrar documentos perdidos perto de você")]),t("li",{class:"flex items-start space-x-2"},[t("i",{class:"fas fa-check text-xs mt-0.5"}),t("span",null,"Ajudar outros a encontrarem seus documentos")]),t("li",{class:"flex items-start space-x-2"},[t("i",{class:"fas fa-check text-xs mt-0.5"}),t("span",null,"Registrar onde você perdeu/encontrou")])])],-1)),s[8]||(s[8]=t("p",{class:"text-xs text-gray-500 dark:text-gray-400 text-center"},[t("i",{class:"fas fa-lock mr-1"}),D(" Sua localização é usada apenas quando você permite e nunca é compartilhada sem seu consentimento. ")],-1)),k.value?(d(),g("div",Ne,[s[4]||(s[4]=t("p",{class:"text-sm font-semibold text-red-900 dark:text-red-100 mb-2"}," Permissão Negada ",-1)),s[5]||(s[5]=t("p",{class:"text-xs text-red-700 dark:text-red-300 mb-3"}," Para habilitar a localização, siga as instruções: ",-1)),e.value?(d(),g("div",Ve,[n.value?(d(),g("div",Be,[...s[1]||(s[1]=[t("p",{class:"font-semibold"},"Android (Chrome):",-1),t("ol",{class:"list-decimal list-inside space-y-1 ml-2"},[t("li",null,"Abra Configurações do Chrome"),t("li",null,'Toque em "Configurações do site"'),t("li",null,'Toque em "Localização"'),t("li",null,"Habilite para este site")],-1)])])):y.value?(d(),g("div",qe,[...s[2]||(s[2]=[t("p",{class:"font-semibold"},"iOS (Safari):",-1),t("ol",{class:"list-decimal list-inside space-y-1 ml-2"},[t("li",null,"Abra Ajustes do iPhone"),t("li",null,"Role até Safari"),t("li",null,'Toque em "Localização"'),t("li",null,'Selecione "Perguntar" ou "Permitir"')],-1)])])):w("",!0)])):(d(),g("div",Ie,[...s[3]||(s[3]=[t("p",{class:"font-semibold"},"Desktop:",-1),t("ol",{class:"list-decimal list-inside space-y-1 ml-2"},[t("li",null,"Clique no ícone de cadeado/informação na barra de endereço"),t("li",null,'Procure "Localização"'),t("li",null,'Altere para "Permitir"'),t("li",null,"Recarregue a página")],-1)])]))])):w("",!0)])]),_:1},8,["modelValue"]))}}),Oe={class:"h-[calc(100vh-8rem)]"},He={key:0,class:"relative aspect-video bg-gray-200 dark:bg-dark-card rounded-lg overflow-hidden mb-4"},Re=["src","alt"],Ue={key:0,class:"absolute inset-0 flex items-center justify-center bg-black/20"},We={class:"space-y-3"},Ge={class:"flex items-center space-x-2"},Ze={class:"badge badge-primary"},Ye={class:"space-y-2 text-sm"},Je={class:"flex items-start"},Ke={class:"flex items-start"},Qe={class:"flex space-x-2 mt-4 pt-4 border-t border-gray-200 dark:border-dark-border"},lt=H({__name:"MapView",setup(r){const l=re(),i=ne(),m=ue(),{checkLocationPermission:p,locationPermission:k}=me(),e=c(null),n=c(!1),y=c(!1),f=P(()=>m.documents),x=P(()=>e.value?{lost:"badge badge-danger",found:"badge bg-orange-500 text-white",matched:"badge bg-purple-500/10 text-purple-500",returned:"badge badge-success"}[e.value.status]||"badge badge-primary":""),b=P(()=>e.value?{lost:"Perdido",found:"Submetido por utilizador",matched:"Match",returned:"Devolvido",normal:"Normal"}[e.value.status]||e.value.status:""),s=P(()=>e.value?{passport:"fas fa-passport",id_card:"fas fa-id-card",driver_license:"fas fa-id-card-alt",birth_certificate:"fas fa-file-alt",other:"fas fa-file"}[e.value.type]||"fas fa-file":""),L=P(()=>e.value?{passport:"Passaporte",id_card:"BI",driver_license:"Carta",birth_certificate:"Certidão",other:"Outro"}[e.value.type]||"Documento":""),C=_=>{e.value=_,n.value=!0},q=()=>{e.value&&l.push(`/document/${e.value.id}`)},I=()=>{console.log("Location permission granted")},j=()=>{console.log("Location permission denied")};return U(async()=>{f.value.length===0&&await m.fetchDocuments(),!await p()&&k.value.prompt&&setTimeout(()=>{y.value=!0},1e3)}),(_,u)=>(d(),W(de,null,{default:z(()=>[t("div",Oe,[S(Se,{documents:f.value,onMarkerClick:C},null,8,["documents"])]),S(Fe,{modelValue:y.value,"onUpdate:modelValue":u[0]||(u[0]=E=>y.value=E),title:"Ver Documentos no Mapa",message:"Precisamos da sua localização para mostrar documentos perdidos próximos a você.",onAllow:I,onDeny:j},null,8,["modelValue"]),S(G,{modelValue:n.value,"onUpdate:modelValue":u[2]||(u[2]=E=>n.value=E),title:e.value?.title},{default:z(()=>[e.value?(d(),g(ie,{key:0},[e.value.thumbnail_url||e.value.file_url?(d(),g("div",He,[t("img",{src:e.value.thumbnail_url||e.value.file_url,alt:e.value.title,class:A(["w-full h-full object-cover",T(i).isAuthenticated?"":"blur-md"])},null,10,Re),T(i).isAuthenticated?w("",!0):(d(),g("div",Ue,[...u[3]||(u[3]=[t("i",{class:"fas fa-lock text-white text-xl drop-shadow-lg"},null,-1)])]))])):w("",!0),t("div",We,[t("div",Ge,[t("span",{class:A(x.value)},$(b.value),3),t("span",Ze,[t("i",{class:A([s.value,"mr-1"])},null,2),D(" "+$(L.value),1)])]),e.value.description?(d(),g("p",{key:0,class:A(["text-sm text-gray-600 dark:text-gray-400",T(i).isAuthenticated?"":"blur-sm select-none"])},$(e.value.description),3)):w("",!0),t("div",Ye,[t("div",Je,[u[4]||(u[4]=t("i",{class:"fas fa-map-marker-alt text-gray-400 w-5 mt-0.5"},null,-1)),t("span",null,$(e.value.location||"Localização não especificada"),1)]),t("div",Ke,[u[5]||(u[5]=t("i",{class:"fas fa-clock text-gray-400 w-5 mt-0.5"},null,-1)),t("span",null,$(T(pe)(e.value.created_at)),1)])])]),t("div",Qe,[S(B,{variant:"primary",class:"flex-1",onClick:q},{default:z(()=>[...u[6]||(u[6]=[D(" Ver Detalhes ",-1)])]),_:1}),S(B,{variant:"outline",onClick:u[1]||(u[1]=E=>n.value=!1)},{default:z(()=>[...u[7]||(u[7]=[D(" Fechar ",-1)])]),_:1})])],64)):w("",!0)]),_:1},8,["modelValue","title"])]),_:1}))}});export{lt as default};
