import{r as c,a as O,c as M,l as R,m as se,C as j,b as y,o as m,h as e,e as _,i as F,n as N,t as $,k as A,U as H,V as oe,p as U,w as z,j as S,F as re,u as ie}from"./vue-vendor-DJ0JNZJp.js";import{u as le}from"./documents-DAXEsCRq.js";import{_ as ne}from"./MainLayout.vue_vue_type_script_setup_true_lang-D3S3XnV8.js";import{m as L}from"./maplibre-XFgcxNEv.js";import{u as ue}from"./useGeolocation-D46f4tYI.js";import{_ as de,b as V}from"./index-OUv6I-l5.js";import{B as W}from"./BaseModal-CnTmPs9q.js";import"./logofmd-DeXnOIzE.js";import"./supabase-aQ0K3vAX.js";function ce(){const l=c({granted:!1,denied:!1,prompt:!0,checking:!1}),n=c({granted:!1,denied:!1,prompt:!0,checking:!1}),r=c({granted:!1,denied:!1,prompt:!0,checking:!1});return{locationPermission:l,cameraPermission:n,notificationPermission:r,checkLocationPermission:async()=>{if(!("geolocation"in navigator))return l.value.denied=!0,!1;try{if("permissions"in navigator){const s=await navigator.permissions.query({name:"geolocation"});return l.value.granted=s.state==="granted",l.value.denied=s.state==="denied",l.value.prompt=s.state==="prompt",s.state==="granted"}}catch{console.warn("Permissions API not supported")}return!1},requestLocationPermission:()=>new Promise((s,w)=>{l.value.checking=!0,navigator.geolocation.getCurrentPosition(P=>{l.value.granted=!0,l.value.denied=!1,l.value.prompt=!1,l.value.checking=!1,s(P)},P=>{l.value.checking=!1,P.code===P.PERMISSION_DENIED&&(l.value.denied=!0,l.value.granted=!1,l.value.prompt=!1),w(P)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}),checkCameraPermission:async()=>{try{if("permissions"in navigator){const s=await navigator.permissions.query({name:"camera"});return n.value.granted=s.state==="granted",n.value.denied=s.state==="denied",n.value.prompt=s.state==="prompt",s.state==="granted"}}catch{console.warn("Camera permission check not supported")}return!1},requestCameraPermission:async()=>{n.value.checking=!0;try{const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});return n.value.granted=!0,n.value.denied=!1,n.value.prompt=!1,n.value.checking=!1,s}catch(s){throw n.value.checking=!1,(s.name==="NotAllowedError"||s.name==="PermissionDeniedError")&&(n.value.denied=!0,n.value.granted=!1,n.value.prompt=!1),s}},checkNotificationPermission:()=>"Notification"in window?(r.value.granted=Notification.permission==="granted",r.value.denied=Notification.permission==="denied",r.value.prompt=Notification.permission==="default",Notification.permission==="granted"):(r.value.denied=!0,!1),requestNotificationPermission:async()=>{if(!("Notification"in window))throw new Error("Notificações não são suportadas neste navegador");r.value.checking=!0;try{const s=await Notification.requestPermission();return r.value.granted=s==="granted",r.value.denied=s==="denied",r.value.prompt=s==="default",r.value.checking=!1,s==="granted"}catch(s){throw r.value.checking=!1,s}},isMobile:()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isAndroid:()=>/Android/i.test(navigator.userAgent),isIOS:()=>/iPhone|iPad|iPod/i.test(navigator.userAgent)}}function me(l){const n=new Date,r=typeof l=="string"?new Date(l):l,v=n.getTime()-r.getTime(),p=Math.floor(v/1e3),i=Math.floor(p/60),t=Math.floor(i/60),u=Math.floor(t/24),k=Math.floor(u/7),g=Math.floor(u/30),x=Math.floor(u/365);return p<60?"Agora":i<60?`${i}m`:t<24?`${t}h`:u<7?`${u}d`:k<4?`${k} sem${k>1?"s":""}`:g<12?`${g} mês${g>1?"es":""}`:`${x} ano${x>1?"s":""}`}const pe={class:"relative w-full h-full"},fe={key:0,class:"absolute inset-0 bg-white/80 dark:bg-dark-bg/80 flex items-center justify-center z-10"},ve={class:"absolute top-4 right-4 space-y-2 z-10"},ge=["disabled"],xe={class:"absolute top-4 left-4 bg-white dark:bg-dark-card rounded-lg shadow-lg px-3 py-2 z-10"},ye={class:"flex items-center space-x-4 text-sm"},be={class:"flex items-center space-x-1"},he={class:"font-semibold"},ke={class:"flex items-center space-x-1"},we={class:"font-semibold"},_e={class:"absolute bottom-4 left-4 bg-white dark:bg-dark-card rounded-lg shadow-lg p-3 z-10"},Le={class:"space-y-2 text-sm"},Me={key:0,class:"flex items-center space-x-2"},Pe={key:1,class:"flex items-center space-x-2 pt-2 border-t border-gray-200 dark:border-dark-border"},Ce={key:1,class:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-primary text-white px-4 py-2 rounded-lg shadow-lg z-10 animate-pulse"},$e=O({__name:"MapComponent",props:{documents:{default:()=>[]},center:{default:()=>[-25.9655,32.5832]},zoom:{default:12},enableMarking:{type:Boolean,default:!1}},emits:["markerClick","locationMarked","navigate"],setup(l,{emit:n}){const r=l,v=n,p=c(null),i=c(!0),t=c(null),u=c([]),k=c(null),g=c(null),x=c(!1),b=c(!0),s=c(!1),{coordinates:w,getCurrentPosition:P}=ue(),B=M(()=>r.documents.filter(o=>o.status==="lost").length),q=M(()=>r.documents.filter(o=>o.status==="found").length);R(async()=>{C(),await Y()}),se(()=>{t.value&&t.value.remove()}),j(()=>r.documents,()=>{d()},{deep:!0}),j(b,()=>{d()}),j(s,()=>{Z()});const C=()=>{p.value&&(t.value=new L.Map({container:p.value,style:{version:8,sources:{"osm-tiles":{type:"raster",tiles:["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png","https://c.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,maxzoom:19,attribution:"© OpenStreetMap contributors"}},layers:[{id:"osm-tiles",type:"raster",source:"osm-tiles",minzoom:0,maxzoom:19}]},center:[r.center[1],r.center[0]],zoom:r.zoom,maxTileCacheSize:50,refreshExpiredTiles:!1,renderWorldCopies:!1}),t.value.addControl(new L.NavigationControl,"bottom-right"),t.value.addControl(new L.ScaleControl({maxWidth:100,unit:"metric"}),"bottom-left"),t.value.on("click",o=>{x.value&&te(o.lngLat.lat,o.lngLat.lng)}),t.value.on("load",()=>{i.value=!1,d()}))},d=()=>{!t.value||!t.value.isStyleLoaded()||(b.value?D():G())},D=()=>{if(!t.value)return;t.value.getLayer("clusters")&&t.value.removeLayer("clusters"),t.value.getLayer("cluster-count")&&t.value.removeLayer("cluster-count"),t.value.getLayer("unclustered-point")&&t.value.removeLayer("unclustered-point"),t.value.getSource("documents")&&t.value.removeSource("documents"),u.value.forEach(a=>a.remove()),u.value=[];const o={type:"FeatureCollection",features:r.documents.filter(a=>a.location_metadata?.lat&&a.location_metadata?.lng).map(a=>({type:"Feature",geometry:{type:"Point",coordinates:[a.location_metadata.lng,a.location_metadata.lat]},properties:{id:a.id,title:a.title,description:a.description||"Sem descrição",location:a.location||"Localização não especificada",status:a.status,type:a.type}}))};t.value.addSource("documents",{type:"geojson",data:o,cluster:!0,clusterMaxZoom:16,clusterRadius:60}),t.value.addLayer({id:"clusters",type:"circle",source:"documents",filter:["has","point_count"],paint:{"circle-color":["step",["get","point_count"],"#3B82F6",10,"#F59E0B",30,"#EF4444"],"circle-radius":["step",["get","point_count"],20,10,30,30,40],"circle-opacity":.8,"circle-stroke-width":2,"circle-stroke-color":"#fff"}}),t.value.addLayer({id:"cluster-count",type:"symbol",source:"documents",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":14},paint:{"text-color":"#ffffff"}}),t.value.addLayer({id:"unclustered-point",type:"circle",source:"documents",filter:["!",["has","point_count"]],paint:{"circle-color":["match",["get","status"],"lost","#DC3545","found","#28A745","#6C757D"],"circle-radius":10,"circle-stroke-width":2,"circle-stroke-color":"#fff","circle-opacity":.9}}),t.value.on("click","clusters",a=>{const f=t.value.queryRenderedFeatures(a.point,{layers:["clusters"]}),h=f[0].properties.cluster_id;t.value.getSource("documents").getClusterExpansionZoom(h,(T,I)=>{T||t.value.easeTo({center:f[0].geometry.coordinates,zoom:I})})}),t.value.on("click","unclustered-point",a=>{if(!a.features||a.features.length===0)return;const f=a.features[0].properties,h=a.features[0].geometry.coordinates.slice(),E=r.documents.find(T=>T.id===f.id);E&&v("markerClick",E),new L.Popup().setLngLat(h).setHTML(`
        <div class="p-2">
          <h4 class="font-semibold mb-1">${f.title}</h4>
          <p class="text-sm text-gray-600 mb-2">${f.description}</p>
          <p class="text-xs text-gray-500 mb-2">${f.location}</p>
          <button 
            onclick="window.navigateToDocument('${f.id}')" 
            class="text-xs bg-primary text-white px-3 py-1 rounded hover:bg-primary-dark"
          >
            Ver detalhes
          </button>
          <button 
            onclick="window.navigateToLocation(${h[1]}, ${h[0]})" 
            class="text-xs bg-success text-white px-3 py-1 rounded hover:bg-success-dark ml-1"
          >
            <i class="fas fa-directions"></i> Navegar
          </button>
        </div>
      `).addTo(t.value)}),t.value.on("mouseenter","clusters",()=>{t.value.getCanvas().style.cursor="pointer"}),t.value.on("mouseleave","clusters",()=>{t.value.getCanvas().style.cursor=""}),t.value.on("mouseenter","unclustered-point",()=>{t.value.getCanvas().style.cursor="pointer"}),t.value.on("mouseleave","unclustered-point",()=>{t.value.getCanvas().style.cursor=""})},G=()=>{t.value&&(t.value.getLayer("clusters")&&t.value.removeLayer("clusters"),t.value.getLayer("cluster-count")&&t.value.removeLayer("cluster-count"),t.value.getLayer("unclustered-point")&&t.value.removeLayer("unclustered-point"),t.value.getLayer("heatmap-layer")&&t.value.removeLayer("heatmap-layer"),t.value.getSource("documents")&&t.value.removeSource("documents"),u.value.forEach(o=>o.remove()),u.value=[],r.documents.forEach(o=>{if(!o.location_metadata?.lat||!o.location_metadata?.lng)return;const{lat:a,lng:f}=o.location_metadata,h=document.createElement("div");h.className="custom-marker";const E=o.status==="lost"?"#DC3545":"#28A745",T=o.status==="lost"?"fa-search":"fa-check";h.innerHTML=`
      <div style="
        background-color: ${E};
        width: 30px;
        height: 30px;
        border-radius: 50%;
        border: 3px solid white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 14px;
        cursor: pointer;
        transition: transform 0.2s;
      ">
        <i class="fas ${T}"></i>
      </div>
    `,h.addEventListener("mouseenter",()=>{h.style.transform="scale(1.2)"}),h.addEventListener("mouseleave",()=>{h.style.transform="scale(1)"});const I=new L.Popup({offset:25}).setHTML(`
      <div class="p-2">
        <h4 class="font-semibold mb-1">${o.title}</h4>
        <p class="text-sm text-gray-600 mb-2">${o.description||"Sem descrição"}</p>
        <p class="text-xs text-gray-500 mb-2">${o.location||"Localização não especificada"}</p>
        <button 
          onclick="window.navigateToDocument('${o.id}')" 
          class="text-xs bg-primary text-white px-3 py-1 rounded hover:bg-primary-dark"
        >
          Ver detalhes
        </button>
        <button 
          onclick="window.navigateToLocation(${a}, ${f})" 
          class="text-xs bg-success text-white px-3 py-1 rounded hover:bg-success-dark ml-1"
        >
          <i class="fas fa-directions"></i> Navegar
        </button>
      </div>
    `),ae=new L.Marker({element:h}).setLngLat([f,a]).setPopup(I).addTo(t.value);h.addEventListener("click",()=>v("markerClick",o)),u.value.push(ae)}))},Z=()=>{if(!(!t.value||!t.value.isStyleLoaded()))if(s.value){const o={type:"FeatureCollection",features:r.documents.filter(a=>a.location_metadata?.lat&&a.location_metadata?.lng).map(a=>({type:"Feature",geometry:{type:"Point",coordinates:[a.location_metadata.lng,a.location_metadata.lat]},properties:{status:a.status}}))};t.value.getSource("documents-heatmap")||t.value.addSource("documents-heatmap",{type:"geojson",data:o}),t.value.getLayer("heatmap-layer")||t.value.addLayer({id:"heatmap-layer",type:"heatmap",source:"documents-heatmap",maxzoom:16,paint:{"heatmap-weight":1,"heatmap-intensity":["interpolate",["linear"],["zoom"],0,1,16,3],"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(33,102,172,0)",.2,"rgb(103,169,207)",.4,"rgb(209,229,240)",.6,"rgb(253,219,199)",.8,"rgb(239,138,98)",1,"rgb(178,24,43)"],"heatmap-radius":["interpolate",["linear"],["zoom"],0,2,16,40],"heatmap-opacity":["interpolate",["linear"],["zoom"],7,.8,16,.3]}},"clusters")}else t.value.getLayer("heatmap-layer")&&t.value.removeLayer("heatmap-layer"),t.value.getSource("documents-heatmap")&&t.value.removeSource("documents-heatmap")},Y=async()=>{const o=await P();if(o&&t.value){const a=document.createElement("div");a.innerHTML=`
      <div style="
        position: relative;
        width: 20px;
        height: 20px;
      ">
        <div style="
          position: absolute;
          background-color: #007BFF;
          width: 20px;
          height: 20px;
          border-radius: 50%;
          border: 3px solid white;
          box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        "></div>
        <div style="
          position: absolute;
          background-color: rgba(0,123,255,0.3);
          width: 20px;
          height: 20px;
          border-radius: 50%;
          animation: pulse-ring 2s ease-out infinite;
        "></div>
      </div>
    `,k.value&&k.value.remove(),k.value=new L.Marker({element:a}).setLngLat([o.longitude,o.latitude]).setPopup(new L.Popup().setHTML('<p class="p-2 font-semibold">Você está aqui</p>')).addTo(t.value)}},J=()=>{w.value&&t.value&&t.value.flyTo({center:[w.value.longitude,w.value.latitude],zoom:15,duration:1500})},K=()=>{if(!t.value||r.documents.length===0)return;const o=new L.LngLatBounds;r.documents.forEach(a=>{a.location_metadata?.lat&&a.location_metadata?.lng&&o.extend([a.location_metadata.lng,a.location_metadata.lat])}),t.value.fitBounds(o,{padding:80,duration:1500})},Q=()=>{b.value=!b.value},X=()=>{s.value=!s.value},ee=()=>{x.value=!x.value,!x.value&&g.value&&(g.value.remove(),g.value=null)},te=(o,a)=>{if(!t.value)return;g.value&&g.value.remove();const f=document.createElement("div");f.innerHTML=`
    <div style="
      background-color: #FFC107;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 3px solid white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
      animation: pulse 2s infinite;
    ">
      <i class="fas fa-map-marker-alt"></i>
    </div>
  `,g.value=new L.Marker({element:f}).setLngLat([a,o]).addTo(t.value),v("locationMarked",{lat:o,lng:a}),x.value=!1};return typeof window<"u"&&(window.navigateToDocument=o=>{window.location.href=`/document/${o}`},window.navigateToLocation=(o,a)=>{v("navigate",{lat:o,lng:a});const f=`https://www.google.com/maps/dir/?api=1&destination=${o},${a}`;window.open(f,"_blank")}),(o,a)=>(m(),y("div",pe,[e("div",{ref_key:"mapContainer",ref:p,class:"w-full h-full rounded-lg overflow-hidden"},null,512),i.value?(m(),y("div",fe,[...a[0]||(a[0]=[e("div",{class:"text-center"},[e("div",{class:"spinner mb-2"}),e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Carregando mapa...")],-1)])])):_("",!0),e("div",ve,[e("button",{class:"btn-icon bg-white dark:bg-dark-card shadow-lg",onClick:J,disabled:!F(w),title:"Centralizar na minha localização"},[...a[1]||(a[1]=[e("i",{class:"fas fa-crosshairs"},null,-1)])],8,ge),e("button",{class:N(["btn-icon bg-white dark:bg-dark-card shadow-lg",{"bg-primary text-white":b.value}]),onClick:Q,title:"Agrupar marcadores próximos"},[...a[2]||(a[2]=[e("i",{class:"fas fa-layer-group"},null,-1)])],2),e("button",{class:N(["btn-icon bg-white dark:bg-dark-card shadow-lg",{"bg-danger text-white":s.value}]),onClick:X,title:"Mapa de calor"},[...a[3]||(a[3]=[e("i",{class:"fas fa-fire"},null,-1)])],2),r.documents.length>0?(m(),y("button",{key:0,class:"btn-icon bg-white dark:bg-dark-card shadow-lg",onClick:K,title:"Ver todos os documentos"},[...a[4]||(a[4]=[e("i",{class:"fas fa-expand"},null,-1)])])):_("",!0),l.enableMarking?(m(),y("button",{key:1,class:N(["btn-icon bg-white dark:bg-dark-card shadow-lg",{"bg-primary text-white":x.value}]),onClick:ee,title:"Marcar localização"},[...a[5]||(a[5]=[e("i",{class:"fas fa-map-pin"},null,-1)])],2)):_("",!0)]),e("div",xe,[e("div",ye,[e("div",be,[a[6]||(a[6]=e("i",{class:"fas fa-exclamation-circle text-danger"},null,-1)),e("span",he,$(B.value),1),a[7]||(a[7]=e("span",{class:"text-gray-500 text-xs"},"perdidos",-1))]),e("div",ke,[a[8]||(a[8]=e("i",{class:"fas fa-check-circle text-success"},null,-1)),e("span",we,$(q.value),1),a[9]||(a[9]=e("span",{class:"text-gray-500 text-xs"},"encontrados",-1))])])]),e("div",_e,[e("div",Le,[a[12]||(a[12]=e("div",{class:"flex items-center space-x-2"},[e("div",{class:"w-3 h-3 rounded-full bg-danger"}),e("span",null,"Perdidos")],-1)),a[13]||(a[13]=e("div",{class:"flex items-center space-x-2"},[e("div",{class:"w-3 h-3 rounded-full bg-success"}),e("span",null,"Recuperados")],-1)),F(w)?(m(),y("div",Me,[...a[10]||(a[10]=[e("div",{class:"w-3 h-3 rounded-full bg-primary"},null,-1),e("span",null,"Você",-1)])])):_("",!0),b.value?(m(),y("div",Pe,[...a[11]||(a[11]=[e("div",{class:"w-5 h-5 rounded-full bg-primary/20 text-primary text-xs flex items-center justify-center font-bold"},"5+",-1),e("span",{class:"text-xs"},"Grupo",-1)])])):_("",!0)])]),x.value?(m(),y("div",Ce,[...a[14]||(a[14]=[e("i",{class:"fas fa-info-circle mr-2"},null,-1),A(" Clique no mapa para marcar a localização ",-1)])])):_("",!0)]))}}),ze=de($e,[["__scopeId","data-v-a6ef1a17"]]),Se={class:"space-y-4"},Ae={class:"text-center"},De={class:"text-lg font-semibold text-gray-900 dark:text-dark-text mb-2"},Ee={class:"text-sm text-gray-600 dark:text-gray-400"},Te={key:0,class:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4"},Ne={key:0,class:"space-y-2 text-xs text-red-700 dark:text-red-300"},Ve={key:0},Be={key:1},qe={key:1,class:"space-y-2 text-xs text-red-700 dark:text-red-300"},Ie={class:"flex space-x-3"},je=O({__name:"LocationPermissionModal",props:H({title:{},message:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:H(["allow","deny"],["update:modelValue"]),setup(l,{emit:n}){const r=oe(l,"modelValue"),v=n,p=c(!1),i=c(!1),t=M(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)),u=M(()=>/Android/i.test(navigator.userAgent)),k=M(()=>/iPhone|iPad|iPod/i.test(navigator.userAgent)),g=async()=>{p.value=!0,i.value=!1;try{"geolocation"in navigator?navigator.geolocation.getCurrentPosition(()=>{p.value=!1,v("allow"),r.value=!1},b=>{p.value=!1,b.code===b.PERMISSION_DENIED&&(i.value=!0),v("deny")}):(p.value=!1,alert("Geolocalização não é suportada neste navegador"),v("deny"))}catch{p.value=!1,v("deny")}},x=()=>{v("deny"),r.value=!1};return(b,s)=>(m(),U(W,{modelValue:r.value,"onUpdate:modelValue":s[0]||(s[0]=w=>r.value=w),title:"Permissão de Localização",maxWidth:"md"},{footer:z(()=>[e("div",Ie,[S(V,{variant:"secondary","full-width":"",onClick:x},{default:z(()=>[...s[9]||(s[9]=[A(" Agora não ",-1)])]),_:1}),S(V,{variant:"primary","full-width":"",onClick:g,loading:p.value},{default:z(()=>[...s[10]||(s[10]=[A(" Permitir Localização ",-1)])]),_:1},8,["loading"])])]),default:z(()=>[e("div",Se,[s[6]||(s[6]=e("div",{class:"flex justify-center"},[e("div",{class:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center"},[e("i",{class:"fas fa-map-marker-alt text-3xl text-primary"})])],-1)),e("div",Ae,[e("h3",De,$(l.title||"Precisamos da sua localização"),1),e("p",Ee,$(l.message||"Para ajudar a encontrar documentos perdidos próximos a você."),1)]),s[7]||(s[7]=e("div",{class:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 space-y-2"},[e("p",{class:"text-sm font-semibold text-blue-900 dark:text-blue-100"}," Por que precisamos disso? "),e("ul",{class:"space-y-1 text-sm text-blue-700 dark:text-blue-300"},[e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-xs mt-0.5"}),e("span",null,"Mostrar documentos perdidos perto de você")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-xs mt-0.5"}),e("span",null,"Ajudar outros a encontrarem seus documentos")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-xs mt-0.5"}),e("span",null,"Registrar onde você perdeu/encontrou")])])],-1)),s[8]||(s[8]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400 text-center"},[e("i",{class:"fas fa-lock mr-1"}),A(" Sua localização é usada apenas quando você permite e nunca é compartilhada sem seu consentimento. ")],-1)),i.value?(m(),y("div",Te,[s[4]||(s[4]=e("p",{class:"text-sm font-semibold text-red-900 dark:text-red-100 mb-2"}," Permissão Negada ",-1)),s[5]||(s[5]=e("p",{class:"text-xs text-red-700 dark:text-red-300 mb-3"}," Para habilitar a localização, siga as instruções: ",-1)),t.value?(m(),y("div",Ne,[u.value?(m(),y("div",Ve,[...s[1]||(s[1]=[e("p",{class:"font-semibold"},"Android (Chrome):",-1),e("ol",{class:"list-decimal list-inside space-y-1 ml-2"},[e("li",null,"Abra Configurações do Chrome"),e("li",null,'Toque em "Configurações do site"'),e("li",null,'Toque em "Localização"'),e("li",null,"Habilite para este site")],-1)])])):k.value?(m(),y("div",Be,[...s[2]||(s[2]=[e("p",{class:"font-semibold"},"iOS (Safari):",-1),e("ol",{class:"list-decimal list-inside space-y-1 ml-2"},[e("li",null,"Abra Ajustes do iPhone"),e("li",null,"Role até Safari"),e("li",null,'Toque em "Localização"'),e("li",null,'Selecione "Perguntar" ou "Permitir"')],-1)])])):_("",!0)])):(m(),y("div",qe,[...s[3]||(s[3]=[e("p",{class:"font-semibold"},"Desktop:",-1),e("ol",{class:"list-decimal list-inside space-y-1 ml-2"},[e("li",null,"Clique no ícone de cadeado/informação na barra de endereço"),e("li",null,'Procure "Localização"'),e("li",null,'Altere para "Permitir"'),e("li",null,"Recarregue a página")],-1)])]))])):_("",!0)])]),_:1},8,["modelValue"]))}}),Fe={class:"h-[calc(100vh-8rem)]"},Oe={key:0,class:"aspect-video bg-gray-200 dark:bg-dark-card rounded-lg overflow-hidden mb-4"},He=["src","alt"],Re={class:"space-y-3"},Ue={class:"flex items-center space-x-2"},We={class:"badge badge-primary"},Ge={key:0,class:"text-sm text-gray-600 dark:text-gray-400"},Ze={class:"space-y-2 text-sm"},Ye={class:"flex items-start"},Je={class:"flex items-start"},Ke={class:"flex space-x-2 mt-4 pt-4 border-t border-gray-200 dark:border-dark-border"},lt=O({__name:"MapView",setup(l){const n=ie(),r=le(),{checkLocationPermission:v,locationPermission:p}=ce(),i=c(null),t=c(!1),u=c(!1),k=M(()=>r.documents),g=M(()=>i.value?{lost:"badge badge-danger",found:"badge badge-success",matched:"badge bg-purple-500/10 text-purple-500",returned:"badge badge-success"}[i.value.status]||"badge badge-primary":""),x=M(()=>i.value?{lost:"Perdido",found:"Encontrado",matched:"Match",returned:"Devolvido",normal:"Normal"}[i.value.status]||i.value.status:""),b=M(()=>i.value?{passport:"fas fa-passport",id_card:"fas fa-id-card",driver_license:"fas fa-id-card-alt",birth_certificate:"fas fa-file-alt",other:"fas fa-file"}[i.value.type]||"fas fa-file":""),s=M(()=>i.value?{passport:"Passaporte",id_card:"BI",driver_license:"Carta",birth_certificate:"Certidão",other:"Outro"}[i.value.type]||"Documento":""),w=C=>{i.value=C,t.value=!0},P=()=>{i.value&&n.push(`/document/${i.value.id}`)},B=()=>{console.log("Location permission granted")},q=()=>{console.log("Location permission denied")};return R(async()=>{k.value.length===0&&await r.fetchDocuments(),!await v()&&p.value.prompt&&setTimeout(()=>{u.value=!0},1e3)}),(C,d)=>(m(),U(ne,null,{default:z(()=>[e("div",Fe,[S(ze,{documents:k.value,onMarkerClick:w},null,8,["documents"])]),S(je,{modelValue:u.value,"onUpdate:modelValue":d[0]||(d[0]=D=>u.value=D),title:"Ver Documentos no Mapa",message:"Precisamos da sua localização para mostrar documentos perdidos próximos a você.",onAllow:B,onDeny:q},null,8,["modelValue"]),S(W,{modelValue:t.value,"onUpdate:modelValue":d[2]||(d[2]=D=>t.value=D),title:i.value?.title},{default:z(()=>[i.value?(m(),y(re,{key:0},[i.value.thumbnail_url||i.value.file_url?(m(),y("div",Oe,[e("img",{src:i.value.thumbnail_url||i.value.file_url,alt:i.value.title,class:"w-full h-full object-cover"},null,8,He)])):_("",!0),e("div",Re,[e("div",Ue,[e("span",{class:N(g.value)},$(x.value),3),e("span",We,[e("i",{class:N([b.value,"mr-1"])},null,2),A(" "+$(s.value),1)])]),i.value.description?(m(),y("p",Ge,$(i.value.description),1)):_("",!0),e("div",Ze,[e("div",Ye,[d[3]||(d[3]=e("i",{class:"fas fa-map-marker-alt text-gray-400 w-5 mt-0.5"},null,-1)),e("span",null,$(i.value.location||"Localização não especificada"),1)]),e("div",Je,[d[4]||(d[4]=e("i",{class:"fas fa-clock text-gray-400 w-5 mt-0.5"},null,-1)),e("span",null,$(F(me)(i.value.created_at)),1)])])]),e("div",Ke,[S(V,{variant:"primary",class:"flex-1",onClick:P},{default:z(()=>[...d[5]||(d[5]=[A(" Ver Detalhes ",-1)])]),_:1}),S(V,{variant:"outline",onClick:d[1]||(d[1]=D=>t.value=!1)},{default:z(()=>[...d[6]||(d[6]=[A(" Fechar ",-1)])]),_:1})])],64)):_("",!0)]),_:1},8,["modelValue","title"])]),_:1}))}});export{lt as default};
