import{r as P,a as z,U as re,V as ee,p as F,o as m,i as _,w as $,h as e,b as y,e as j,n as L,t as d,j as C,k as E,c as U,O as K,X as ie,T as oe,l as le,Q as de,F as X,s as W,C as ce,R as Z,S as Y,u as ue}from"./vue-vendor-DJ0JNZJp.js";import{s as B,b as T,u as G,a as te,_ as ne,d as H,g as J,e as Q,P as A,c as me,T as pe}from"./index-OUv6I-l5.js";import{u as fe}from"./useDocuments-CXrsqnOe.js";import{_ as xe}from"./MainLayout.vue_vue_type_script_setup_true_lang-D3S3XnV8.js";import{B as ae}from"./BaseModal-CnTmPs9q.js";import"./supabase-aQ0K3vAX.js";import"./logofmd-DeXnOIzE.js";function ge(){const g=P(!1),u=P(null),f=x=>{try{const p=new URL(x).pathname.split("/object/public/");return p.length===2?p[1]:null}catch{return null}},s=async x=>{try{if(!x.file_url)throw new Error("Documento nÃ£o possui arquivo");const t=f(x.file_url);if(t){const[p,...v]=t.split("/"),i=v.join("/"),{data:o,error:a}=await B.storage.from(p).download(i);if(a)throw a;if(!o)throw new Error("Nenhum dado recebido");const r=window.URL.createObjectURL(o),l=document.createElement("a");l.href=r,l.download=x.file_name||`${x.title}.${b(x.file_type||"")}`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(r)}else{const p=await fetch(x.file_url);if(!p.ok)throw new Error("Erro ao baixar arquivo");const v=await p.blob(),i=window.URL.createObjectURL(v),o=document.createElement("a");o.href=i,o.download=x.file_name||`${x.title}.${b(x.file_type||"")}`,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(i)}return{success:!0}}catch(t){return console.error("Erro ao baixar documento:",t),u.value=t.message,{success:!1,error:t.message}}},c=async x=>{g.value=!0,u.value=null;try{const{data:t,error:p}=await B.from("documents").select("*").eq("user_id",x).order("created_at",{ascending:!1});if(p)throw p;if(!t||t.length===0)throw new Error("Nenhum documento encontrado para backup");const v=t.filter(r=>r.file_url&&r.file_url.trim()!=="");if(v.length===0)throw new Error("Nenhum documento com arquivo encontrado para backup");console.log(`Iniciando backup de ${v.length} documentos...`);let i=0,o=0;const a=[];for(let r=0;r<v.length;r++){const l=v[r];try{r>0&&await new Promise(w=>setTimeout(w,800)),console.log(`Baixando ${r+1}/${v.length}: ${l.title}`);const k=f(l.file_url);if(k){const[w,...S]=k.split("/"),D=S.join("/"),{data:N,error:M}=await B.storage.from(w).download(D);if(M)throw console.error("Erro no download do Supabase:",M),M;if(!N)throw new Error("Nenhum dado recebido do Supabase Storage");const V=b(l.file_type||N.type),h=l.title.substring(0,50).replace(/[^a-z0-9_\-]/gi,"_").replace(/_+/g,"_").replace(/^_|_$/g,""),n=l.created_at?l.created_at.split("T")[0]:"sem_data",R=l.document_type||"doc",I=`${h}_${R}_${n}.${V}`,q=window.URL.createObjectURL(N),O=document.createElement("a");O.href=q,O.download=I,document.body.appendChild(O),O.click(),document.body.removeChild(O),window.URL.revokeObjectURL(q),i++,console.log(`âœ“ Baixado: ${I}`)}else{console.log("Usando fallback fetch...");const w=await fetch(l.file_url);if(!w.ok)throw new Error(`HTTP ${w.status}: ${w.statusText}`);const S=await w.blob();if(S.type==="application/json")throw new Error("URL retornou JSON ao invÃ©s de arquivo");const D=b(S.type||l.file_type),N=l.title.substring(0,50).replace(/[^a-z0-9_\-]/gi,"_").replace(/_+/g,"_").replace(/^_|_$/g,""),M=l.created_at?l.created_at.split("T")[0]:"sem_data",V=l.document_type||"doc",h=`${N}_${V}_${M}.${D}`,n=window.URL.createObjectURL(S),R=document.createElement("a");R.href=n,R.download=h,document.body.appendChild(R),R.click(),document.body.removeChild(R),window.URL.revokeObjectURL(n),i++,console.log(`âœ“ Baixado (fallback): ${h}`)}}catch(k){console.error(`âœ— Erro ao baixar "${l.title}":`,k.message),o++,a.push(l.title)}}if(console.log(`Backup finalizado: ${i} sucesso, ${o} falhas`),i===0)throw new Error(`Nenhum arquivo foi baixado com sucesso. ${a.length>0?"Documentos com erro: "+a.join(", "):""}`);return{success:!0,message:`Backup concluÃ­do! ${i} arquivo(s) baixado(s)${o>0?`, ${o} falhou(ram)`:""}`,details:{total:v.length,success:i,failed:o,failedDocs:a}}}catch(t){return console.error("Erro no backup:",t),u.value=t.message,{success:!1,error:t.message,details:null}}finally{g.value=!1}},b=x=>({"image/jpeg":"jpg","image/jpg":"jpg","image/png":"png","image/gif":"gif","image/webp":"webp","image/bmp":"bmp","image/svg+xml":"svg","application/pdf":"pdf","application/msword":"doc","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","application/vnd.ms-excel":"xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","text/plain":"txt","application/zip":"zip","application/x-rar-compressed":"rar"})[x.toLowerCase()]||"file";return{isBackingUp:g,error:u,downloadDocument:s,backupAllDocuments:c}}function ve(){const g=P({granted:!1,denied:!1,prompt:!0}),u=P(!1),f=P(null);async function s(){try{if(!navigator.permissions)return g.value;const t=await navigator.permissions.query({name:"camera"});return g.value={granted:t.state==="granted",denied:t.state==="denied",prompt:t.state==="prompt"},t.onchange=()=>{g.value={granted:t.state==="granted",denied:t.state==="denied",prompt:t.state==="prompt"}},g.value}catch(t){return console.error("Error checking camera permission:",t),g.value}}async function c(){try{if(u.value=!0,f.value=null,/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&"mediaDevices"in navigator){const p=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1});g.value.granted=!0,g.value.denied=!1,g.value.prompt=!1;const v=document.createElement("video");v.srcObject=p,v.play(),await new Promise(a=>{v.onloadedmetadata=a});const i=document.createElement("canvas");return i.width=v.videoWidth,i.height=v.videoHeight,i.getContext("2d")?.drawImage(v,0,0),p.getTracks().forEach(a=>a.stop()),new Promise(a=>{i.toBlob(r=>{if(r){const l=new File([r],`photo_${Date.now()}.jpg`,{type:"image/jpeg"});a(l)}},"image/jpeg",.9)})}else return await b()}catch(t){return console.error("Camera capture error:",t),t.name==="NotAllowedError"?(f.value="PermissÃ£o da cÃ¢mera negada",g.value.denied=!0,g.value.granted=!1):t.name==="NotFoundError"?f.value="CÃ¢mera nÃ£o encontrada":f.value="Erro ao acessar a cÃ¢mera",null}finally{u.value=!1}}async function b(){return new Promise(t=>{const p=document.createElement("input");p.type="file",p.accept="image/*",p.onchange=v=>{const i=v.target.files?.[0];t(i||null)},p.oncancel=()=>{t(null)},p.click()})}function x(){const t=navigator.userAgent.toLowerCase();return t.includes("chrome")?"Chrome: Clique no Ã­cone de cÃ¢mera na barra de endereÃ§o e permita o acesso.":t.includes("firefox")?"Firefox: Clique no Ã­cone de permissÃµes ao lado do endereÃ§o e permita a cÃ¢mera.":t.includes("safari")?"Safari: VÃ¡ em ConfiguraÃ§Ãµes > Safari > CÃ¢mera e permita para este site.":"Permita o acesso Ã  cÃ¢mera nas configuraÃ§Ãµes do seu navegador."}return{permissionState:g,isCapturing:u,error:f,checkPermission:s,capturePhoto:c,selectFromGallery:b,showPermissionHelp:x}}async function ye(g,u={}){const{maxWidth:f=1920,maxHeight:s=1920,quality:c=.8,mimeType:b="image/jpeg"}=u;return new Promise((x,t)=>{const p=new FileReader;p.onload=v=>{const i=new Image;i.onload=()=>{let{width:o,height:a}=i;if(o>f||a>s){const k=Math.min(f/o,s/a);o*=k,a*=k}const r=document.createElement("canvas");r.width=o,r.height=a;const l=r.getContext("2d");if(!l){t(new Error("Failed to get canvas context"));return}l.drawImage(i,0,0,o,a),r.toBlob(k=>{if(!k){t(new Error("Failed to compress image"));return}const w=new File([k],g.name,{type:b,lastModified:Date.now()});x(w)},b,c)},i.onerror=()=>t(new Error("Failed to load image")),i.src=v.target?.result},p.onerror=()=>t(new Error("Failed to read file")),p.readAsDataURL(g)})}const be={class:"space-y-4"},he={class:"flex justify-center"},ke={class:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center"},_e={class:"text-center"},we={class:"text-gray-600 dark:text-gray-400 mb-4"},$e={class:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 text-left"},Ce={class:"text-sm text-gray-600 dark:text-gray-400"},Pe={key:0,class:"bg-danger/10 border border-danger/20 rounded-lg p-3"},Ee={class:"flex space-x-2"},Ue=z({__name:"PermissionModal",props:re({type:{},denied:{type:Boolean,default:!1},helpText:{default:""}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:re(["allow"],["update:modelValue"]),setup(g,{emit:u}){const f=g,s=ee(g,"modelValue"),c=u,b=f.type==="camera"?"PermissÃ£o de CÃ¢mera":"PermissÃ£o de LocalizaÃ§Ã£o",x=f.type==="camera"?"fas fa-camera":"fas fa-map-marker-alt",t=f.type==="camera"?"Precisamos de acesso Ã  cÃ¢mera para tirar fotos dos documentos.":"Precisamos de acesso Ã  sua localizaÃ§Ã£o para mostrar documentos prÃ³ximos.",p=()=>{c("allow"),f.denied||(s.value=!1)};return(v,i)=>(m(),F(ae,{modelValue:s.value,"onUpdate:modelValue":i[1]||(i[1]=o=>s.value=o),title:_(b),maxWidth:"md"},{footer:$(()=>[e("div",Ee,[C(T,{variant:"outline",onClick:i[0]||(i[0]=o=>s.value=!1),class:"flex-1"},{default:$(()=>[...i[4]||(i[4]=[E(" Cancelar ",-1)])]),_:1}),C(T,{variant:"primary",onClick:p,class:"flex-1",disabled:g.denied},{default:$(()=>[E(d(g.denied?"Negado":"Permitir"),1)]),_:1},8,["disabled"])])]),default:$(()=>[e("div",be,[e("div",he,[e("div",ke,[e("i",{class:L([_(x),"text-3xl text-primary"])},null,2)])]),e("div",_e,[e("p",we,d(_(t)),1),e("div",$e,[i[2]||(i[2]=e("h4",{class:"font-medium text-sm text-gray-900 dark:text-dark-text mb-2"}," Como permitir: ",-1)),e("p",Ce,d(g.helpText),1)])]),g.denied?(m(),y("div",Pe,[...i[3]||(i[3]=[e("div",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-exclamation-triangle text-danger mt-0.5"}),e("div",{class:"flex-1 text-sm text-danger"},[e("p",{class:"font-medium"},"PermissÃ£o Negada"),e("p",{class:"mt-1"},"VocÃª precisarÃ¡ permitir manualmente nas configuraÃ§Ãµes do navegador.")])],-1)])])):j("",!0)])]),_:1},8,["modelValue","title"]))}}),Re={class:"relative inline-block"},Ve=["src","alt"],Te={key:1,class:"text-3xl font-bold text-gray-600 dark:text-gray-400"},Se={key:0,class:"absolute inset-0 bg-white/90 dark:bg-dark-bg/90 rounded-full flex items-center justify-center"},Me=z({__name:"ProfilePhotoUpload",setup(g){const u=G(),{capturePhoto:f,selectFromGallery:s,permissionState:c,showPermissionHelp:b,checkPermission:x}=ve(),{success:t,error:p}=te(),v=P(!1),i=P(!1),o=P(!1),a=U(()=>u.profile?.avatar_url),r=U(()=>u.profile?.full_name||"User"),l=U(()=>r.value.split(" ").map(h=>h[0]).slice(0,2).join("").toUpperCase()),k=U(()=>b()),w=()=>{v.value=!0},S=async()=>{if(v.value=!1,await x(),c.value.denied){i.value=!0;return}if(c.value.prompt){i.value=!0;return}await M(!0)},D=async()=>{v.value=!1,await M(!1)},N=async()=>{await M(!0)},M=async h=>{try{o.value=!0;const n=h?await f():await s();if(!n){o.value=!1;return}const R=await ye(n,{maxWidth:500,maxHeight:500,quality:.8}),I=`avatar_${u.user?.id}_${Date.now()}.jpg`,{error:q}=await B.storage.from("profiles").upload(I,R,{upsert:!0});if(q)throw q;const{data:O}=B.storage.from("profiles").getPublicUrl(I),se=await u.updateProfile({avatar_url:O.publicUrl});if(se.success)t("Foto de perfil atualizada!");else throw new Error(se.error)}catch(n){console.error("Upload error:",n),p(n.message||"Erro ao fazer upload da foto")}finally{o.value=!1}},V=async()=>{v.value=!1;try{o.value=!0;const h=await u.updateProfile({avatar_url:""});if(h.success)t("Foto de perfil removida!");else throw new Error(h.error)}catch(h){p(h.message||"Erro ao remover foto")}finally{o.value=!1}};return(h,n)=>(m(),y("div",Re,[e("div",{class:"w-24 h-24 rounded-full overflow-hidden bg-gray-200 dark:bg-gray-700 flex items-center justify-center cursor-pointer group",onClick:w},[a.value?(m(),y("img",{key:0,src:a.value,alt:r.value,class:"w-full h-full object-cover"},null,8,Ve)):(m(),y("span",Te,d(l.value),1)),n[4]||(n[4]=e("div",{class:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"},[e("i",{class:"fas fa-camera text-white text-2xl"})],-1))]),e("button",{class:"absolute bottom-0 right-0 w-8 h-8 bg-primary text-white rounded-full flex items-center justify-center shadow-lg hover:bg-primary-dark transition-colors",onClick:K(w,["stop"]),"aria-label":"Alterar foto"},[...n[5]||(n[5]=[e("i",{class:"fas fa-camera text-sm"},null,-1)])]),o.value?(m(),y("div",Se,[...n[6]||(n[6]=[e("div",{class:"spinner"},null,-1)])])):j("",!0),(m(),F(ie,{to:"body"},[C(oe,{name:"fade"},{default:$(()=>[v.value?(m(),y("div",{key:0,class:"fixed inset-0 bg-black/50 z-50 flex items-end md:items-center justify-center p-4",onClick:n[2]||(n[2]=R=>v.value=!1)},[e("div",{class:"bg-white dark:bg-dark-card rounded-t-xl md:rounded-xl w-full max-w-sm p-4 space-y-2",onClick:n[1]||(n[1]=K(()=>{},["stop"]))},[n[11]||(n[11]=e("h3",{class:"font-bold text-lg mb-4 text-center"},"Alterar Foto de Perfil",-1)),C(T,{variant:"outline","full-width":"",onClick:S,disabled:o.value},{default:$(()=>[...n[7]||(n[7]=[e("i",{class:"fas fa-camera mr-2"},null,-1),E(" Tirar Foto ",-1)])]),_:1},8,["disabled"]),C(T,{variant:"outline","full-width":"",onClick:D,disabled:o.value},{default:$(()=>[...n[8]||(n[8]=[e("i",{class:"fas fa-images mr-2"},null,-1),E(" Escolher da Galeria ",-1)])]),_:1},8,["disabled"]),a.value?(m(),F(T,{key:0,variant:"outline","full-width":"",onClick:V,disabled:o.value,class:"text-danger"},{default:$(()=>[...n[9]||(n[9]=[e("i",{class:"fas fa-trash mr-2"},null,-1),E(" Remover Foto ",-1)])]),_:1},8,["disabled"])):j("",!0),C(T,{variant:"secondary","full-width":"",onClick:n[0]||(n[0]=R=>v.value=!1)},{default:$(()=>[...n[10]||(n[10]=[E(" Cancelar ",-1)])]),_:1})])])):j("",!0)]),_:1})])),C(Ue,{modelValue:i.value,"onUpdate:modelValue":n[3]||(n[3]=R=>i.value=R),type:"camera",denied:_(c).denied,helpText:k.value,onAllow:N},null,8,["modelValue","denied","helpText"])]))}}),je=ne(Me,[["__scopeId","data-v-ff90dd30"]]),Ne={class:"space-y-4"},Le={class:"grid md:grid-cols-3 gap-4"},De=z({__name:"SubscriptionPlansModal",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:["update:modelValue"],setup(g){const u=ee(g,"modelValue"),f=G(),{success:s}=te(),c=U(()=>f.profile?.plan||"free"),b=x=>{s(`Funcionalidade de pagamento em breve para o plano ${x}!`),u.value=!1};return(x,t)=>(m(),F(ae,{modelValue:u.value,"onUpdate:modelValue":t[3]||(t[3]=p=>u.value=p),title:"Planos de SubscriÃ§Ã£o",maxWidth:"lg"},{default:$(()=>[e("div",Ne,[t[12]||(t[12]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400 mb-6"}," Escolha o plano que melhor se adapta Ã s suas necessidades. Economize mais com planos de longo prazo! ",-1)),e("div",Le,[e("div",{class:L(["border-2 rounded-xl p-6 transition-all hover:shadow-lg",c.value==="monthly"?"border-primary bg-primary/5":"border-gray-200 dark:border-gray-700"])},[t[4]||(t[4]=e("div",{class:"text-center mb-4"},[e("h3",{class:"text-xl font-bold text-gray-900 dark:text-dark-text"},"Mensal"),e("p",{class:"text-3xl font-bold text-gray-900 dark:text-dark-text mt-2"},"10 MZN"),e("p",{class:"text-sm text-gray-500"},"por mÃªs")],-1)),t[5]||(t[5]=e("ul",{class:"space-y-3 mb-6 text-sm"},[e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",null,"Uploads ilimitados")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",null,"Sem anÃºncios")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",null,"Busca avanÃ§ada")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",null,"NotificaÃ§Ãµes push")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",null,"Suporte prioritÃ¡rio")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",null,"Backup automÃ¡tico")])],-1)),C(T,{variant:"primary","full-width":"",onClick:t[0]||(t[0]=p=>b("monthly")),disabled:c.value==="monthly"},{default:$(()=>[E(d(c.value==="monthly"?"Plano Atual":"Selecionar"),1)]),_:1},8,["disabled"])],2),e("div",{class:L(["border-2 rounded-xl p-6 relative transition-all hover:shadow-lg",c.value==="quarterly"?"border-primary bg-primary/5":"border-primary"])},[t[6]||(t[6]=e("div",{class:"absolute -top-3 left-1/2 transform -translate-x-1/2"},[e("span",{class:"bg-primary text-white px-4 py-1 rounded-full text-xs font-bold"}," POPULAR ")],-1)),t[7]||(t[7]=e("div",{class:"text-center mb-4"},[e("h3",{class:"text-xl font-bold text-primary"},"Trimestral"),e("p",{class:"text-3xl font-bold text-gray-900 dark:text-dark-text mt-2"},"27 MZN"),e("p",{class:"text-sm text-gray-500"},"a cada 3 meses"),e("p",{class:"text-xs text-success font-semibold mt-1"},"Economize 10%")],-1)),t[8]||(t[8]=e("ul",{class:"space-y-3 mb-6 text-sm"},[e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-primary mt-1"}),e("span",{class:"font-medium"},"Uploads ilimitados")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-primary mt-1"}),e("span",{class:"font-medium"},"Sem anÃºncios")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-primary mt-1"}),e("span",{class:"font-medium"},"Busca avanÃ§ada")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-primary mt-1"}),e("span",{class:"font-medium"},"NotificaÃ§Ãµes push")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-primary mt-1"}),e("span",{class:"font-medium"},"Suporte prioritÃ¡rio")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-primary mt-1"}),e("span",{class:"font-medium"},"Backup automÃ¡tico")])],-1)),C(T,{variant:"primary","full-width":"",onClick:t[1]||(t[1]=p=>b("quarterly")),disabled:c.value==="quarterly"},{default:$(()=>[E(d(c.value==="quarterly"?"Plano Atual":"Selecionar"),1)]),_:1},8,["disabled"])],2),e("div",{class:L(["border-2 rounded-xl p-6 transition-all hover:shadow-lg",c.value==="annual"?"border-success bg-success/5":"border-success"])},[t[9]||(t[9]=e("div",{class:"absolute -top-3 left-1/2 transform -translate-x-1/2"},[e("span",{class:"bg-success text-white px-4 py-1 rounded-full text-xs font-bold"}," MELHOR VALOR ")],-1)),t[10]||(t[10]=e("div",{class:"text-center mb-4 mt-2"},[e("h3",{class:"text-xl font-bold text-success"},"Anual"),e("p",{class:"text-3xl font-bold text-gray-900 dark:text-dark-text mt-2"},"96 MZN"),e("p",{class:"text-sm text-gray-500"},"por ano"),e("p",{class:"text-xs text-success font-semibold mt-1"},"Economize 20%")],-1)),t[11]||(t[11]=e("ul",{class:"space-y-3 mb-6 text-sm"},[e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",{class:"font-medium"},"Uploads ilimitados")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",{class:"font-medium"},"Sem anÃºncios")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",{class:"font-medium"},"Busca avanÃ§ada")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",{class:"font-medium"},"NotificaÃ§Ãµes push")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",{class:"font-medium"},"Suporte prioritÃ¡rio")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-check text-success mt-1"}),e("span",{class:"font-medium"},"Backup automÃ¡tico")]),e("li",{class:"flex items-start space-x-2"},[e("i",{class:"fas fa-star text-warning-dark mt-1"}),e("span",{class:"font-medium text-warning-dark"},"2 meses grÃ¡tis")])],-1)),C(T,{variant:"success","full-width":"",onClick:t[2]||(t[2]=p=>b("annual")),disabled:c.value==="annual"},{default:$(()=>[E(d(c.value==="annual"?"Plano Atual":"Selecionar"),1)]),_:1},8,["disabled"])],2)]),t[13]||(t[13]=e("div",{class:"mt-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg text-center"},[e("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," ðŸ’³ Aceitamos M-Pesa, CartÃ£o de CrÃ©dito e TransferÃªncia BancÃ¡ria ")],-1))])]),_:1},8,["modelValue"]))}}),Oe={class:"space-y-6"},Ae={class:"card bg-gradient-to-br from-primary/10 to-primary/5 border border-primary/20"},Be={class:"text-center mb-4"},Fe={class:"text-5xl mb-2"},ze={class:"text-2xl font-bold text-gray-900 dark:text-dark-text"},Ie={class:"text-sm text-gray-600 dark:text-gray-400"},qe={class:"text-center mb-4"},He={class:"text-4xl font-bold text-primary"},Xe={key:0,class:"space-y-2"},We={class:"flex justify-between text-sm"},Ge={class:"font-semibold"},Ze={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3"},Ye={class:"text-xs text-gray-600 dark:text-gray-400 text-center"},Je={key:1,class:"text-center text-sm text-success font-semibold"},Qe={class:"card"},Ke={class:"space-y-2"},et={class:"text-sm text-gray-600 dark:text-gray-400"},tt={class:"text-sm font-semibold text-primary"},at={class:"card"},st={class:"flex items-center justify-between mb-4"},rt=["disabled"],ot={key:0,class:"text-center py-6 text-gray-500"},lt={key:1,class:"text-center py-6 text-gray-500"},nt={key:2,class:"space-y-2"},it={class:"flex-shrink-0 w-8 text-center"},dt={key:0,class:"text-2xl"},ct={key:1,class:"text-2xl"},ut={key:2,class:"text-2xl"},mt={key:3,class:"text-lg font-semibold text-gray-500"},pt=["src","alt"],ft={class:"flex-1 min-w-0"},xt={class:"font-semibold text-gray-900 dark:text-dark-text truncate"},gt={key:0,class:"text-xs text-primary ml-1"},vt={class:"text-xs text-gray-500"},yt={class:"flex-shrink-0 text-right"},bt={class:"font-bold text-primary"},ht=z({__name:"RankingsSection",props:{userPoints:{},currentUserId:{}},setup(g){const u=g,f=P([]),s=P(!1),c=U(()=>{const a=H(u.userPoints);return J(a)}),b=U(()=>{const a=H(u.userPoints),r=Q(a);return r?J(r.rank):null}),x=U(()=>{const a=H(u.userPoints),r=Q(a);return r?r.pointsNeeded:0}),t=U(()=>{const a=H(u.userPoints),r=Q(a);if(!r)return 100;const l=v(a),k=r.pointsNeeded+l,w=u.userPoints-l,S=k-l;return Math.min(Math.round(w/S*100),100)}),p=U(()=>({documentMatch:{label:"Match de documento",points:A.DOCUMENT_MATCH},reportDocument:{label:"Reportar documento",points:A.REPORT_DOCUMENT},verifyDocument:{label:"Verificar documento",points:A.VERIFY_DOCUMENT},helpOthers:{label:"Ajudar outros usuÃ¡rios",points:A.HELP_OTHERS},completeProfile:{label:"Completar perfil",points:A.COMPLETE_PROFILE},dailyLogin:{label:"Login diÃ¡rio",points:A.DAILY_LOGIN}})),v=a=>({bronze:0,silver:100,gold:500,platinum:1e3})[a]||0,i=a=>{const r=H(a);return J(r)?.name||"Bronze"},o=async()=>{s.value=!0;try{const{data:a,error:r}=await B.from("user_profiles").select("id, full_name, points, avatar_url").order("points",{ascending:!1}).limit(10);if(r)throw r;f.value=a||[]}catch(a){console.error("Erro ao carregar leaderboard:",a)}finally{s.value=!1}};return le(()=>{o()}),(a,r)=>(m(),y("div",Oe,[e("div",Ae,[e("div",Be,[e("div",Fe,d(c.value.icon),1),e("h3",ze,d(c.value.name),1),e("p",Ie,d(c.value.description),1)]),e("div",qe,[e("p",He,d(g.userPoints),1),r[0]||(r[0]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"pontos",-1))]),b.value?(m(),y("div",Xe,[e("div",We,[r[1]||(r[1]=e("span",{class:"text-gray-600 dark:text-gray-400"},"PrÃ³ximo nÃ­vel:",-1)),e("span",Ge,d(b.value.name)+" "+d(b.value.icon),1)]),e("div",Ze,[e("div",{class:"bg-gradient-to-r from-primary to-primary-dark h-3 rounded-full transition-all duration-500",style:de({width:`${t.value}%`})},null,4)]),e("p",Ye," Faltam "+d(x.value)+" pontos para o prÃ³ximo nÃ­vel ",1)])):(m(),y("div",Je," ðŸŽ‰ VocÃª atingiu o nÃ­vel mÃ¡ximo! "))]),e("div",Qe,[r[2]||(r[2]=e("h4",{class:"font-semibold text-gray-900 dark:text-dark-text mb-3"}," Como ganhar pontos? ",-1)),e("div",Ke,[(m(!0),y(X,null,W(p.value,(l,k)=>(m(),y("div",{key:k,class:"flex items-center justify-between"},[e("span",et,d(l.label),1),e("span",tt,"+"+d(l.points),1)]))),128))])]),e("div",at,[e("div",st,[r[4]||(r[4]=e("h4",{class:"font-semibold text-gray-900 dark:text-dark-text"}," ðŸ† Top UsuÃ¡rios ",-1)),e("button",{onClick:o,class:"text-sm text-primary hover:underline",disabled:s.value},[e("i",{class:L(["fas fa-sync-alt",{"fa-spin":s.value}])},null,2),r[3]||(r[3]=E(" Atualizar ",-1))],8,rt)]),s.value?(m(),y("div",ot," Carregando ranking... ")):f.value.length===0?(m(),y("div",lt," Nenhum usuÃ¡rio no ranking ainda ")):(m(),y("div",nt,[(m(!0),y(X,null,W(f.value,(l,k)=>(m(),y("div",{key:l.id,class:L(["flex items-center space-x-3 p-3 rounded-lg transition-colors",l.id===g.currentUserId?"bg-primary/10 border border-primary/30":"hover:bg-gray-50 dark:hover:bg-gray-800"])},[e("div",it,[k===0?(m(),y("span",dt,"ðŸ¥‡")):k===1?(m(),y("span",ct,"ðŸ¥ˆ")):k===2?(m(),y("span",ut,"ðŸ¥‰")):(m(),y("span",mt,d(k+1),1))]),e("img",{src:l.avatar_url||"https://placehold.co/48x48",alt:l.full_name,class:"w-12 h-12 rounded-full object-cover"},null,8,pt),e("div",ft,[e("p",xt,[E(d(l.full_name||"UsuÃ¡rio")+" ",1),l.id===g.currentUserId?(m(),y("span",gt,"(VocÃª)")):j("",!0)]),e("p",vt,d(i(l.points||0)),1)]),e("div",yt,[e("p",bt,d(l.points||0),1),r[5]||(r[5]=e("p",{class:"text-xs text-gray-500"},"pontos",-1))])],2))),128))]))])]))}}),kt={key:0,class:"text-xs text-red-500 mt-1"},_t={class:"flex"},wt={key:0,class:"text-xs text-red-500 mt-1"},$t={class:"text-xs text-gray-500 mt-1"},Ct={key:0,class:"text-xs text-red-500 mt-1"},Pt={key:0,class:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg"},Et={class:"text-sm text-red-600 dark:text-red-400"},Ut={key:1,class:"p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg"},Rt={class:"text-sm text-green-600 dark:text-green-400"},Vt={class:"flex space-x-3"},Tt=z({__name:"ProfileEditModal",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:["update:modelValue"],setup(g){const u=ee(g,"modelValue"),f=G(),s=P({full_name:"",phone_number:"",delivery_address:""}),c=P({}),b=P(""),x=P(""),t=P(!1);ce(u,o=>{o&&f.profile&&(s.value={full_name:f.profile.full_name||"",phone_number:f.profile.phone_number?.replace("+258","")||"",delivery_address:f.profile.delivery_address||""},c.value={},b.value="",x.value="")});const p=U(()=>s.value.full_name.length>=3&&s.value.phone_number.length===9&&/^[0-9]{9}$/.test(s.value.phone_number)&&(s.value.delivery_address?.length||0)<=200),v=()=>{c.value={};let o=!0;return s.value.full_name.length<3&&(c.value.full_name="Nome deve ter pelo menos 3 caracteres",o=!1),/^[0-9]{9}$/.test(s.value.phone_number)||(c.value.phone_number="Telefone deve ter 9 dÃ­gitos",o=!1),(s.value.delivery_address?.length||0)>200&&(c.value.delivery_address="EndereÃ§o deve ter no mÃ¡ximo 200 caracteres",o=!1),o},i=async()=>{if(b.value="",x.value="",!v()){b.value="Por favor, corrija os erros no formulÃ¡rio";return}t.value=!0;try{let o={full_name:s.value.full_name,phone_number:`+258${s.value.phone_number}`};s.value.delivery_address&&(o.delivery_address=s.value.delivery_address);const a=await f.updateProfile(o);if(a.success)x.value="Perfil atualizado com sucesso!",setTimeout(()=>{u.value=!1},1500);else if(a.error?.includes("delivery_address")||a.error?.includes("column")){console.warn("Campo delivery_address nÃ£o existe, tentando sem ele...");const r={full_name:s.value.full_name,phone_number:`+258${s.value.phone_number}`},l=await f.updateProfile(r);l.success?(x.value="Perfil atualizado! (EndereÃ§o nÃ£o salvo - execute a migraÃ§Ã£o do banco)",setTimeout(()=>{u.value=!1},2e3)):b.value=l.error||"Erro ao atualizar perfil"}else b.value=a.error||"Erro ao atualizar perfil"}catch(o){b.value=o.message||"Erro inesperado ao atualizar perfil"}finally{t.value=!1}};return(o,a)=>(m(),F(ae,{modelValue:u.value,"onUpdate:modelValue":a[4]||(a[4]=r=>u.value=r),title:"Editar Perfil",maxWidth:"lg"},{footer:$(()=>[e("div",Vt,[C(T,{variant:"secondary","full-width":"",onClick:a[3]||(a[3]=r=>u.value=!1),disabled:t.value},{default:$(()=>[...a[12]||(a[12]=[E(" Cancelar ",-1)])]),_:1},8,["disabled"]),C(T,{variant:"primary","full-width":"",onClick:i,loading:t.value,disabled:!p.value},{default:$(()=>[...a[13]||(a[13]=[E(" Salvar AlteraÃ§Ãµes ",-1)])]),_:1},8,["loading","disabled"])])]),default:$(()=>[e("form",{onSubmit:K(i,["prevent"]),class:"space-y-4"},[e("div",null,[a[5]||(a[5]=e("label",{for:"fullName",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Nome Completo * ",-1)),Z(e("input",{id:"fullName","onUpdate:modelValue":a[0]||(a[0]=r=>s.value.full_name=r),type:"text",required:"",minlength:"3",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-dark-card dark:text-dark-text",placeholder:"Digite seu nome completo"},null,512),[[Y,s.value.full_name]]),c.value.full_name?(m(),y("p",kt,d(c.value.full_name),1)):j("",!0)]),e("div",null,[a[7]||(a[7]=e("label",{for:"phoneNumber",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Telefone Celular * ",-1)),e("div",_t,[a[6]||(a[6]=e("span",{class:"inline-flex items-center px-3 text-sm text-gray-900 bg-gray-200 border border-r-0 border-gray-300 rounded-l-lg dark:bg-gray-600 dark:text-gray-400 dark:border-gray-600"}," +258 ",-1)),Z(e("input",{id:"phoneNumber","onUpdate:modelValue":a[1]||(a[1]=r=>s.value.phone_number=r),type:"tel",required:"",pattern:"[0-9]{9}",maxlength:"9",class:"rounded-none rounded-r-lg flex-1 min-w-0 px-4 py-2 border border-gray-300 dark:border-gray-600 focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-dark-card dark:text-dark-text",placeholder:"XX XXX XXXX"},null,512),[[Y,s.value.phone_number]])]),a[8]||(a[8]=e("p",{class:"text-xs text-gray-500 mt-1"},"Formato: 9 dÃ­gitos (ex: 841234567)",-1)),c.value.phone_number?(m(),y("p",wt,d(c.value.phone_number),1)):j("",!0)]),e("div",null,[a[9]||(a[9]=e("label",{for:"deliveryAddress",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," EndereÃ§o para Entrega de Documentos ",-1)),Z(e("textarea",{id:"deliveryAddress","onUpdate:modelValue":a[2]||(a[2]=r=>s.value.delivery_address=r),rows:"3",maxlength:"200",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-dark-card dark:text-dark-text resize-none",placeholder:"Rua, bairro, cidade... (opcional)"},null,512),[[Y,s.value.delivery_address]]),e("p",$t,d(s.value.delivery_address?.length||0)+"/200 caracteres ",1),c.value.delivery_address?(m(),y("p",Ct,d(c.value.delivery_address),1)):j("",!0)]),b.value?(m(),y("div",Pt,[e("p",Et,[a[10]||(a[10]=e("i",{class:"fas fa-exclamation-circle mr-1"},null,-1)),E(" "+d(b.value),1)])])):j("",!0),x.value?(m(),y("div",Ut,[e("p",Rt,[a[11]||(a[11]=e("i",{class:"fas fa-check-circle mr-1"},null,-1)),E(" "+d(x.value),1)])])):j("",!0)],32)]),_:1},8,["modelValue"]))}}),St={class:"px-4 py-6 space-y-6"},Mt={class:"card text-center"},jt={class:"flex justify-center mb-4"},Nt={class:"text-xl font-bold text-gray-900 dark:text-dark-text mb-1"},Lt={class:"text-gray-600 dark:text-gray-400 mb-4"},Dt={class:"grid grid-cols-3 gap-4 pt-4 border-t border-gray-200 dark:border-dark-border"},Ot={class:"text-2xl font-bold text-primary"},At={class:"text-xs text-gray-500"},Bt={class:"text-2xl font-bold text-success"},Ft={class:"text-xs text-gray-500"},zt={class:"text-xs text-gray-500 capitalize"},It={key:0,class:"mt-6"},qt={class:"card divide-y divide-gray-200 dark:divide-dark-border"},Ht=["onClick"],Xt={class:"flex items-center space-x-3"},Wt={class:"text-gray-900 dark:text-dark-text"},Gt={class:"text-center text-sm text-gray-500"},Zt={class:"card mt-6"},Yt={class:"flex items-center justify-between mb-3"},Jt={class:"text-lg font-semibold text-gray-900 dark:text-dark-text"},Qt={class:"flex items-center space-x-2"},Kt={key:0,class:"text-gray-500"},ea={key:1,class:"text-red-500"},ta={key:2,class:"text-gray-500"},aa={key:3,class:"space-y-3"},sa={class:"min-w-0"},ra={class:"font-medium text-gray-900 dark:text-dark-text truncate"},oa={class:"text-xs text-gray-500 capitalize"},la={class:"text-xs text-gray-400"},na=z({__name:"ProfileView",setup(g){const u=ue(),f=G(),{t:s}=me(),{success:c,error:b}=te(),{items:x,loading:t,error:p,fetchMyDocuments:v}=fe(),{backupAllDocuments:i}=ge(),o=P(!1),a=P(!1),r=P(!1),l=P(!1),k=U(()=>f.user),w=U(()=>f.profile),S=()=>{r.value=!r.value},D=async()=>{if(!f.userId)return;const V=await i(f.userId);V.success?c(V.message||s("profile.backupSuccess")):b(V.error||s("profile.backupError"))},N=async()=>{o.value=!0;const V=await f.signOut();o.value=!1,V.success&&(c(s("auth.logoutSuccess")),u.push("/login"))},M=U(()=>[{icon:"fas fa-user-edit",label:s("profile.menu.editProfile"),action:()=>l.value=!0},{icon:"fas fa-file-alt",label:s("profile.menu.myDocuments"),action:()=>u.push("/documents")},{icon:"fas fa-crown",label:s("profile.menu.subscriptionPlans"),action:()=>a.value=!0},{icon:"fas fa-bell",label:s("profile.menu.notifications"),action:()=>u.push("/notifications")},{icon:"fas fa-lock",label:s("profile.menu.privacy"),action:()=>{c(s("profile.featureSoon"))}},{icon:"fas fa-question-circle",label:s("profile.menu.help"),action:()=>{c(s("profile.featureSoon"))}},{icon:"fas fa-download",label:s("profile.menu.backup"),action:D},{icon:"fas fa-cog",label:s("profile.menu.settings"),action:()=>{c(s("profile.featureSoon"))}},{icon:"fas fa-sign-out-alt",label:s("profile.menu.logout"),action:N}]);return le(async()=>{f.user?.id&&await v(f.user.id)}),(V,h)=>(m(),F(xe,null,{default:$(()=>[e("div",St,[e("div",Mt,[e("div",jt,[C(je)]),e("h2",Nt,d(w.value?.full_name||_(s)("profile.user")),1),e("p",Lt,d(k.value?.email),1),e("div",Dt,[e("div",null,[e("p",Ot,d(w.value?.document_count||0),1),e("p",At,d(_(s)("profile.documents")),1)]),e("div",{class:"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg p-2 -m-2 transition-colors",onClick:S},[e("p",Bt,d(w.value?.points||0),1),e("p",Ft,[E(d(_(s)("profile.points"))+" ",1),e("i",{class:L(["fas fa-chevron-down ml-1 text-xs",{"rotate-180":r.value}])},null,2)])]),e("div",null,[h[4]||(h[4]=e("p",{class:"text-2xl font-bold text-warning-dark"},[e("i",{class:"fas fa-crown"})],-1)),e("p",zt,d(w.value?.plan?_(s)(`profile.plans.${w.value.plan}`):_(s)("profile.plans.free")),1)])])]),C(oe,{name:"slide-fade"},{default:$(()=>[r.value?(m(),y("div",It,[C(ht,{"user-points":w.value?.points||0,"current-user-id":k.value?.id||""},null,8,["user-points","current-user-id"])])):j("",!0)]),_:1}),e("div",qt,[(m(!0),y(X,null,W(M.value,n=>(m(),y("button",{key:n.label,class:"flex items-center justify-between px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors w-full text-left",onClick:n.action},[e("div",Xt,[e("i",{class:L([n.icon,"text-gray-600 dark:text-gray-400 w-5"])},null,2),e("span",Wt,d(n.label),1)]),h[5]||(h[5]=e("i",{class:"fas fa-chevron-right text-gray-400 text-sm"},null,-1))],8,Ht))),128))]),C(T,{variant:"danger",size:"lg","full-width":"",onClick:N,loading:o.value},{default:$(()=>[h[6]||(h[6]=e("i",{class:"fas fa-sign-out-alt mr-2"},null,-1)),E(" "+d(_(s)("profile.menu.logout")),1)]),_:1},8,["loading"]),e("p",Gt,d(_(s)("profile.version"))+" 0.2.1 ",1)]),C(De,{modelValue:a.value,"onUpdate:modelValue":h[0]||(h[0]=n=>a.value=n)},null,8,["modelValue"]),C(Tt,{modelValue:l.value,"onUpdate:modelValue":h[1]||(h[1]=n=>l.value=n)},null,8,["modelValue"]),e("div",Zt,[e("div",Yt,[e("h3",Jt,d(_(s)("profile.myDocs")),1),e("div",Qt,[e("button",{class:"text-primary text-sm flex items-center space-x-1 hover:underline",onClick:h[2]||(h[2]=n=>_(u).push("/save-document"))},[h[7]||(h[7]=e("i",{class:"fas fa-plus text-xs"},null,-1)),e("span",null,d(_(s)("profile.addDocument")),1)]),e("button",{class:"text-primary text-sm hover:underline",onClick:h[3]||(h[3]=n=>_(u).push("/documents"))},d(_(s)("profile.viewAll")),1)])]),_(t)?(m(),y("div",Kt,d(_(s)("profile.loading")),1)):_(p)?(m(),y("div",ea,d(_(p)),1)):_(x).length===0?(m(),y("div",ta,d(_(s)("profile.noDocs")),1)):(m(),y("ul",aa,[(m(!0),y(X,null,W(_(x).slice(0,3),n=>(m(),y("li",{key:n.id,class:"flex items-center justify-between border border-gray-200 dark:border-dark-border rounded-lg px-3 py-2"},[e("div",sa,[e("p",ra,d(n.title),1),e("p",oa,d(n.status),1)]),e("span",la,d(new Date(n.created_at).toLocaleDateString("pt-BR")),1)]))),128))]))]),C(pe)]),_:1}))}}),xa=ne(na,[["__scopeId","data-v-adfb1a1f"]]);export{xa as default};
