const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/documentMatching-yX_PRZdu.js","assets/index-mTKM-63l.js","assets/vue-vendor-DaTTP-8l.js","assets/supabase-DO0Dm75k.js","assets/index--2TVr68h.css"])))=>i.map(i=>d[i]);
var v=(a,o,r)=>new Promise((u,i)=>{var h=c=>{try{w(r.next(c))}catch(E){i(E)}},g=c=>{try{w(r.throw(c))}catch(E){i(E)}},w=c=>c.done?u(c.value):Promise.resolve(c.value).then(h,g);w((r=r.apply(a,o)).next())});import{s as m,c as L}from"./index-mTKM-63l.js";import{d as O,r as _,c as z}from"./vue-vendor-DaTTP-8l.js";const V=O("documents",()=>{const a=_([]),o=_(null),r=_(!1),u=_(null),i=_(!0),h=_(0),g=20,w=z(()=>a.value.filter(t=>t.status==="lost")),c=z(()=>a.value.filter(t=>t.status==="found"));function E(t=!1){return v(this,null,function*(){if(t&&(h.value=0,a.value=[],i.value=!0),!i.value&&!t)return{success:!0};r.value=!0,u.value=null;try{const e=h.value*g,l=e+g-1,{data:s,error:f}=yield m.from("documents").select("*").in("status",["lost","found"]).order("created_at",{ascending:!1}).range(e,l);if(f)throw f;return s&&(t?a.value=s:a.value.push(...s),i.value=s.length===g,s.length>0&&h.value++),{success:!0}}catch(e){return u.value=e.message||"Erro ao carregar documentos",{success:!1,error:u.value}}finally{r.value=!1}})}function M(t){return v(this,null,function*(){r.value=!0,u.value=null;try{const{data:e,error:l}=yield m.from("documents").select("*").eq("id",t).single();if(l)throw l;return e&&(o.value=e),{success:!0,data:e}}catch(e){return u.value=e.message||"Erro ao carregar documento",{success:!1,error:u.value}}finally{r.value=!1}})}function $(t,e){return v(this,null,function*(){var l,s,f;r.value=!0,u.value=null;try{let d="",p="";if(e.file){const b=e.file.name.split(".").pop();p=`documents/${`${t}_${Date.now()}.${b}`}`;const{error:x}=yield m.storage.from("documents").upload(p,e.file);if(x)throw x;const{data:y}=m.storage.from("documents").getPublicUrl(p);d=y.publicUrl}const N={user_id:t,title:e.title,type:e.type,status:e.status,description:e.description||"",location:e.location||"",document_number:e.documentNumber||"",issue_date:e.issueDate||null,expiry_date:e.expiryDate||null,issue_place:e.issuePlace||"",issuing_authority:e.issuingAuthority||"",country_of_issue:e.countryOfIssue||"",file_url:d,file_path:p,file_name:((l=e.file)==null?void 0:l.name)||"",file_size:((s=e.file)==null?void 0:s.size)||null,file_type:((f=e.file)==null?void 0:f.type)||"",is_verified:!1,verification_status:"pending",is_public:!0,is_archived:!1},{data:n,error:S}=yield m.from("documents").insert([N]).select().single();if(S)throw S;return n&&(a.value.unshift(n),(n.status==="lost"||n.status==="found")&&L(()=>v(this,null,function*(){const{findDocumentMatches:b,notifyMatch:P}=yield import("./documentMatching-yX_PRZdu.js");return{findDocumentMatches:b,notifyMatch:P}}),__vite__mapDeps([0,1,2,3,4])).then(({findDocumentMatches:b,notifyMatch:P})=>{b(n).then(x=>{if(x.length>0){const y=x[0];if(y.matchScore>=50){const U=n.status==="lost"?n:y.document,A=n.status==="found"?n:y.document;P(U,A,y.matchScore)}}})})),{success:!0,data:n}}catch(d){return u.value=d.message||"Erro ao criar documento",{success:!1,error:u.value}}finally{r.value=!1}})}function q(t,e){return v(this,null,function*(){var l;r.value=!0,u.value=null;try{const{data:s,error:f}=yield m.from("documents").update(e).eq("id",t).select().single();if(f)throw f;if(s){const d=a.value.findIndex(p=>p.id===t);d!==-1&&(a.value[d]=s),((l=o.value)==null?void 0:l.id)===t&&(o.value=s)}return{success:!0,data:s}}catch(s){return u.value=s.message||"Erro ao atualizar documento",{success:!1,error:u.value}}finally{r.value=!1}})}function D(t){return v(this,null,function*(){var e;r.value=!0,u.value=null;try{const{error:l}=yield m.from("documents").delete().eq("id",t);if(l)throw l;return a.value=a.value.filter(s=>s.id!==t),((e=o.value)==null?void 0:e.id)===t&&(o.value=null),{success:!0}}catch(l){return u.value=l.message||"Erro ao deletar documento",{success:!1,error:u.value}}finally{r.value=!1}})}function I(){a.value=[],o.value=null,h.value=0,i.value=!0}return{documents:a,currentDocument:o,isLoading:r,error:u,hasMore:i,lostDocuments:w,foundDocuments:c,fetchDocuments:E,fetchDocumentById:M,createDocument:$,updateDocument:q,deleteDocument:D,clearDocuments:I}});export{V as u};
