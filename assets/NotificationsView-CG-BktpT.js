var u=(n,o,a)=>new Promise((f,i)=>{var d=c=>{try{l(a.next(c))}catch(y){i(y)}},b=c=>{try{l(a.throw(c))}catch(y){i(y)}},l=c=>c.done?f(c.value):Promise.resolve(c.value).then(d,b);l((a=a.apply(n,o)).next())});import{a as L,r as C,c as _,l as V,X as U,p as z,w as F,u as H,o as h,h as r,b as g,n as p,t as v,F as O,s as P,e as Q,O as X}from"./vue-vendor-CG29anWM.js";import{u as G,a as J}from"./index-B08B60nw.js";import{s as k}from"./supabase-BKG7TyJy.js";import{_ as K}from"./MainLayout.vue_vue_type_script_setup_true_lang-sotrVGtC.js";import"./supabase-DO0Dm75k.js";import"./logofmd-DeXnOIzE.js";const $={fetch(n){return u(this,null,function*(){const{data:o,error:a}=yield k.from("notifications").select("*").eq("user_id",n).order("created_at",{ascending:!1});if(a)throw a;return o||[]})},markAsRead(n){return u(this,null,function*(){const{data:o,error:a}=yield k.from("notifications").update({read:!0}).eq("id",n).select().single();if(a)throw a;return o})},subscribeToUser(n,o){const a=k.channel(`notifications:${n}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`user_id=eq.${n}`},f=>{o(f.new)}).subscribe();return()=>{k.removeChannel(a)}}},W={class:"px-4 py-6 space-y-6"},Y={class:"flex rounded-full bg-gray-100 dark:bg-dark-card p-1"},Z={key:0,class:"text-center py-12 card"},ee={class:"text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2"},te={class:"text-gray-500 dark:text-gray-400"},se={key:1,class:"space-y-3"},ae=["onClick"],re={class:"flex items-start space-x-3"},oe={class:"flex-1 min-w-0"},ne={class:"font-semibold text-gray-900 dark:text-dark-text mb-1"},le={class:"text-sm text-gray-600 dark:text-gray-400 mb-2"},ce={class:"text-xs text-gray-500"},ie=["onClick"],pe=L({__name:"NotificationsView",setup(n){const o=H(),a=G(),{error:f}=J(),i=C("all"),d=C([]),b=C(!1);let l=null;const c=_(()=>d.value),y=_(()=>d.value.filter(e=>e.type==="message")),N=_(()=>i.value==="all"?c.value:y.value),I=_(()=>i.value==="chats"?{title:"Sem conversas",subtitle:"Quando alguém enviar uma mensagem, ela aparecerá aqui."}:{title:"Sem notificações",subtitle:"Você está em dia!"}),M=e=>e?"opacity-60":"",R=e=>{const t="flex-1 py-2 rounded-full text-sm font-semibold transition-colors";return i.value===e?`${t} bg-white dark:bg-dark-bg text-primary shadow`:`${t} text-gray-500`},A=e=>{const t={match:"w-10 h-10 rounded-full bg-success/10 text-success flex items-center justify-center",message:"w-10 h-10 rounded-full bg-primary/10 text-primary flex items-center justify-center",system:"w-10 h-10 rounded-full bg-gray-100 dark:bg-dark-card text-gray-600 dark:text-gray-400 flex items-center justify-center",verification:"w-10 h-10 rounded-full bg-warning/10 text-warning-dark flex items-center justify-center"};return t[e]||t.system},B=e=>({match:"fas fa-check-double",message:"fas fa-envelope",system:"fas fa-info-circle",verification:"fas fa-shield-alt"})[e]||"fas fa-bell",q=e=>{const t=new Date,s=new Date(e),m=t.getTime()-s.getTime(),x=Math.floor(m/6e4),w=Math.floor(x/60),T=Math.floor(w/24);return x<1?"Agora":x<60?`${x}m atrás`:w<24?`${w}h atrás`:T<7?`${T}d atrás`:s.toLocaleDateString("pt-BR",{day:"2-digit",month:"short"})},D=()=>u(this,null,function*(){if(!a.userId){o.push({name:"Login",query:{redirect:o.currentRoute.value.fullPath}});return}b.value=!0;try{d.value=yield $.fetch(a.userId)}catch(e){f(e.message||"Erro ao carregar notificações")}finally{b.value=!1}}),E=()=>{!a.userId||l||(l=$.subscribeToUser(a.userId,e=>{d.value=[e,...d.value]}))},j=e=>u(this,null,function*(){var t,s,m;yield S(e.id),e.type==="match"&&((t=e.data)!=null&&t.documentId)?o.push(`/document/${e.data.documentId}`):e.type==="message"&&((s=e.data)!=null&&s.documentId)?o.push(`/chat/${e.data.documentId}`):e.type==="verification"&&((m=e.data)!=null&&m.documentId)&&o.push(`/document/${e.data.documentId}`)}),S=e=>u(this,null,function*(){const t=d.value.find(s=>s.id===e);if(!(!t||t.read)){t.read=!0;try{yield $.markAsRead(e)}catch(s){f(s.message||"Erro ao atualizar notificação"),t.read=!1}}});return V(()=>u(this,null,function*(){yield D(),E()})),U(()=>{l&&(l(),l=null)}),(e,t)=>(h(),z(K,null,{default:F(()=>[r("div",W,[r("div",Y,[r("button",{class:p(R("all")),onClick:t[0]||(t[0]=s=>i.value="all")}," Notificações ",2),r("button",{class:p(R("chats")),onClick:t[1]||(t[1]=s=>i.value="chats")}," Conversas ",2)]),N.value.length===0?(h(),g("div",Z,[t[2]||(t[2]=r("i",{class:"fas fa-bell-slash text-gray-400 text-6xl mb-4"},null,-1)),r("h3",ee,v(I.value.title),1),r("p",te,v(I.value.subtitle),1)])):(h(),g("div",se,[(h(!0),g(O,null,P(N.value,s=>(h(),g("div",{key:s.id,class:p([M(s.read),"card card-hover"]),onClick:m=>j(s)},[r("div",re,[r("div",{class:p(A(s.type))},[r("i",{class:p(B(s.type))},null,2)],2),r("div",oe,[r("h4",ne,v(s.title),1),r("p",le,v(s.message),1),r("p",ce,v(q(s.created_at)),1)]),s.read?Q("",!0):(h(),g("button",{key:0,class:"w-2 h-2 rounded-full bg-primary",onClick:X(m=>S(s.id),["stop"])},null,8,ie))])],10,ae))),128))]))])]),_:1}))}});export{pe as default};
