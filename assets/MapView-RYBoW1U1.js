var x=(c,u,r)=>new Promise((e,d)=>{var m=t=>{try{s(r.next(t))}catch(n){d(n)}},l=t=>{try{s(r.throw(t))}catch(n){d(n)}},s=t=>t.done?e(t.value):Promise.resolve(t.value).then(m,l);s((r=r.apply(c,u)).next())});import{r as h,a as T,l as E,m as U,C as W,b,o as g,h as a,e as w,O as q,i as I,c as _,p as N,W as R,j as M,T as Y,w as z,N as Z,n as D,f as B,t as C,k as V,F as J,u as K}from"./vue-vendor-DaTTP-8l.js";import{u as Q}from"./documents-G8DuhIIf.js";import{_ as X}from"./MainLayout.vue_vue_type_script_setup_true_lang-CQQYmHfC.js";import{b as ee,_ as A}from"./index-mTKM-63l.js";import"./supabase-DO0Dm75k.js";function te(c){const u=new Date,r=typeof c=="string"?new Date(c):c,e=u.getTime()-r.getTime(),d=Math.floor(e/1e3),m=Math.floor(d/60),l=Math.floor(m/60),s=Math.floor(l/24),t=Math.floor(s/7),n=Math.floor(s/30),f=Math.floor(s/365);return d<60?"Agora":m<60?`${m}m`:l<24?`${l}h`:s<7?`${s}d`:t<4?`${t} sem${t>1?"s":""}`:n<12?`${n} mês${n>1?"es":""}`:`${f} ano${f>1?"s":""}`}function ae(){const c=h(null),u=h(null),r=h(!1),e="geolocation"in navigator,d=()=>x(this,null,function*(){return e?(r.value=!0,u.value=null,new Promise(t=>{navigator.geolocation.getCurrentPosition(n=>{const f={latitude:n.coords.latitude,longitude:n.coords.longitude,accuracy:n.coords.accuracy};c.value=f,r.value=!1,t(f)},n=>{u.value={code:n.code,message:s(n.code)},r.value=!1,t(null)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})})):(u.value={code:0,message:"Geolocalização não suportada neste navegador"},null)}),m=t=>e?navigator.geolocation.watchPosition(f=>{const i={latitude:f.coords.latitude,longitude:f.coords.longitude,accuracy:f.coords.accuracy};c.value=i,t(i)},f=>{u.value={code:f.code,message:s(f.code)}},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}):(u.value={code:0,message:"Geolocalização não suportada neste navegador"},null),l=t=>{e&&t&&navigator.geolocation.clearWatch(t)},s=t=>{switch(t){case 1:return"Permissão de localização negada";case 2:return"Localização indisponível";case 3:return"Tempo limite excedido";default:return"Erro ao obter localização"}};return{coordinates:c,error:u,isLoading:r,isSupported:e,getCurrentPosition:d,watchPosition:m,clearWatch:l}}const se={class:"relative w-full h-full"},oe={key:0,class:"absolute inset-0 bg-white/80 dark:bg-dark-bg/80 flex items-center justify-center"},le={class:"absolute top-4 right-4 space-y-2"},re=["disabled"],ne=T({__name:"MapComponent",props:{documents:{default:()=>[]},center:{default:()=>[-25.9655,32.5832]},zoom:{default:12}},emits:["markerClick"],setup(c,{emit:u}){const r=c,e=u,d=h(null),m=h(!0),l=h(null),s=h([]),t=h(null),{coordinates:n,getCurrentPosition:f}=ae();let i=null;E(()=>x(this,null,function*(){yield k(),p(),yield L()})),U(()=>{l.value&&l.value.remove()}),W(()=>r.documents,()=>{$()},{deep:!0});const k=()=>x(this,null,function*(){if(typeof window!="undefined"){if(window.L){i=window.L;return}if(!document.querySelector('link[href*="leaflet.css"]')){const o=document.createElement("link");o.rel="stylesheet",o.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(o)}return new Promise((o,v)=>{if(window.L){i=window.L,o(!0);return}const y=document.createElement("script");y.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",y.onload=()=>{i=window.L,o(!0)},y.onerror=v,document.head.appendChild(y)})}}),p=()=>{!i||!d.value||(l.value=i.map(d.value,{zoomControl:!1}).setView(r.center,r.zoom),i.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors",maxZoom:19}).addTo(l.value),i.control.zoom({position:"bottomright"}).addTo(l.value),m.value=!1,$())},$=()=>{if(!(!i||!l.value)&&(s.value.forEach(o=>o.remove()),s.value=[],r.documents.forEach(o=>{var P,S;if(!((P=o.location_metadata)!=null&&P.lat)||!((S=o.location_metadata)!=null&&S.lng))return;const{lat:v,lng:y}=o.location_metadata,O=`
      <div style="
        background-color: ${o.status==="lost"?"#DC3545":"#28A745"};
        width: 30px;
        height: 30px;
        border-radius: 50%;
        border: 3px solid white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        display: flex;
        align-items: center;
        justify-center;
        color: white;
        font-size: 14px;
      ">
        <i class="fas ${o.status==="lost"?"fa-search":"fa-check"}"></i>
      </div>
    `,F=i.divIcon({html:O,className:"custom-marker",iconSize:[30,30],iconAnchor:[15,15]}),G=i.marker([v,y],{icon:F}).addTo(l.value).bindPopup(`
        <div class="p-2">
          <h4 class="font-semibold mb-1">${o.title}</h4>
          <p class="text-sm text-gray-600">${o.description||"Sem descrição"}</p>
          <p class="text-xs text-gray-500 mt-1">${o.location||"Localização não especificada"}</p>
        </div>
      `).on("click",()=>e("markerClick",o));s.value.push(G)}),s.value.length>0)){const o=i.featureGroup(s.value);l.value.fitBounds(o.getBounds().pad(.1))}},L=()=>x(this,null,function*(){const o=yield f();if(o&&i&&l.value){const y=i.divIcon({html:`
      <div style="
        background-color: #007BFF;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        border: 3px solid white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      "></div>
    `,className:"user-marker",iconSize:[20,20],iconAnchor:[10,10]});t.value&&t.value.remove(),t.value=i.marker([o.latitude,o.longitude],{icon:y}).addTo(l.value).bindPopup("Você está aqui")}}),j=()=>{n.value&&l.value&&l.value.setView([n.value.latitude,n.value.longitude],15)},H=()=>{console.log("Toggle map type")};return(o,v)=>(g(),b("div",se,[a("div",{ref_key:"mapContainer",ref:d,class:"w-full h-full rounded-lg overflow-hidden"},null,512),m.value?(g(),b("div",oe,[...v[0]||(v[0]=[a("div",{class:"text-center"},[a("div",{class:"spinner mb-2"}),a("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Carregando mapa...")],-1)])])):w("",!0),a("div",le,[a("button",{class:"btn-icon bg-white dark:bg-dark-card shadow-lg",onClick:j,disabled:!I(n)},[...v[1]||(v[1]=[a("i",{class:"fas fa-crosshairs"},null,-1)])],8,re),a("button",{class:"btn-icon bg-white dark:bg-dark-card shadow-lg",onClick:H},[...v[2]||(v[2]=[a("i",{class:"fas fa-layer-group"},null,-1)])])]),v[3]||(v[3]=q('<div class="absolute bottom-4 left-4 bg-white dark:bg-dark-card rounded-lg shadow-lg p-3"><div class="space-y-2 text-sm"><div class="flex items-center space-x-2"><div class="w-3 h-3 rounded-full" style="background-color:#DC3545;"></div><span>Perdidos</span></div><div class="flex items-center space-x-2"><div class="w-3 h-3 rounded-full" style="background-color:#28A745;"></div><span>Encontrados</span></div></div></div>',1))]))}}),ie={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},ce={class:"flex min-h-full items-end sm:items-center justify-center p-0 sm:p-4"},de={key:0,class:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-dark-border"},ue={class:"text-lg font-semibold"},me={class:"p-4"},fe={key:1,class:"p-4 border-t border-gray-200 dark:border-dark-border"},pe=T({__name:"BaseModal",props:{modelValue:{type:Boolean},title:{},size:{default:"md"},showClose:{type:Boolean,default:!0},closeOnBackdrop:{type:Boolean,default:!0}},emits:["update:modelValue","close"],setup(c,{emit:u}){const r=c,e=u,d=_(()=>`bg-white dark:bg-dark-card rounded-t-2xl sm:rounded-2xl shadow-xl transform transition-all w-full animate-slide-up sm:animate-fade-in ${{sm:"sm:max-w-md",md:"sm:max-w-lg",lg:"sm:max-w-2xl",full:"sm:max-w-full sm:h-full sm:m-4"}[r.size]}`),m=()=>{e("update:modelValue",!1),e("close")},l=()=>{r.closeOnBackdrop&&m()};return(s,t)=>(g(),N(R,{to:"body"},[M(Y,{name:"modal"},{default:z(()=>[c.modelValue?(g(),b("div",ie,[a("div",{class:"fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity",onClick:l}),a("div",ce,[a("div",{class:D(d.value),onClick:t[0]||(t[0]=Z(()=>{},["stop"]))},[c.title||s.$slots.header?(g(),b("div",de,[B(s.$slots,"header",{},()=>[a("h3",ue,C(c.title),1)],!0),c.showClose?(g(),b("button",{key:0,class:"btn-icon",onClick:m},[...t[1]||(t[1]=[a("i",{class:"fas fa-times"},null,-1)])])):w("",!0)])):w("",!0),a("div",me,[B(s.$slots,"default",{},void 0,!0)]),s.$slots.footer?(g(),b("div",fe,[B(s.$slots,"footer",{},void 0,!0)])):w("",!0)],2)])])):w("",!0)]),_:3})]))}}),ve=ee(pe,[["__scopeId","data-v-278771d8"]]),ge={class:"h-[calc(100vh-8rem)]"},he={key:0,class:"aspect-video bg-gray-200 dark:bg-dark-card rounded-lg overflow-hidden mb-4"},be=["src","alt"],ke={class:"space-y-3"},ye={class:"flex items-center space-x-2"},we={class:"badge badge-primary"},xe={key:0,class:"text-sm text-gray-600 dark:text-gray-400"},_e={class:"space-y-2 text-sm"},Ce={class:"flex items-start"},$e={class:"flex items-start"},Me={class:"flex space-x-2 mt-4 pt-4 border-t border-gray-200 dark:border-dark-border"},Se=T({__name:"MapView",setup(c){const u=K(),r=Q(),e=h(null),d=h(!1),m=_(()=>r.documents),l=_(()=>e.value?{lost:"badge badge-danger",found:"badge badge-success",matched:"badge bg-purple-500/10 text-purple-500",returned:"badge badge-success"}[e.value.status]||"badge badge-primary":""),s=_(()=>e.value?{lost:"Perdido",found:"Encontrado",matched:"Match",returned:"Devolvido",normal:"Normal"}[e.value.status]||e.value.status:""),t=_(()=>e.value?{passport:"fas fa-passport",id_card:"fas fa-id-card",driver_license:"fas fa-id-card-alt",birth_certificate:"fas fa-file-alt",other:"fas fa-file"}[e.value.type]||"fas fa-file":""),n=_(()=>e.value?{passport:"Passaporte",id_card:"BI",driver_license:"Carta",birth_certificate:"Certidão",other:"Outro"}[e.value.type]||"Documento":""),f=k=>{e.value=k,d.value=!0},i=()=>{e.value&&u.push(`/document/${e.value.id}`)};return E(()=>x(this,null,function*(){m.value.length===0&&(yield r.fetchDocuments())})),(k,p)=>(g(),N(X,null,{default:z(()=>{var $;return[a("div",ge,[M(ne,{documents:m.value,onMarkerClick:f},null,8,["documents"])]),M(ve,{modelValue:d.value,"onUpdate:modelValue":p[1]||(p[1]=L=>d.value=L),title:($=e.value)==null?void 0:$.title},{default:z(()=>[e.value?(g(),b(J,{key:0},[e.value.thumbnail_url||e.value.file_url?(g(),b("div",he,[a("img",{src:e.value.thumbnail_url||e.value.file_url,alt:e.value.title,class:"w-full h-full object-cover"},null,8,be)])):w("",!0),a("div",ke,[a("div",ye,[a("span",{class:D(l.value)},C(s.value),3),a("span",we,[a("i",{class:D([t.value,"mr-1"])},null,2),V(" "+C(n.value),1)])]),e.value.description?(g(),b("p",xe,C(e.value.description),1)):w("",!0),a("div",_e,[a("div",Ce,[p[2]||(p[2]=a("i",{class:"fas fa-map-marker-alt text-gray-400 w-5 mt-0.5"},null,-1)),a("span",null,C(e.value.location||"Localização não especificada"),1)]),a("div",$e,[p[3]||(p[3]=a("i",{class:"fas fa-clock text-gray-400 w-5 mt-0.5"},null,-1)),a("span",null,C(I(te)(e.value.created_at)),1)])])]),a("div",Me,[M(A,{variant:"primary",class:"flex-1",onClick:i},{default:z(()=>[...p[4]||(p[4]=[V(" Ver Detalhes ",-1)])]),_:1}),M(A,{variant:"outline",onClick:p[0]||(p[0]=L=>d.value=!1)},{default:z(()=>[...p[5]||(p[5]=[V(" Fechar ",-1)])]),_:1})])],64)):w("",!0)]),_:1},8,["modelValue","title"])]}),_:1}))}});export{Se as default};
