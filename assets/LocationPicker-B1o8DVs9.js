import{a as P,U as M,V as q,r as d,C as D,l as U,p as $,o as p,w as f,h as t,b,e as y,t as c,k as v,R as E,S as K,W as O,j as V}from"./vue-vendor-DJ0JNZJp.js";import{m as k}from"./maplibre-XFgcxNEv.js";import{B as W}from"./MainLayout.vue_vue_type_script_setup_true_lang-2zwD9oua.js";import{b as B,_ as G}from"./index-C4pHUPSV.js";import{u as H}from"./useGeolocation-D46f4tYI.js";const I={class:"space-y-4"},Q={class:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 flex items-start space-x-3"},R={class:"flex-1"},A={class:"text-sm text-blue-900 dark:text-blue-100 font-semibold mb-1"},J={class:"text-xs text-blue-700 dark:text-blue-300"},X={key:0,class:"bg-success/10 rounded-lg p-3"},Y={class:"flex items-start justify-between"},Z={class:"text-xs text-gray-600 dark:text-gray-400"},ee={key:0,class:"text-xs text-gray-600 dark:text-gray-400 mt-1"},te={class:"relative rounded-lg overflow-hidden",style:{height:"400px"}},ae={key:0,class:"absolute inset-0 bg-white/80 dark:bg-dark-bg/80 flex items-center justify-center z-10"},se={class:"flex items-center space-x-2"},le={class:"flex-1"},oe=["disabled"],ie={class:"flex space-x-3"},re=P({__name:"LocationPicker",props:M({title:{default:"Selecionar Localização no Mapa"},message:{default:"Clique no mapa para marcar a localização desejada. Você pode arrastar o marcador para ajustar."},initialLocation:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:M(["location-selected"],["update:modelValue"]),setup(u,{emit:S}){const i=u,r=q(u,"modelValue"),j=S,m=d(null),o=d(null),l=d(null),x=d(!0),s=d(null),g=d(""),{getCurrentPosition:N}=H();D(r,a=>{a&&!o.value&&setTimeout(()=>{h()},100)});const h=async()=>{if(!m.value)return;x.value=!0;let a=[32.5832,-25.9655];if(i.initialLocation)a=[i.initialLocation.lng,i.initialLocation.lat];else{const e=await N();e&&(a=[e.longitude,e.latitude])}o.value=new k.Map({container:m.value,style:{version:8,sources:{"osm-tiles":{type:"raster",tiles:["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png","https://c.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"© OpenStreetMap contributors"}},layers:[{id:"osm-tiles",type:"raster",source:"osm-tiles",minzoom:0,maxzoom:19}]},center:a,zoom:13}),o.value.addControl(new k.NavigationControl,"top-right"),o.value.on("click",e=>{L(e.lngLat.lat,e.lngLat.lng)}),o.value.on("load",()=>{x.value=!1,i.initialLocation&&L(i.initialLocation.lat,i.initialLocation.lng)})},L=(a,e)=>{if(!o.value)return;l.value&&l.value.remove();const n=document.createElement("div");n.innerHTML=`
    <div style="
      background-color: #DC2626;
      width: 40px;
      height: 40px;
      border-radius: 50% 50% 50% 0;
      border: 3px solid white;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 18px;
      transform: rotate(-45deg);
      cursor: move;
    ">
      <i class="fas fa-map-marker-alt" style="transform: rotate(45deg);"></i>
    </div>
  `,l.value=new k.Marker({element:n,draggable:!0}).setLngLat([e,a]).addTo(o.value),l.value.on("dragend",()=>{const z=l.value.getLngLat();w(z.lat,z.lng)}),w(a,e)},w=(a,e)=>{s.value={lat:a,lng:e},s.value.address=`Lat: ${a.toFixed(6)}, Lng: ${e.toFixed(6)}`},C=()=>{s.value=null,l.value&&(l.value.remove(),l.value=null)},_=()=>{alert("Busca de localização será implementada em breve. Por favor, clique no mapa para selecionar.")},T=()=>{s.value&&(j("location-selected",s.value),r.value=!1)},F=()=>{C(),r.value=!1};return U(()=>{r.value&&m.value&&h()}),(a,e)=>(p(),$(W,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=n=>r.value=n),title:"Selecionar Localização",maxWidth:"4xl"},{footer:f(()=>[t("div",ie,[V(B,{variant:"secondary","full-width":"",onClick:F},{default:f(()=>[...e[8]||(e[8]=[v(" Cancelar ",-1)])]),_:1}),V(B,{variant:"primary","full-width":"",disabled:!s.value,onClick:T},{default:f(()=>[...e[9]||(e[9]=[t("i",{class:"fas fa-check mr-2"},null,-1),v(" Confirmar Localização ",-1)])]),_:1},8,["disabled"])])]),default:f(()=>[t("div",I,[t("div",Q,[e[2]||(e[2]=t("i",{class:"fas fa-info-circle text-blue-600 dark:text-blue-400 mt-0.5"},null,-1)),t("div",R,[t("p",A,c(u.title),1),t("p",J,c(u.message),1)])]),s.value?(p(),b("div",X,[t("div",Y,[t("div",null,[e[3]||(e[3]=t("p",{class:"text-sm font-semibold text-success-dark dark:text-success mb-1"},[t("i",{class:"fas fa-check-circle mr-1"}),v(" Localização Selecionada ")],-1)),t("p",Z," Lat: "+c(s.value.lat.toFixed(6))+", Lng: "+c(s.value.lng.toFixed(6)),1),s.value.address?(p(),b("p",ee,c(s.value.address),1)):y("",!0)]),t("button",{onClick:C,class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",title:"Limpar seleção"},[...e[4]||(e[4]=[t("i",{class:"fas fa-times"},null,-1)])])])])):y("",!0),t("div",te,[t("div",{ref_key:"mapContainer",ref:m,class:"w-full h-full"},null,512),x.value?(p(),b("div",ae,[...e[5]||(e[5]=[t("div",{class:"text-center"},[t("div",{class:"spinner mb-2"}),t("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Carregando mapa...")],-1)])])):y("",!0),e[6]||(e[6]=t("div",{class:"absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-primary text-white px-4 py-2 rounded-lg shadow-lg text-sm z-10"},[t("i",{class:"fas fa-hand-pointer mr-2"}),v(" Clique no mapa para selecionar ")],-1))]),t("div",se,[t("div",le,[E(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>g.value=n),type:"text",placeholder:"Buscar local (opcional)...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-input text-gray-900 dark:text-dark-text focus:ring-2 focus:ring-primary focus:border-transparent text-sm",onKeyup:O(_,["enter"])},null,544),[[K,g.value]])]),t("button",{onClick:_,class:"btn-icon bg-primary text-white",disabled:!g.value.trim(),title:"Buscar"},[...e[7]||(e[7]=[t("i",{class:"fas fa-search"},null,-1)])],8,oe)])])]),_:1},8,["modelValue"]))}}),pe=G(re,[["__scopeId","data-v-1c405d13"]]);export{pe as L};
