<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FindMyDocs - Gest√£o de Documentos Perdidos</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="leaderboard.css">
    <link rel="stylesheet" href="css/document-uploader.css">
    <link rel="stylesheet" href="css/profile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Handle logout
            const logoutButtons = document.querySelectorAll('.logout-btn');
            logoutButtons.forEach(btn => {
                btn.addEventListener('click', async () => {
                    try {
                        // Sign out from Supabase if available
                        if (window.authApi && window.authApi.signOut) {
                            await window.authApi.signOut();
                        }
                    } catch (error) {
                        console.error('Error signing out from Supabase:', error);
                    }
                    
                    // Clear local storage
                    localStorage.removeItem('auth_token');
                    localStorage.removeItem('remember_me');
                    
                    // Redirect to login page
                    window.location.href = 'login.html';
                });
            });
        });
    </script>
</head>
<body>
    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Main Application -->
    <div id="app-section">
        <div class="container">
            <!-- Navigation -->
            <nav class="navbar">
                <div class="nav-brand">
                    <img class="app-logo-small" src="logofmd.jpg" alt="FindMyDocs Logo">
                    FindMyDocs
                </div>
                <div class="nav-links">
                    <select id="language-selector" class="language-selector" aria-label="Selecionar idioma">
                        <option value="pt">üáµüáπ Portugu√™s</option>
                        <option value="en">üá¨üáß English</option>
                        <option value="fr">üá´üá∑ Fran√ßais</option>
                        <option value="zu">üáøüá¶ isiZulu</option>
                        <option value="ts">üá≤üáø Xitsonga</option>
                    </select>
                    <button class="nav-link active" data-section="documentos" aria-label="In√≠cio">
                        <i class="fas fa-home"></i>
                        <span data-i18n="nav.home">In√≠cio</span>
                    </button>
                    <button class="nav-link" data-section="feed" aria-label="Feed">
                        <i class="fas fa-list"></i>
                        Feed
                    </button>
                    <button class="nav-link" data-section="leaderboard" aria-label="Classifica√ß√£o">
                        <i class="fas fa-trophy"></i>
                        Classifica√ß√£o
                    </button>
                    <button class="nav-link" data-section="notifications" aria-label="Notifica√ß√µes">
                        <i class="fas fa-bell"></i>
                        <span data-i18n="nav.notifications">Notifica√ß√µes</span>
                        <span id="notification-badge" class="notification-badge" style="display: none;">0</span>
                    </button>
                    <button class="nav-link" data-section="relatar-perda" aria-label="Relatar Perda">
                        <i class="fas fa-search"></i>
                        <span data-i18n="nav.report_lost">Relatar Perda</span>
                    </button>
                    <button class="nav-link" data-section="relatar-encontrado" aria-label="Relatar Encontrado">
                        <i class="fas fa-map-marker-alt"></i>
                        <span data-i18n="nav.report_found">Relatar Encontrado</span>
                    </button>
                    <button class="nav-link" data-section="perfil" aria-label="Perfil">
                        <i class="fas fa-user"></i>
                        Perfil
                    </button>
                    <button id="theme-toggle" class="btn secondary small" aria-label="Alternar tema">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button id="logout-btn" class="btn danger small logout-btn" aria-label="Logout">
                        <i class="fas fa-sign-out-alt"></i>
                        Sair
                    </button>
                </div>
            </nav>

            <!-- Home/Documentos Section -->
            <section id="documentos" class="content-section active">
                <div class="section-header">
                    <h2 data-i18n="documents.title">Seus Documentos</h2>
                    <span id="document-count" class="document-count">0 total</span>
                </div>
                
                <div id="welcome-tips" class="welcome-section">
                    <div class="quick-actions">
                        <button class="btn primary" onclick="showSection('relatar-perda')">
                            <i class="fas fa-search-minus"></i> 
                            <span data-i18n="nav.report_lost">Reportar Documento Perdido</span>
                        </button>
                        <button class="btn success" onclick="showSection('relatar-encontrado')">
                            <i class="fas fa-search-plus"></i> 
                            <span data-i18n="nav.report_found">Reportar Documento Encontrado</span>
                        </button>
                    </div>
                    
                    <div class="mobile-upload-tip">
                        <i class="fas fa-exclamation-triangle"></i> 
                        <span data-i18n="tips.mobile_upload">Para enviar fotos pelo app, permita acesso √† c√¢mera e arquivos quando solicitado.</span>
                    </div>
                    
                    <h2 data-i18n="welcome.title">Bem-vindo, Google User!</h2>
                    
                    <div class="tip-card">
                        <i class="fas fa-clock"></i>
                        <h4 data-i18n="tip.report_immediately.title">Reporte Imediatamente</h4>
                        <p data-i18n="tip.report_immediately.description">Reporte documentos perdidos ou encontrados o mais r√°pido poss√≠vel para aumentar as chances de recupera√ß√£o.</p>
                        <button class="tip-close" aria-label="Fechar dica">&times;</button>
                    </div>
                    
                    <div class="tip-card">
                        <i class="fas fa-camera"></i>
                        <h4 data-i18n="tip.photo_safety.title">Seguran√ßa de Fotos</h4>
                        <p data-i18n="tip.photo_safety.description">Ao enviar fotos de documentos, cubra ou desfoque qualquer informa√ß√£o pessoal.</p>
                        <button class="tip-close" aria-label="Fechar dica">&times;</button>
                    </div>
                    
                    <div class="tip-card">
                        <i class="fas fa-star"></i>
                        <h4 data-i18n="tip.earn_points.title">Ganhe Mais Pontos</h4>
                        <p data-i18n="tip.earn_points.description">Complete seu perfil, reporte documentos encontrados e ajude outros para ganhar mais pontos.</p>
                        <button class="tip-close" aria-label="Fechar dica">&times;</button>
                    </div>
                    
                    <button id="add-document" class="btn primary full-width">
                        <i class="fas fa-plus"></i>
                        Adicionar Novo Documento
                    </button>
                </div>

                <div id="documents-grid" class="documents-grid">
                    <!-- Documents will be loaded here -->
                </div>
            </section>

            <!-- Feed Section -->
            <section id="feed" class="content-section">
                <div class="section-header">
                    <h2>Feed de Documentos</h2>
                    <div class="feed-filters">
                        <select id="feed-filter-type">
                            <option value="">Todos os tipos</option>
                            <option value="ID card">BI</option>
                            <option value="Passport">Passaporte</option>
                            <option value="DIRE">DIRE</option>
                            <option value="Bank Doc">Documento Banc√°rio</option>
                        </select>
                        <select id="feed-filter-status">
                            <option value="">Todos os status</option>
                            <option value="lost">Perdidos</option>
                            <option value="found">Encontrados</option>
                        </select>
                    </div>
                </div>
                <div id="feed-content" class="feed-content">
                    <!-- Feed items will be loaded here -->
                </div>
            </section>

            <!-- Leaderboard Section -->
            <section id="leaderboard" class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-trophy"></i> Classifica√ß√£o</h2>
                    <p>Veja os usu√°rios com mais pontos na plataforma</p>
                </div>
                <div id="leaderboard-container" class="leaderboard-container">
                    <!-- Leaderboard will be loaded here -->
                </div>
            </section>

            <!-- Notifications Section -->
            <section id="notifications" class="content-section">
                <div class="section-header">
                    <h2 data-i18n="notifications.title">Notifica√ß√µes</h2>
                    <button id="mark-all-read" class="btn secondary small" data-i18n="notifications.mark_all_read">Marcar todas como lidas</button>
                </div>
                <div class="notifications-container">
                    <div id="notifications-list" class="notifications-list">
                        <!-- Notifications will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Relatar Perda Section -->
            <section id="relatar-perda" class="content-section">
                <div class="section-header">
                    <h2>Relatar Documento Perdido</h2>
                </div>
                <form id="lost-form" class="document-form">
                    <div class="form-group">
                        <label for="lost-type">Tipo de Documento</label>
                        <select id="lost-type" required>
                            <option value="">Selecione o tipo</option>
                            <option value="ID card">BI (Bilhete de Identidade)</option>
                            <option value="Passport">Passaporte</option>
                            <option value="DIRE">DIRE</option>
                            <option value="Bank Doc">Documento Banc√°rio</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="lost-title">Nome/T√≠tulo do Documento</label>
                        <input type="text" id="lost-title" required placeholder="Ex: BI de Jo√£o Silva">
                    </div>
                    
                    <div class="form-group">
                        <label for="lost-location">Onde foi perdido?</label>
                        <input type="text" id="lost-location" required placeholder="Localiza√ß√£o onde o documento foi perdido">
                    </div>
                    
                    <div class="form-group">
                        <label for="lost-description">Descri√ß√£o adicional</label>
                        <textarea id="lost-description" placeholder="Descreva detalhes que possam ajudar na identifica√ß√£o"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="lost-contact">Informa√ß√µes de contato</label>
                        <input type="tel" id="lost-contact" required placeholder="+258 XX XXX XXXX">
                    </div>
                    
                    <button type="submit" class="btn primary">
                        <i class="fas fa-exclamation-triangle"></i>
                        Reportar como Perdido
                    </button>
                </form>
            </section>

            <!-- Relatar Encontrado Section -->
            <section id="relatar-encontrado" class="content-section">
                <div class="section-header">
                    <h2>Relatar Documento Encontrado</h2>
                </div>
                <form id="found-form" class="document-form">
                    <div class="form-group">
                        <label for="found-type">Tipo de Documento</label>
                        <select id="found-type" required>
                            <option value="">Selecione o tipo</option>
                            <option value="ID card">BI (Bilhete de Identidade)</option>
                            <option value="Passport">Passaporte</option>
                            <option value="DIRE">DIRE</option>
                            <option value="Bank Doc">Documento Banc√°rio</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="found-title">Nome/T√≠tulo do Documento</label>
                        <input type="text" id="found-title" required placeholder="Ex: BI encontrado">
                    </div>
                    
                    <div class="form-group">
                        <label for="found-location">Onde foi encontrado?</label>
                        <input type="text" id="found-location" required placeholder="Localiza√ß√£o onde encontrou o documento">
                    </div>
                    
                    <div class="form-group">
                        <label for="found-description">Descri√ß√£o do documento</label>
                        <textarea id="found-description" placeholder="Descreva o documento encontrado (sem revelar informa√ß√µes sens√≠veis)"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="found-contact">Suas informa√ß√µes de contato</label>
                        <input type="tel" id="found-contact" required placeholder="+258 XX XXX XXXX">
                    </div>
                    
                    <button type="submit" class="btn success">
                        <i class="fas fa-hand-holding"></i>
                        Reportar como Encontrado
                    </button>
                </form>
            </section>

            <!-- Profile Section Unificada -->
            <section id="perfil" class="content-section">
                <div id="profile-loading" class="loading-state" style="display: none;">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Carregando perfil...</p>
                </div>
                
                <!-- Profile Header -->
                <div class="profile-header">
                    <div class="profile-user-info">
                        <div class="profile-avatar">
                            <img id="profile-avatar" src="data:image/svg+xml,%3csvg width='80' height='80' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='80' height='80' fill='%23ddd'/%3e%3ctext x='50%25' y='50%25' font-size='30' text-anchor='middle' alignment-baseline='middle'%3eüë§%3c/text%3e%3c/svg%3e" alt="Avatar do usu√°rio">
                            <button id="avatar-upload-btn" class="avatar-upload-btn" title="Alterar foto do perfil">
                                <i class="fas fa-camera"></i>
                            </button>
                        </div>
                        <div class="profile-details">
                            <h2 id="profile-name">Carregando...</h2>
                            <span id="profile-country-flag" class="country-flag"></span>
                            <p id="profile-email">Carregando...</p>
                            <div class="profile-badges">
                                <span id="profile-plan" class="plan-badge">free</span>
                                <div class="rank-container">
                                    <span id="profile-rank" class="rank-badge clickable">Novato</span>
                                    <button id="view-ranking-btn" class="btn small outline" title="Ver ranking">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button id="profile-logout-btn" class="btn danger small">
                        <i class="fas fa-sign-out-alt"></i>
                        Sair
                    </button>
                </div>

                <!-- Profile Control Panel -->
                <div class="profile-control-panel">
                    <div class="profile-stats">
                        <div class="stat-item">
                            <span class="stat-number" id="profile-doc-count">0</span>
                            <span class="stat-label">Documentos</span>
                        </div>
                        <div class="stat-item clickable" id="points-container">
                            <span class="stat-number" id="profile-points">250</span>
                            <span class="stat-label">Pontos</span>
                            <div class="progress-container" id="points-progress" style="display: none;">
                                <div class="progress-bar">
                                    <div class="progress" id="points-progress-bar" style="width: 25%;"></div>
                                </div>
                                <div class="progress-text">
                                    <span id="points-current">250</span> / <span id="points-next">1000</span> pontos
                                </div>
                                <div class="next-rank">
                                    Pr√≥ximo n√≠vel: <span id="next-rank-name">Intermedi√°rio</span>
                                </div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="profile-helped">3</span>
                            <span class="stat-label">Ajudou</span>
                        </div>
                    </div>
                    <button id="profile-add-document" class="btn primary">
                        <i class="fas fa-plus"></i>
                        Adicionar Documento
                    </button>
                </div>

                <!-- Profile Documents List -->
                <div class="profile-documents-section">
                    <h3>Meus Documentos</h3>
                    <div id="profile-documents-grid" class="documents-grid">
                        <!-- Documents will be loaded here -->
                    </div>
                </div>

                <!-- Subscription Plans Section -->
                <div class="profile-section">
                    <h3>Planos de Subscri√ß√£o</h3>
                    <div class="plans-container">
                        <div class="plan-card">
                            <h4>Premium Mensal</h4>
                            <p class="price">150 MT<span>/m√™s</span></p>
                            <ul>
                                <li><i class="fas fa-check"></i> Uploads ilimitados</li>
                                <li><i class="fas fa-check"></i> Suporte priorit√°rio</li>
                                <li><i class="fas fa-check"></i> Sem an√∫ncios</li>
                            </ul>
                            <div class="payment-options">
                                <button class="btn success small payment-btn" data-method="mpesa"><i class="fas fa-mobile-alt"></i> Pagar com M-Pesa</button>
                                <button class="btn warning small payment-btn" data-method="emola"><i class="fas fa-mobile-alt"></i> Pagar com e-Mola</button>
                            </div>
                        </div>
                        <div class="plan-card recommended">
                             <span class="recommended-badge">Recomendado</span>
                            <h4>Premium Anual</h4>
                            <p class="price">1500 MT<span>/ano</span></p>
                            <ul>
                                <li><i class="fas fa-check"></i> Todas as vantagens do Premium</li>
                                <li><i class="fas fa-check"></i> Desconto de 2 meses</li>
                                <li><i class="fas fa-check"></i> Acesso antecipado a recursos</li>
                            </ul>
                            <div class="payment-options">
                                <button class="btn success small payment-btn" data-method="mpesa"><i class="fas fa-mobile-alt"></i> Pagar com M-Pesa</button>
                                <button class="btn warning small payment-btn" data-method="emola"><i class="fas fa-mobile-alt"></i> Pagar com e-Mola</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data Management Section -->
                <div class="profile-section">
                    <h3>Gerir Dados</h3>
                    <div class="data-management-card">
                        <p>Fa√ßa o download de todos os seus documentos enviados num √∫nico arquivo .zip.</p>
                        <button id="download-all-docs" class="btn primary">
                            <i class="fas fa-download"></i> Baixar Meus Documentos
                            <span id="download-spinner" class="loading-spinner" style="display: none; margin-left: 8px;">
                                <i class="fas fa-spinner fa-spin"></i>
                            </span>
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Document Upload Modal -->
    <div id="upload-modal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>Carregar Documento</h3>
                <button class="close-btn" id="close-upload-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="upload-form">
                    <div id="drop-zone" class="drop-zone">
                        <div class="drop-zone-message">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Arraste e solte o seu documento aqui</p>
                            <span class="muted">ou</span>
                            <button type="button" id="browse-btn" class="btn secondary small">Procurar Arquivo</button>
                            <input type="file" id="file-input" style="display: none;" multiple>
                        </div>
                        <div id="file-preview" class="file-preview-container"></div>
                    </div>
                    
                    <div id="file-info">
                        <div class="form-row">
                            <div class="form-group" style="flex: 2;">
                                <label for="document-title">T√≠tulo do Documento *</label>
                                <input type="text" id="document-title" required 
                                       placeholder="Ex: BI de Jo√£o Silva" 
                                       minlength="3" maxlength="100">
                            </div>
                            
                            <div class="form-group" style="flex: 1;">
                                <label for="document-type">Tipo de Documento *</label>
                                <select id="document-type" required>
                                    <option value="ID card">Bilhete de Identidade</option>
                                    <option value="DIRE">DIRE</option>
                                    <option value="Passport">Passaporte</option>
                                    <option value="Bank Doc">Documento Banc√°rio</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group" style="flex: 1;">
                                <label for="document-number">N√∫mero do Documento</label>
                                <input type="text" id="document-number" 
                                       placeholder="N√∫mero do documento">
                            </div>
                            
                            <div class="form-group" style="flex: 1;">
                                <label for="issue-date">Data de Emiss√£o</label>
                                <input type="date" id="issue-date">
                            </div>
                            
                            <div class="form-group" style="flex: 1;">
                                <label for="expiry-date">Data de Validade</label>
                                <input type="date" id="expiry-date">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group" style="flex: 1;">
                                <label for="issue-place">Local de Emiss√£o</label>
                                <input type="text" id="issue-place" 
                                       placeholder="Cidade/Pa√≠s de emiss√£o">
                            </div>
                            
                            <div class="form-group" style="flex: 1;">
                                <label for="issuing-authority">Entidade Emissora</label>
                                <input type="text" id="issuing-authority" 
                                       placeholder="Ex: Conservat√≥ria">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="document-description">Descri√ß√£o (opcional)</label>
                            <textarea id="document-description" 
                                    rows="3" 
                                    placeholder="Informa√ß√µes adicionais sobre o documento"></textarea>
                        </div>

                        <div class="form-group">
                            <label class="checkbox-container">
                                <input type="checkbox" id="is-public">
                                <span class="checkmark"></span>
                                Tornar este documento p√∫blico
                            </label>
                            <p class="form-hint">Documentos p√∫blicos podem ser vistos por outros usu√°rios</p>
                        </div>
                    </div>
                    
                    <div id="upload-actions" class="form-actions" style="margin-top: 20px;">
                        <button type="button" id="cancel-upload" class="btn secondary">Cancelar</button>
                        <button type="submit" id="submit-upload" class="btn primary" disabled>
                            <span class="btn-text">Enviar Documento</span>
                            <span class="loading-spinner" style="display: none; margin-left: 8px;">
                                <i class="fas fa-spinner fa-spin"></i>
                            </span>
                        </button>
                    </div>
                    
                    <div id="retry-section" style="display: none; margin-top: 15px; text-align: center;">
                        <p>Alguns arquivos falharam ao enviar.</p>
                        <button type="button" id="retry-upload" class="btn warning">
                            <i class="fas fa-redo"></i> Tentar Novamente
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Chat Modal -->
    <div id="chat-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 100%; width: 100%; height: 90vh; max-height: 800px; display: flex; flex-direction: column; padding: 0;">
            <div class="chat-header" style="padding: 15px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
                <div class="chat-title">
                    <h3 id="chat-title" style="margin: 0; font-size: 1.2rem;">Chat</h3>
                    <div class="chat-status" style="font-size: 0.8rem; color: var(--text-light);">
                        <span id="typing-indicator" style="display: none;">Digitando...</span>
                        <span id="online-status" style="display: flex; align-items: center; margin-top: 3px;">
                            <span class="status-dot" style="display: inline-block; width: 8px; height: 8px; border-radius: 50%; background-color: #ccc; margin-right: 5px;"></span>
                            <span>Offline</span>
                        </span>
                    </div>
                </div>
                <button class="close" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-color);">&times;</button>
            </div>
            
            <div id="chat-messages" class="chat-messages" style="flex: 1; overflow-y: auto; padding: 15px;">
                <!-- Messages will be loaded here -->
                <div class="chat-date-divider" style="text-align: center; margin: 15px 0; position: relative;">
                    <span style="background: var(--bg-color); padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; color: var(--text-light);">Hoje</span>
                </div>
            </div>
            
            <div class="chat-input-container" style="padding: 15px; border-top: 1px solid var(--border-color); background: var(--card-bg);">
                <div id="chat-upload-preview" style="display: none; margin-bottom: 10px; position: relative;">
                    <div style="display: flex; align-items: center; background: var(--bg-color); padding: 8px; border-radius: 8px;">
                        <img id="chat-upload-preview-img" src="" style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px;">
                        <div style="margin-left: 10px; flex: 1;">
                            <div style="font-size: 0.9rem; font-weight: 500; margin-bottom: 3px;">image.jpg</div>
                            <div style="font-size: 0.8rem; color: var(--text-light);">1.2 MB</div>
                        </div>
                        <button id="cancel-upload" style="background: none; border: none; color: var(--text-light); cursor: pointer; font-size: 1.2rem; margin-left: 10px;">&times;</button>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button id="chat-upload-btn" class="btn secondary" style="padding: 8px 10px; border-radius: 50%; width: 40px; height: 40px;">
                        <i class="fas fa-paperclip"></i>
                        <input type="file" id="chat-file-input" accept="image/*" style="display: none;">
                    </button>
                    <div style="flex: 1; position: relative;">
                        <input type="text" id="chat-input-field" placeholder="Digite sua mensagem..." style="width: 100%; padding: 12px 15px; border: 1px solid var(--border-color); border-radius: 25px; background: var(--bg-color); color: var(--text-color);">
                        <button id="send-location" class="btn secondary" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--primary-color); cursor: pointer; font-size: 1.2rem; padding: 5px;">
                            <i class="fas fa-location-arrow"></i>
                        </button>
                    </div>
                    <button id="send-message" class="btn primary" style="padding: 8px 10px; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    
    <!-- Load Supabase library first -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <!-- Initialize our Supabase client and APIs -->
    <script src="supabaseClient.js"></script>
    
    <!-- Load auth manager -->
    <script src="auth.js"></script>
    
    <!-- Translations (must be before main script) -->
    <script src="translations.js"></script>

    <!-- Ranking Details Modal -->
    <div id="ranking-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3><i class="fas fa-trophy"></i> Seu Ranking</h3>
                <button class="close-btn" id="close-ranking-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="ranking-summary">
                    <div class="current-rank">
                        <h4>Seu N√≠vel Atual</h4>
                        <div class="rank-display">
                            <span id="current-rank-badge" class="rank-badge large">Novato</span>
                            <div class="rank-progress">
                                <div class="progress-container">
                                    <div class="progress-bar">
                                        <div id="ranking-progress" class="progress" style="width: 25%;"></div>
                                    </div>
                                    <div class="progress-text">
                                        <span id="current-points">0</span> / <span id="next-rank-points">1000</span> pontos
                                    </div>
                                </div>
                                <div class="next-rank">
                                    Pr√≥ximo n√≠vel: <span id="next-rank-name">Intermedi√°rio</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="ranking-levels">
                    <h4>Pr√≥ximos N√≠veis</h4>
                    <ul id="rank-list" class="rank-list">
                        <!-- Will be populated by JavaScript -->
                    </ul>
                </div>
                
                <div class="ranking-tips">
                    <h4><i class="fas fa-lightbulb"></i> Dicas para Subir de N√≠vel</h4>
                    <ul class="tips-list">
                        <li><i class="fas fa-check-circle"></i> Envie documentos para ganhar pontos</li>
                        <li><i class="fas fa-check-circle"></i> Complete seu perfil</li>
                        <li><i class="fas fa-check-circle"></i> Participe da comunidade</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button id="close-ranking-btn" class="btn primary">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Initialize Scripts -->
    <script src="notifications.js"></script>
    <script src="points-service.js"></script>
    <script type="module" src="leaderboard.js"></script>
    <script src="script.js"></script>
    <script src="ui.js"></script>
    <script src="views.js"></script>
    <script src="chat.js"></script>
    <script src="map.js"></script>
    
    <!-- Enhanced Document Uploader -->
    <script src="enhancedDocumentUploader.js"></script>
    <script src="js/profile.js"></script>

    <!-- JSZip Library for downloading documents -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <!-- Payment Modal -->
    <div id="payment-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="payment-modal-title">Processar Pagamento</h3>
                <button class="close-btn" id="close-payment-modal">&times;</button>
            </div>
            <div class="modal-body" id="payment-modal-body">
                <!-- Payment steps will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Document Preview Modal -->
    <div id="document-preview-modal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="preview-modal-title">Visualizar Documento</h3>
                <button class="close-btn" id="close-preview-modal">&times;</button>
            </div>
            <div class="modal-body" id="preview-modal-body">
                <!-- Document content will be loaded here -->
                <div class="loading-state">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Carregando documento...</p>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
