var z=Object.defineProperty,B=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var C=(s,o,a)=>o in s?z(s,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[o]=a,k=(s,o)=>{for(var a in o||(o={}))j.call(o,a)&&C(s,a,o[a]);if(P)for(var a of P(o))L.call(o,a)&&C(s,a,o[a]);return s},D=(s,o)=>B(s,M(o));var m=(s,o,a)=>new Promise((i,u)=>{var f=d=>{try{v(a.next(d))}catch(b){u(b)}},r=d=>{try{v(a.throw(d))}catch(b){u(b)}},v=d=>d.done?i(d.value):Promise.resolve(d.value).then(f,r);v((a=a.apply(s,o)).next())});import{a as O,r as U,l as R,p as F,w,u as G,o as I,h as t,j as _,i as V,O as J,R as x,S as g,b as W,e as H,k as h}from"./vue-vendor-D3gglZhg.js";import{u as K,a as Q,b as S,T as X}from"./index-DVvGwCfe.js";import{s as p}from"./supabase-BWysbwwl.js";import{_ as Y}from"./MainLayout.vue_vue_type_script_setup_true_lang-po6AB_6N.js";import{P as Z}from"./ProfilePhotoUpload-7RIaWTZ4.js";import"./supabase-BZLovRLP.js";import"./logofmd-DIbmBIad.js";import"./BaseModal-CG4KKHeH.js";const $={get(s){return m(this,null,function*(){const{data:o,error:a}=yield p.from("user_profiles").select("*").eq("id",s).single();if(a)throw a;return o})},create(s,o){return m(this,null,function*(){const{data:a,error:i}=yield p.from("user_profiles").insert([k({id:s},o)]).select().single();if(i)throw i;return a})},update(s,o){return m(this,null,function*(){const{data:a,error:i}=yield p.from("user_profiles").update(D(k({},o),{updated_at:new Date().toISOString()})).eq("id",s).select().single();if(i)throw i;return a})},getTopProfiles(s=50){return m(this,null,function*(){const{data:o,error:a}=yield p.from("user_profiles").select("id, full_name, points, avatar_url").order("points",{ascending:!1}).limit(s);if(a)throw a;return o})}},ee={class:"px-4 py-6 space-y-6"},te={class:"flex items-center justify-between"},ae={class:"card"},oe={class:"card"},re={class:"card"},se={class:"card"},le={class:"card"},ne={class:"card"},ie={key:0,class:"mb-2"},ue=["src"],de={class:"card"},me={class:"flex space-x-3"},ke=O({__name:"EditProfileView",setup(s){const o=G(),a=K(),{success:i,error:u}=Q(),f=U(!1),r=U({full_name:"",phone_number:"",delivery_address:"",base_location:"",country:"",id_document_url:void 0}),v=()=>m(this,null,function*(){if(!a.userId){u("Usuário não autenticado"),o.push("/login");return}try{const n=yield $.get(a.userId);r.value={full_name:n.full_name||"",phone_number:n.phone_number||"",delivery_address:n.delivery_address||"",base_location:n.base_location||"",country:n.country||"",id_document_url:n.id_document_url}}catch(n){u(n.message||"Erro ao carregar perfil")}}),d=n=>m(this,null,function*(){var y;const l=(y=n.target.files)==null?void 0:y[0];if(l)try{const c=l.name.split(".").pop(),A=`id_documents/${`${a.userId}/id_document_${Date.now()}.${c}`}`,{data:T,error:N}=yield p.storage.from("documents").upload(A,l,{cacheControl:"3600",upsert:!1});if(N)throw N;const{data:{publicUrl:q}}=p.storage.from("documents").getPublicUrl(T.path);r.value.id_document_url=q,i("Documento carregado com sucesso!")}catch(c){u(c.message||"Erro ao carregar documento")}}),b=()=>m(this,null,function*(){var n,e,l,y,c;if(!a.userId){u("Usuário não autenticado");return}if(!((n=r.value.full_name)!=null&&n.trim())){u("Nome completo é obrigatório");return}f.value=!0;try{yield $.update(a.userId,{full_name:r.value.full_name.trim(),phone_number:((e=r.value.phone_number)==null?void 0:e.trim())||null,delivery_address:((l=r.value.delivery_address)==null?void 0:l.trim())||null,base_location:((y=r.value.base_location)==null?void 0:y.trim())||null,country:((c=r.value.country)==null?void 0:c.trim())||null,id_document_url:r.value.id_document_url||null}),yield a.loadProfile(),i("Perfil atualizado com sucesso!"),o.back()}catch(E){u(E.message||"Erro ao atualizar perfil")}finally{f.value=!1}});return R(()=>{v()}),(n,e)=>(I(),F(Y,null,{default:w(()=>[t("div",ee,[t("div",te,[e[9]||(e[9]=t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-dark-text"},"Editar Perfil",-1)),t("button",{class:"btn-icon",onClick:e[0]||(e[0]=l=>V(o).back())},[...e[8]||(e[8]=[t("i",{class:"fas fa-times"},null,-1)])])]),t("form",{onSubmit:J(b,["prevent"]),class:"space-y-6"},[t("div",ae,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Foto de Perfil ",-1)),_(Z)]),t("div",oe,[e[11]||(e[11]=t("label",{for:"fullName",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Nome Completo * ",-1)),x(t("input",{id:"fullName","onUpdate:modelValue":e[1]||(e[1]=l=>r.value.full_name=l),type:"text",required:"",class:"input",placeholder:"Seu nome completo"},null,512),[[g,r.value.full_name]])]),t("div",re,[e[12]||(e[12]=t("label",{for:"phoneNumber",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Número de Telemóvel/WhatsApp ",-1)),x(t("input",{id:"phoneNumber","onUpdate:modelValue":e[2]||(e[2]=l=>r.value.phone_number=l),type:"tel",class:"input",placeholder:"+258 84 123 4567"},null,512),[[g,r.value.phone_number]]),e[13]||(e[13]=t("p",{class:"text-xs text-gray-500 mt-1"}," Este número será usado para contacto quando alguém encontrar o seu documento ",-1))]),t("div",se,[e[14]||(e[14]=t("label",{for:"deliveryAddress",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Endereço de Entrega ",-1)),x(t("textarea",{id:"deliveryAddress","onUpdate:modelValue":e[3]||(e[3]=l=>r.value.delivery_address=l),rows:"3",class:"input",placeholder:"Ex: Av. Julius Nyerere, nº 123, Maputo"},null,512),[[g,r.value.delivery_address]]),e[15]||(e[15]=t("p",{class:"text-xs text-gray-500 mt-1"}," Este endereço será exibido para quem for entregar o documento ao utilizador ",-1))]),t("div",le,[e[16]||(e[16]=t("label",{for:"baseLocation",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Localização Base (Cidade/Província) ",-1)),x(t("input",{id:"baseLocation","onUpdate:modelValue":e[4]||(e[4]=l=>r.value.base_location=l),type:"text",class:"input",placeholder:"Ex: Maputo, Beira, Nampula"},null,512),[[g,r.value.base_location]]),e[17]||(e[17]=t("p",{class:"text-xs text-gray-500 mt-1"}," Defina a sua cidade ou província para filtrar notificações relevantes ",-1))]),t("div",ne,[e[18]||(e[18]=t("label",{for:"idDocument",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Documento de Identificação (Opcional) ",-1)),e[19]||(e[19]=t("p",{class:"text-xs text-gray-500 mb-2"}," Envie uma foto do seu documento de identificação para verificação. Isso aumenta a segurança da plataforma. ",-1)),r.value.id_document_url?(I(),W("div",ie,[t("img",{src:r.value.id_document_url,alt:"ID Document",class:"w-32 h-20 object-cover rounded border"},null,8,ue),t("button",{type:"button",class:"text-xs text-danger mt-1",onClick:e[5]||(e[5]=l=>r.value.id_document_url=void 0)}," Remover ")])):H("",!0),t("input",{id:"idDocument",type:"file",accept:"image/*",onChange:d,class:"input"},null,32)]),t("div",de,[e[20]||(e[20]=t("label",{for:"country",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," País ",-1)),x(t("input",{id:"country","onUpdate:modelValue":e[6]||(e[6]=l=>r.value.country=l),type:"text",class:"input",placeholder:"Moçambique"},null,512),[[g,r.value.country]])]),t("div",me,[_(S,{type:"button",variant:"outline",size:"lg","full-width":"",onClick:e[7]||(e[7]=l=>V(o).back())},{default:w(()=>[...e[21]||(e[21]=[h(" Cancelar ",-1)])]),_:1}),_(S,{type:"submit",variant:"primary",size:"lg","full-width":"",loading:f.value},{default:w(()=>[...e[22]||(e[22]=[h(" Guardar Alterações ",-1)])]),_:1},8,["loading"])])],32),_(X)])]),_:1}))}});export{ke as default};
