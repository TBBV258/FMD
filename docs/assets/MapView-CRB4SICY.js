var k=(v,d,n)=>new Promise((e,c)=>{var m=t=>{try{r(n.next(t))}catch(l){c(l)}},s=t=>{try{r(n.throw(t))}catch(l){c(l)}},r=t=>t.done?e(t.value):Promise.resolve(t.value).then(m,s);r((n=n.apply(v,d)).next())});import{r as g,a as T,l as A,m as G,C as U,b as C,o as w,h as o,e as z,N as O,i as E,c as x,p as W,w as $,j as L,n as B,t as _,k as D,F as q,u as R}from"./vue-vendor-CG29anWM.js";import{u as Y}from"./documents-DWGTLpE6.js";import{_ as Z}from"./MainLayout.vue_vue_type_script_setup_true_lang-wYdRj66s.js";import{B as J}from"./BaseModal-CSBaIltP.js";import{b as S}from"./index-BJKRiKdG.js";import"./logofmd-DIbmBIad.js";import"./supabase-DO0Dm75k.js";function K(v){const d=new Date,n=typeof v=="string"?new Date(v):v,e=d.getTime()-n.getTime(),c=Math.floor(e/1e3),m=Math.floor(c/60),s=Math.floor(m/60),r=Math.floor(s/24),t=Math.floor(r/7),l=Math.floor(r/30),u=Math.floor(r/365);return c<60?"Agora":m<60?`${m}m`:s<24?`${s}h`:r<7?`${r}d`:t<4?`${t} sem${t>1?"s":""}`:l<12?`${l} mês${l>1?"es":""}`:`${u} ano${u>1?"s":""}`}function Q(){const v=g(null),d=g(null),n=g(!1),e="geolocation"in navigator,c=()=>k(this,null,function*(){return e?(n.value=!0,d.value=null,new Promise(t=>{navigator.geolocation.getCurrentPosition(l=>{const u={latitude:l.coords.latitude,longitude:l.coords.longitude,accuracy:l.coords.accuracy};v.value=u,n.value=!1,t(u)},l=>{d.value={code:l.code,message:r(l.code)},n.value=!1,t(null)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})})):(d.value={code:0,message:"Geolocalização não suportada neste navegador"},null)}),m=t=>e?navigator.geolocation.watchPosition(u=>{const i={latitude:u.coords.latitude,longitude:u.coords.longitude,accuracy:u.coords.accuracy};v.value=i,t(i)},u=>{d.value={code:u.code,message:r(u.code)}},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}):(d.value={code:0,message:"Geolocalização não suportada neste navegador"},null),s=t=>{e&&t&&navigator.geolocation.clearWatch(t)},r=t=>{switch(t){case 1:return"Permissão de localização negada";case 2:return"Localização indisponível";case 3:return"Tempo limite excedido";default:return"Erro ao obter localização"}};return{coordinates:v,error:d,isLoading:n,isSupported:e,getCurrentPosition:c,watchPosition:m,clearWatch:s}}const X={class:"relative w-full h-full"},ee={key:0,class:"absolute inset-0 bg-white/80 dark:bg-dark-bg/80 flex items-center justify-center"},te={class:"absolute top-4 right-4 space-y-2"},ae=["disabled"],oe=T({__name:"MapComponent",props:{documents:{default:()=>[]},center:{default:()=>[-25.9655,32.5832]},zoom:{default:12}},emits:["markerClick"],setup(v,{emit:d}){const n=v,e=d,c=g(null),m=g(!0),s=g(null),r=g([]),t=g(null),{coordinates:l,getCurrentPosition:u}=Q();let i=null;A(()=>k(this,null,function*(){yield h(),f(),yield M()})),G(()=>{s.value&&s.value.remove()}),U(()=>n.documents,()=>{y()},{deep:!0});const h=()=>k(this,null,function*(){if(typeof window!="undefined"){if(window.L){i=window.L;return}if(!document.querySelector('link[href*="leaflet.css"]')){const a=document.createElement("link");a.rel="stylesheet",a.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(a)}return new Promise((a,p)=>{if(window.L){i=window.L,a(!0);return}const b=document.createElement("script");b.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",b.onload=()=>{i=window.L,a(!0)},b.onerror=p,document.head.appendChild(b)})}}),f=()=>{!i||!c.value||(s.value=i.map(c.value,{zoomControl:!1}).setView(n.center,n.zoom),i.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors",maxZoom:19}).addTo(s.value),i.control.zoom({position:"bottomright"}).addTo(s.value),m.value=!1,y())},y=()=>{if(!(!i||!s.value)&&(r.value.forEach(a=>a.remove()),r.value=[],n.documents.forEach(a=>{var P,V;if(!((P=a.location_metadata)!=null&&P.lat)||!((V=a.location_metadata)!=null&&V.lng))return;const{lat:p,lng:b}=a.location_metadata,H=`
      <div style="
        background-color: ${a.status==="lost"?"#DC3545":"#28A745"};
        width: 30px;
        height: 30px;
        border-radius: 50%;
        border: 3px solid white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        display: flex;
        align-items: center;
        justify-center;
        color: white;
        font-size: 14px;
      ">
        <i class="fas ${a.status==="lost"?"fa-search":"fa-check"}"></i>
      </div>
    `,j=i.divIcon({html:H,className:"custom-marker",iconSize:[30,30],iconAnchor:[15,15]}),F=i.marker([p,b],{icon:j}).addTo(s.value).bindPopup(`
        <div class="p-2">
          <h4 class="font-semibold mb-1">${a.title}</h4>
          <p class="text-sm text-gray-600">${a.description||"Sem descrição"}</p>
          <p class="text-xs text-gray-500 mt-1">${a.location||"Localização não especificada"}</p>
        </div>
      `).on("click",()=>e("markerClick",a));r.value.push(F)}),r.value.length>0)){const a=i.featureGroup(r.value);s.value.fitBounds(a.getBounds().pad(.1))}},M=()=>k(this,null,function*(){const a=yield u();if(a&&i&&s.value){const b=i.divIcon({html:`
      <div style="
        background-color: #007BFF;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        border: 3px solid white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      "></div>
    `,className:"user-marker",iconSize:[20,20],iconAnchor:[10,10]});t.value&&t.value.remove(),t.value=i.marker([a.latitude,a.longitude],{icon:b}).addTo(s.value).bindPopup("Você está aqui")}}),N=()=>{l.value&&s.value&&s.value.setView([l.value.latitude,l.value.longitude],15)},I=()=>{console.log("Toggle map type")};return(a,p)=>(w(),C("div",X,[o("div",{ref_key:"mapContainer",ref:c,class:"w-full h-full rounded-lg overflow-hidden"},null,512),m.value?(w(),C("div",ee,[...p[0]||(p[0]=[o("div",{class:"text-center"},[o("div",{class:"spinner mb-2"}),o("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Carregando mapa...")],-1)])])):z("",!0),o("div",te,[o("button",{class:"btn-icon bg-white dark:bg-dark-card shadow-lg",onClick:N,disabled:!E(l)},[...p[1]||(p[1]=[o("i",{class:"fas fa-crosshairs"},null,-1)])],8,ae),o("button",{class:"btn-icon bg-white dark:bg-dark-card shadow-lg",onClick:I},[...p[2]||(p[2]=[o("i",{class:"fas fa-layer-group"},null,-1)])])]),p[3]||(p[3]=O('<div class="absolute bottom-4 left-4 bg-white dark:bg-dark-card rounded-lg shadow-lg p-3"><div class="space-y-2 text-sm"><div class="flex items-center space-x-2"><div class="w-3 h-3 rounded-full" style="background-color:#DC3545;"></div><span>Perdidos</span></div><div class="flex items-center space-x-2"><div class="w-3 h-3 rounded-full" style="background-color:#28A745;"></div><span>Encontrados</span></div></div></div>',1))]))}}),se={class:"h-[calc(100vh-8rem)]"},le={key:0,class:"aspect-video bg-gray-200 dark:bg-dark-card rounded-lg overflow-hidden mb-4"},re=["src","alt"],ne={class:"space-y-3"},ie={class:"flex items-center space-x-2"},ce={class:"badge badge-primary"},ue={key:0,class:"text-sm text-gray-600 dark:text-gray-400"},de={class:"space-y-2 text-sm"},fe={class:"flex items-start"},me={class:"flex items-start"},pe={class:"flex space-x-2 mt-4 pt-4 border-t border-gray-200 dark:border-dark-border"},Ce=T({__name:"MapView",setup(v){const d=R(),n=Y(),e=g(null),c=g(!1),m=x(()=>n.documents),s=x(()=>e.value?{lost:"badge badge-danger",found:"badge badge-success",matched:"badge bg-purple-500/10 text-purple-500",returned:"badge badge-success"}[e.value.status]||"badge badge-primary":""),r=x(()=>e.value?{lost:"Perdido",found:"Encontrado",matched:"Match",returned:"Devolvido",normal:"Normal"}[e.value.status]||e.value.status:""),t=x(()=>e.value?{passport:"fas fa-passport",id_card:"fas fa-id-card",driver_license:"fas fa-id-card-alt",birth_certificate:"fas fa-file-alt",other:"fas fa-file"}[e.value.type]||"fas fa-file":""),l=x(()=>e.value?{passport:"Passaporte",id_card:"BI",driver_license:"Carta",birth_certificate:"Certidão",other:"Outro"}[e.value.type]||"Documento":""),u=h=>{e.value=h,c.value=!0},i=()=>{e.value&&d.push(`/document/${e.value.id}`)};return A(()=>k(this,null,function*(){m.value.length===0&&(yield n.fetchDocuments())})),(h,f)=>(w(),W(Z,null,{default:$(()=>{var y;return[o("div",se,[L(oe,{documents:m.value,onMarkerClick:u},null,8,["documents"])]),L(J,{modelValue:c.value,"onUpdate:modelValue":f[1]||(f[1]=M=>c.value=M),title:(y=e.value)==null?void 0:y.title},{default:$(()=>[e.value?(w(),C(q,{key:0},[e.value.thumbnail_url||e.value.file_url?(w(),C("div",le,[o("img",{src:e.value.thumbnail_url||e.value.file_url,alt:e.value.title,class:"w-full h-full object-cover"},null,8,re)])):z("",!0),o("div",ne,[o("div",ie,[o("span",{class:B(s.value)},_(r.value),3),o("span",ce,[o("i",{class:B([t.value,"mr-1"])},null,2),D(" "+_(l.value),1)])]),e.value.description?(w(),C("p",ue,_(e.value.description),1)):z("",!0),o("div",de,[o("div",fe,[f[2]||(f[2]=o("i",{class:"fas fa-map-marker-alt text-gray-400 w-5 mt-0.5"},null,-1)),o("span",null,_(e.value.location||"Localização não especificada"),1)]),o("div",me,[f[3]||(f[3]=o("i",{class:"fas fa-clock text-gray-400 w-5 mt-0.5"},null,-1)),o("span",null,_(E(K)(e.value.created_at)),1)])])]),o("div",pe,[L(S,{variant:"primary",class:"flex-1",onClick:i},{default:$(()=>[...f[4]||(f[4]=[D(" Ver Detalhes ",-1)])]),_:1}),L(S,{variant:"outline",onClick:f[0]||(f[0]=M=>c.value=!1)},{default:$(()=>[...f[5]||(f[5]=[D(" Fechar ",-1)])]),_:1})])],64)):z("",!0)]),_:1},8,["modelValue","title"])]}),_:1}))}});export{Ce as default};
