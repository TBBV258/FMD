var y=(l,d,n)=>new Promise((c,m)=>{var v=t=>{try{e(n.next(t))}catch(s){m(s)}},g=t=>{try{e(n.throw(t))}catch(s){m(s)}},e=t=>t.done?c(t.value):Promise.resolve(t.value).then(v,g);e((n=n.apply(l,d)).next())});import{r as V,a as O,V as z,U as J,p as N,o as h,i as j,w as b,h as r,b as E,e as T,n as K,t as A,j as C,k as F,c as U,O as H,W as Q,T as X}from"./vue-vendor-D3gglZhg.js";import{b as _,u as Y,s as I,a as Z,_ as ee}from"./index-DVvGwCfe.js";import{B as ae}from"./BaseModal-CG4KKHeH.js";function te(){const l=V({granted:!1,denied:!1,prompt:!0}),d=V(!1),n=V(null);function c(){return y(this,null,function*(){try{if(!navigator.permissions)return l.value;const e=yield navigator.permissions.query({name:"camera"});return l.value={granted:e.state==="granted",denied:e.state==="denied",prompt:e.state==="prompt"},e.onchange=()=>{l.value={granted:e.state==="granted",denied:e.state==="denied",prompt:e.state==="prompt"}},l.value}catch(e){return console.error("Error checking camera permission:",e),l.value}})}function m(){return y(this,null,function*(){try{if(d.value=!0,n.value=null,/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&"mediaDevices"in navigator){const t=yield navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1});l.value.granted=!0,l.value.denied=!1,l.value.prompt=!1;const s=document.createElement("video");s.srcObject=t,s.play(),yield new Promise(f=>{s.onloadedmetadata=f});const i=document.createElement("canvas");i.width=s.videoWidth,i.height=s.videoHeight;const o=i.getContext("2d");return o==null||o.drawImage(s,0,0),t.getTracks().forEach(f=>f.stop()),new Promise(f=>{i.toBlob(p=>{if(p){const w=new File([p],`photo_${Date.now()}.jpg`,{type:"image/jpeg"});f(w)}},"image/jpeg",.9)})}else return yield v()}catch(e){return console.error("Camera capture error:",e),e.name==="NotAllowedError"?(n.value="Permissão da câmera negada",l.value.denied=!0,l.value.granted=!1):e.name==="NotFoundError"?n.value="Câmera não encontrada":n.value="Erro ao acessar a câmera",null}finally{d.value=!1}})}function v(){return y(this,null,function*(){return new Promise(e=>{const t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=s=>{var o;const i=(o=s.target.files)==null?void 0:o[0];e(i||null)},t.oncancel=()=>{e(null)},t.click()})})}function g(){const e=navigator.userAgent.toLowerCase();return e.includes("chrome")?"Chrome: Clique no ícone de câmera na barra de endereço e permita o acesso.":e.includes("firefox")?"Firefox: Clique no ícone de permissões ao lado do endereço e permita a câmera.":e.includes("safari")?"Safari: Vá em Configurações > Safari > Câmera e permita para este site.":"Permita o acesso à câmera nas configurações do seu navegador."}return{permissionState:l,isCapturing:d,error:n,checkPermission:c,capturePhoto:m,selectFromGallery:v,showPermissionHelp:g}}function re(n){return y(this,arguments,function*(l,d={}){const{maxWidth:c=1920,maxHeight:m=1920,quality:v=.8,mimeType:g="image/jpeg"}=d;return new Promise((e,t)=>{const s=new FileReader;s.onload=i=>{var f;const o=new Image;o.onload=()=>{let{width:p,height:w}=o;if(p>c||w>m){const k=Math.min(c/p,m/w);p*=k,w*=k}const P=document.createElement("canvas");P.width=p,P.height=w;const M=P.getContext("2d");if(!M){t(new Error("Failed to get canvas context"));return}M.drawImage(o,0,0,p,w),P.toBlob(k=>{if(!k){t(new Error("Failed to compress image"));return}const B=new File([k],l.name,{type:g,lastModified:Date.now()});e(B)},g,v)},o.onerror=()=>t(new Error("Failed to load image")),o.src=(f=i.target)==null?void 0:f.result},s.onerror=()=>t(new Error("Failed to read file")),s.readAsDataURL(l)})})}const se={class:"space-y-4"},oe={class:"flex justify-center"},le={class:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center"},ie={class:"text-center"},ne={class:"text-gray-600 dark:text-gray-400 mb-4"},de={class:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 text-left"},ue={class:"text-sm text-gray-600 dark:text-gray-400"},ce={key:0,class:"bg-danger/10 border border-danger/20 rounded-lg p-3"},me={class:"flex space-x-2"},fe=O({__name:"PermissionModal",props:z({type:{},denied:{type:Boolean,default:!1},helpText:{default:""}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:z(["allow"],["update:modelValue"]),setup(l,{emit:d}){const n=l,c=J(l,"modelValue"),m=d,v=n.type==="camera"?"Permissão de Câmera":"Permissão de Localização",g=n.type==="camera"?"fas fa-camera":"fas fa-map-marker-alt",e=n.type==="camera"?"Precisamos de acesso à câmera para tirar fotos dos documentos.":"Precisamos de acesso à sua localização para mostrar documentos próximos.",t=()=>{m("allow"),n.denied||(c.value=!1)};return(s,i)=>(h(),N(ae,{modelValue:c.value,"onUpdate:modelValue":i[1]||(i[1]=o=>c.value=o),title:j(v),maxWidth:"md"},{footer:b(()=>[r("div",me,[C(_,{variant:"outline",onClick:i[0]||(i[0]=o=>c.value=!1),class:"flex-1"},{default:b(()=>[...i[4]||(i[4]=[F(" Cancelar ",-1)])]),_:1}),C(_,{variant:"primary",onClick:t,class:"flex-1",disabled:l.denied},{default:b(()=>[F(A(l.denied?"Negado":"Permitir"),1)]),_:1},8,["disabled"])])]),default:b(()=>[r("div",se,[r("div",oe,[r("div",le,[r("i",{class:K([j(g),"text-3xl text-primary"])},null,2)])]),r("div",ie,[r("p",ne,A(j(e)),1),r("div",de,[i[2]||(i[2]=r("h4",{class:"font-medium text-sm text-gray-900 dark:text-dark-text mb-2"}," Como permitir: ",-1)),r("p",ue,A(l.helpText),1)])]),l.denied?(h(),E("div",ce,[...i[3]||(i[3]=[r("div",{class:"flex items-start space-x-2"},[r("i",{class:"fas fa-exclamation-triangle text-danger mt-0.5"}),r("div",{class:"flex-1 text-sm text-danger"},[r("p",{class:"font-medium"},"Permissão Negada"),r("p",{class:"mt-1"},"Você precisará permitir manualmente nas configurações do navegador.")])],-1)])])):T("",!0)])]),_:1},8,["modelValue","title"]))}}),pe={class:"relative inline-block"},ve=["src","alt"],ge={key:1,class:"text-3xl font-bold text-gray-600 dark:text-gray-400"},ye={key:0,class:"absolute inset-0 bg-white/90 dark:bg-dark-bg/90 rounded-full flex items-center justify-center"},we=O({__name:"ProfilePhotoUpload",setup(l){const d=Y(),{capturePhoto:n,selectFromGallery:c,permissionState:m,showPermissionHelp:v,checkPermission:g}=te(),{success:e,error:t}=Z(),s=V(!1),i=V(!1),o=V(!1),f=U(()=>{var u;return(u=d.profile)==null?void 0:u.avatar_url}),p=U(()=>{var u;return((u=d.profile)==null?void 0:u.full_name)||"User"}),w=U(()=>p.value.split(" ").map(u=>u[0]).slice(0,2).join("").toUpperCase()),P=U(()=>v()),M=()=>{s.value=!0},k=()=>y(this,null,function*(){if(s.value=!1,yield g(),m.value.denied){i.value=!0;return}if(m.value.prompt){i.value=!0;return}yield $(!0)}),B=()=>y(this,null,function*(){s.value=!1,yield $(!1)}),W=()=>y(this,null,function*(){yield $(!0)}),$=u=>y(this,null,function*(){var a;try{o.value=!0;const x=u?yield n():yield c();if(!x){o.value=!1;return}const R=yield re(x,{maxWidth:500,maxHeight:500,quality:.8}),D=`avatar_${(a=d.user)==null?void 0:a.id}_${Date.now()}.jpg`,{error:S}=yield I.storage.from("avatars").upload(D,R,{upsert:!0});if(S)throw S;const{data:L}=I.storage.from("avatars").getPublicUrl(D),q=yield d.updateProfile({avatar_url:L.publicUrl});if(q.success)e("Foto de perfil atualizada!");else throw new Error(q.error)}catch(x){console.error("Upload error:",x),t(x.message||"Erro ao fazer upload da foto")}finally{o.value=!1}}),G=()=>y(this,null,function*(){s.value=!1;try{o.value=!0;const u=yield d.updateProfile({avatar_url:""});if(u.success)e("Foto de perfil removida!");else throw new Error(u.error)}catch(u){t(u.message||"Erro ao remover foto")}finally{o.value=!1}});return(u,a)=>(h(),E("div",pe,[r("div",{class:"w-24 h-24 rounded-full overflow-hidden bg-gray-200 dark:bg-gray-700 flex items-center justify-center cursor-pointer group",onClick:M},[f.value?(h(),E("img",{key:0,src:f.value,alt:p.value,class:"w-full h-full object-cover"},null,8,ve)):(h(),E("span",ge,A(w.value),1)),a[4]||(a[4]=r("div",{class:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"},[r("i",{class:"fas fa-camera text-white text-2xl"})],-1))]),r("button",{class:"absolute bottom-0 right-0 w-8 h-8 bg-primary text-white rounded-full flex items-center justify-center shadow-lg hover:bg-primary-dark transition-colors",onClick:H(M,["stop"]),"aria-label":"Alterar foto"},[...a[5]||(a[5]=[r("i",{class:"fas fa-camera text-sm"},null,-1)])]),o.value?(h(),E("div",ye,[...a[6]||(a[6]=[r("div",{class:"spinner"},null,-1)])])):T("",!0),(h(),N(Q,{to:"body"},[C(X,{name:"fade"},{default:b(()=>[s.value?(h(),E("div",{key:0,class:"fixed inset-0 bg-black/50 z-50 flex items-end md:items-center justify-center p-4",onClick:a[2]||(a[2]=x=>s.value=!1)},[r("div",{class:"bg-white dark:bg-dark-card rounded-t-xl md:rounded-xl w-full max-w-sm p-4 space-y-2",onClick:a[1]||(a[1]=H(()=>{},["stop"]))},[a[11]||(a[11]=r("h3",{class:"font-bold text-lg mb-4 text-center"},"Alterar Foto de Perfil",-1)),C(_,{variant:"outline","full-width":"",onClick:k,disabled:o.value},{default:b(()=>[...a[7]||(a[7]=[r("i",{class:"fas fa-camera mr-2"},null,-1),F(" Tirar Foto ",-1)])]),_:1},8,["disabled"]),C(_,{variant:"outline","full-width":"",onClick:B,disabled:o.value},{default:b(()=>[...a[8]||(a[8]=[r("i",{class:"fas fa-images mr-2"},null,-1),F(" Escolher da Galeria ",-1)])]),_:1},8,["disabled"]),f.value?(h(),N(_,{key:0,variant:"outline","full-width":"",onClick:G,disabled:o.value,class:"text-danger"},{default:b(()=>[...a[9]||(a[9]=[r("i",{class:"fas fa-trash mr-2"},null,-1),F(" Remover Foto ",-1)])]),_:1},8,["disabled"])):T("",!0),C(_,{variant:"secondary","full-width":"",onClick:a[0]||(a[0]=x=>s.value=!1)},{default:b(()=>[...a[10]||(a[10]=[F(" Cancelar ",-1)])]),_:1})])])):T("",!0)]),_:1})])),C(fe,{modelValue:i.value,"onUpdate:modelValue":a[3]||(a[3]=x=>i.value=x),type:"camera",denied:j(m).denied,helpText:P.value,onAllow:W},null,8,["modelValue","denied","helpText"])]))}}),Ce=ee(we,[["__scopeId","data-v-c3b497dc"]]);export{Ce as P};
