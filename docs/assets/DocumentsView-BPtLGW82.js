var at=Object.defineProperty,ot=Object.defineProperties;var rt=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var lt=Object.prototype.hasOwnProperty,nt=Object.prototype.propertyIsEnumerable;var j=(r,o,s)=>o in r?at(r,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[o]=s,E=(r,o)=>{for(var s in o||(o={}))lt.call(o,s)&&j(r,s,o[s]);if(O)for(var s of O(o))nt.call(o,s)&&j(r,s,o[s]);return r},M=(r,o)=>ot(r,rt(o));var d=(r,o,s)=>new Promise((n,u)=>{var y=p=>{try{x(s.next(p))}catch(f){u(f)}},h=p=>{try{x(s.throw(p))}catch(f){u(f)}},x=p=>p.done?n(p.value):Promise.resolve(p.value).then(y,h);x((s=s.apply(r,o)).next())});import{a as it,r as w,c as D,l as dt,m as ct,p as P,w as S,o as i,h as a,j as C,b as c,k,t as m,s as $,n as U,F as I,i as T,u as ut,e as v,O as V}from"./vue-vendor-D3gglZhg.js";import{u as ft}from"./documents-C7yg1LXQ.js";import{u as pt,a as gt,b as N,T as mt}from"./index-DVvGwCfe.js";import{s as b}from"./supabase-BWysbwwl.js";import{_ as bt}from"./MainLayout.vue_vue_type_script_setup_true_lang-po6AB_6N.js";import{_ as yt}from"./LoadingSkeleton.vue_vue_type_script_setup_true_lang-7Vd9EgBJ.js";import{_ as xt}from"./EmptyState.vue_vue_type_script_setup_true_lang-BgLVv4ao.js";import"./supabase-BZLovRLP.js";import"./logofmd-DIbmBIad.js";const z={getAll(){return d(this,null,function*(){const{data:r,error:o}=yield b.from("documents").select("*").in("status",["lost","found"]).order("created_at",{ascending:!1});if(o)throw o;return r})},getById(r){return d(this,null,function*(){const{data:o,error:s}=yield b.from("documents").select("*").eq("id",r).single();if(s)throw s;return o})},getByUser(r){return d(this,null,function*(){const{data:o,error:s}=yield b.from("documents").select("*").eq("user_id",r).order("created_at",{ascending:!1});if(s)throw s;return o})},create(r){return d(this,null,function*(){const{data:o,error:s}=yield b.from("documents").insert([r]).select().single();if(s)throw s;return o})},update(r,o){return d(this,null,function*(){const{data:s,error:n}=yield b.from("documents").update(M(E({},o),{updated_at:new Date().toISOString()})).eq("id",r).select().single();if(n)throw n;return s})},delete(r){return d(this,null,function*(){const{error:o}=yield b.from("documents").delete().eq("id",r);if(o)throw o;return!0})},uploadFile(r,o){return d(this,null,function*(){const{data:s,error:n}=yield b.storage.from("documents").upload(o,r,{cacheControl:"3600",upsert:!1});if(n)throw n;const{data:{publicUrl:u}}=b.storage.from("documents").getPublicUrl(s.path);return u})},markAsLost(r,o=!1){return d(this,null,function*(){const s={status:"lost",updated_at:new Date().toISOString()};if(o){const u=(yield this.getById(r)).tags||[];u.includes("Submetido por Utilizador")||(s.tags=[...u,"Submetido por Utilizador"])}return this.update(r,s)})},toggleVisibility(r,o){return d(this,null,function*(){return this.update(r,{is_public:o,updated_at:new Date().toISOString()})})},updateTags(r,o){return d(this,null,function*(){return this.update(r,{tags:o,updated_at:new Date().toISOString()})})}},vt={class:"px-4 py-6"},ht={class:"flex items-center justify-between mb-6"},_t={class:"card mb-6"},kt={class:"grid grid-cols-3 gap-4"},wt={class:"text-center"},Dt={class:"text-2xl font-bold text-primary"},St={class:"text-center"},Ct={class:"text-2xl font-bold text-danger"},Ut={class:"text-center"},$t={class:"text-2xl font-bold",style:{color:"#FF8C00"}},It={class:"flex space-x-2 mb-4 overflow-x-auto"},Tt=["onClick"],zt={key:0,class:"space-y-4"},Bt={key:2,class:"space-y-3"},Lt={class:"flex items-start space-x-3"},At=["onClick"],Ot=["src","alt"],jt={key:1,class:"w-full h-full flex items-center justify-center"},Et=["onClick"],Mt={class:"flex items-start justify-between mb-1"},Pt={class:"font-semibold text-gray-900 dark:text-dark-text truncate"},Vt={class:"flex items-center space-x-2 ml-2"},Nt={key:0,class:"badge bg-orange-500/10 text-orange-600 dark:text-orange-400 text-xs"},Ft={key:1,class:"badge bg-gray-500/10 text-gray-600 dark:text-gray-400 text-xs"},Rt={key:0,class:"text-sm text-gray-600 dark:text-gray-400 line-clamp-1 mb-2"},qt={class:"flex items-center text-xs text-gray-500 space-x-3"},Jt={key:0},Gt={class:"relative"},Ht=["onClick"],Kt=["onClick"],Qt=["onClick"],Wt=["onClick"],ne=it({__name:"DocumentsView",setup(r){const o=ut(),s=ft(),n=pt(),{success:u,error:y}=gt(),h=w("all"),x=w(!1),p=w(!1),f=w(null),F=[{label:"Todos",value:"all"},{label:"Perdidos",value:"lost"},{label:"Submetido por Utilizador",value:"found"},{label:"Matches",value:"matched"},{label:"Devolvidos",value:"returned"}],B=D(()=>h.value==="all"?s.documents:s.documents.filter(l=>l.status===h.value)),R=D(()=>s.documents.length),q=D(()=>s.documents.filter(l=>l.status==="lost").length),J=D(()=>s.documents.filter(l=>l.status==="found").length),G=l=>{const e="px-4 py-2 rounded-full text-sm font-medium transition-colors whitespace-nowrap";return l===h.value?`${e} bg-primary text-white`:`${e} bg-gray-100 dark:bg-dark-card text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-800`},H=l=>{const e={lost:"badge badge-danger",found:"badge",matched:"badge bg-purple-500/10 text-purple-500",returned:"badge badge-success",normal:"badge badge-primary"};return l==="found"?"badge bg-orange-500/10 text-orange-600 dark:text-orange-400":e[l]||"badge badge-primary"},K=l=>({lost:"Perdido",found:"Submetido por Utilizador",matched:"Match",returned:"Devolvido",normal:"Normal"})[l]||l,Q=l=>({passport:"fas fa-passport",id_card:"fas fa-id-card",bi:"fas fa-id-card",driver_license:"fas fa-id-card",birth_certificate:"fas fa-file-alt",other:"fas fa-file"})[l]||"fas fa-file",W=l=>new Date(l).toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric"}),X=()=>d(this,null,function*(){var l,e;try{p.value=!0,n.userId&&(yield s.fetchUserDocuments(n.userId,!0));const t={user:{id:(l=n.user)==null?void 0:l.id,email:(e=n.user)==null?void 0:e.email,profile:n.profile},documents:s.documents,exportDate:new Date().toISOString(),version:"2.0.0"},g=JSON.stringify(t,null,2),st=new Blob([g],{type:"application/json"}),A=URL.createObjectURL(st),_=document.createElement("a");_.href=A,_.download=`findmydocs_backup_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(A),u("Backup baixado com sucesso!")}catch(t){console.error("Download backup error:",t),y("Erro ao baixar backup")}finally{p.value=!1}}),Y=l=>{f.value=f.value===l?null:l},Z=(l,e=!1)=>d(this,null,function*(){try{f.value=null,yield z.markAsLost(l,e),u("Documento marcado como perdido!"),n.userId&&(yield s.fetchUserDocuments(n.userId,!0))}catch(t){y(t.message||"Erro ao marcar documento como perdido")}}),tt=l=>d(this,null,function*(){try{f.value=null;const e=s.documents.find(g=>g.id===l);if(!e)return;const t=e.tags||[];t.includes("Submetido por Utilizador")||(yield z.updateTags(l,[...t,"Submetido por Utilizador"]),u("Tag adicionada com sucesso!"),n.userId&&(yield s.fetchUserDocuments(n.userId,!0)))}catch(e){y(e.message||"Erro ao adicionar tag")}}),et=(l,e)=>d(this,null,function*(){try{f.value=null,yield z.toggleVisibility(l,!e),u(`Documento ${e?"tornado privado":"tornado público"}!`),n.userId&&(yield s.fetchUserDocuments(n.userId,!0))}catch(t){y(t.message||"Erro ao alterar visibilidade")}}),L=l=>{f.value&&(f.value=null)};return dt(()=>d(this,null,function*(){if(!n.userId){y("Usuário não autenticado");return}x.value=!0,yield s.fetchUserDocuments(n.userId,!0),x.value=!1,document.addEventListener("click",L)})),ct(()=>{document.removeEventListener("click",L)}),(l,e)=>(i(),P(bt,null,{default:S(()=>[a("div",vt,[a("div",ht,[e[3]||(e[3]=a("h1",{class:"text-2xl font-bold text-gray-900 dark:text-dark-text"},"Meus Documentos",-1)),C(N,{variant:"outline",size:"sm",onClick:X,loading:p.value},{default:S(()=>[...e[2]||(e[2]=[a("i",{class:"fas fa-download mr-2"},null,-1),k(" Backup ",-1)])]),_:1},8,["loading"])]),a("div",_t,[a("div",kt,[a("div",wt,[a("p",Dt,m(R.value),1),e[4]||(e[4]=a("p",{class:"text-xs text-gray-500"},"Total",-1))]),a("div",St,[a("p",Ct,m(q.value),1),e[5]||(e[5]=a("p",{class:"text-xs text-gray-500"},"Perdidos",-1))]),a("div",Ut,[a("p",$t,m(J.value),1),e[6]||(e[6]=a("p",{class:"text-xs text-gray-500"},"Submetido por Utilizador",-1))])])]),a("div",It,[(i(),c(I,null,$(F,t=>a("button",{key:t.value,class:U(G(t.value)),onClick:g=>h.value=t.value},m(t.label),11,Tt)),64))]),x.value?(i(),c("div",zt,[(i(),c(I,null,$(3,t=>C(yt,{key:t,type:"card"})),64))])):B.value.length===0?(i(),P(xt,{key:1,icon:"fas fa-file-alt",title:"Nenhum documento encontrado",description:"Você ainda não cadastrou nenhum documento."},{default:S(()=>[C(N,{variant:"primary",onClick:e[0]||(e[0]=t=>T(o).push("/report-lost"))},{default:S(()=>[...e[7]||(e[7]=[a("i",{class:"fas fa-plus mr-2"},null,-1),k(" Adicionar Documento ",-1)])]),_:1})]),_:1})):(i(),c("div",Bt,[(i(!0),c(I,null,$(B.value,t=>(i(),c("div",{key:t.id,class:"card"},[a("div",Lt,[a("div",{class:"w-16 h-16 rounded-lg bg-gray-200 dark:bg-gray-700 flex-shrink-0 overflow-hidden cursor-pointer",onClick:g=>T(o).push(`/document/${t.id}`)},[t.thumbnail_url||t.file_url?(i(),c("img",{key:0,src:t.thumbnail_url||t.file_url,alt:t.title,class:"w-full h-full object-cover"},null,8,Ot)):(i(),c("div",jt,[a("i",{class:U([Q(t.type),"text-gray-400 text-2xl"])},null,2)]))],8,At),a("div",{class:"flex-1 min-w-0",onClick:g=>T(o).push(`/document/${t.id}`)},[a("div",Mt,[a("h3",Pt,m(t.title),1),a("div",Vt,[a("span",{class:U(H(t.status))},m(K(t.status)),3),t.tags&&t.tags.includes("Submetido por Utilizador")?(i(),c("span",Nt," Submetido por Utilizador ")):v("",!0),t.is_public?v("",!0):(i(),c("span",Ft,[...e[8]||(e[8]=[a("i",{class:"fas fa-lock mr-1"},null,-1),k("Privado ",-1)])]))])]),t.description?(i(),c("p",Rt,m(t.description),1)):v("",!0),a("div",qt,[a("span",null,[e[9]||(e[9]=a("i",{class:"fas fa-calendar mr-1"},null,-1)),k(" "+m(W(t.created_at)),1)]),t.location?(i(),c("span",Jt,[e[10]||(e[10]=a("i",{class:"fas fa-map-marker-alt mr-1"},null,-1)),k(" "+m(t.location),1)])):v("",!0)])],8,Et),a("div",Gt,[a("button",{class:"btn-icon",onClick:V(g=>Y(t.id),["stop"])},[...e[11]||(e[11]=[a("i",{class:"fas fa-ellipsis-v"},null,-1)])],8,Ht),f.value===t.id?(i(),c("div",{key:0,class:"absolute right-0 top-10 z-10 bg-white dark:bg-dark-card rounded-lg shadow-lg border border-gray-200 dark:border-dark-border min-w-[200px]",onClick:e[1]||(e[1]=V(()=>{},["stop"]))},[t.status!=="lost"?(i(),c("button",{key:0,class:"w-full text-left px-4 py-2 text-sm hover:bg-gray-50 dark:hover:bg-gray-800 flex items-center space-x-2",onClick:g=>Z(t.id,!0)},[...e[12]||(e[12]=[a("i",{class:"fas fa-exclamation-triangle text-danger w-4"},null,-1),a("span",null,"Marcar como Perdido",-1)])],8,Kt)):v("",!0),t.status==="lost"&&(!t.tags||!t.tags.includes("Submetido por Utilizador"))?(i(),c("button",{key:1,class:"w-full text-left px-4 py-2 text-sm hover:bg-gray-50 dark:hover:bg-gray-800 flex items-center space-x-2",onClick:g=>tt(t.id)},[...e[13]||(e[13]=[a("i",{class:"fas fa-tag text-orange-500 w-4"},null,-1),a("span",null,'Adicionar tag "Submetido por Utilizador"',-1)])],8,Qt)):v("",!0),a("button",{class:"w-full text-left px-4 py-2 text-sm hover:bg-gray-50 dark:hover:bg-gray-800 flex items-center space-x-2",onClick:g=>et(t.id,t.is_public)},[a("i",{class:U([t.is_public?"fas fa-eye-slash":"fas fa-eye","w-4"])},null,2),a("span",null,m(t.is_public?"Tornar Privado":"Tornar Público"),1)],8,Wt)])):v("",!0)])])]))),128))]))]),C(mt)]),_:1}))}});export{ne as default};
