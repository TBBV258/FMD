<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FindMyDocs - Gest√£o de Documentos Perdidos</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="css/enhanced-features.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link rel="stylesheet" href="css/document-uploader.css">
    <link rel="stylesheet" href="css/profile.css">
    <link rel="stylesheet" href="css/chat-box.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="checkAuth.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="js/chat-box.js"></script>
    <link rel="stylesheet" href="css/tailwind.css">
    <link rel="stylesheet" href="css/themes/dark.css" id="theme-dark" disabled>
    <link rel="stylesheet" href="css/themes/minimal.css" id="theme-minimal" disabled>
    <link rel="stylesheet" href="css/themes/colorful.css" id="theme-colorful" disabled>
    <script>
        // Logout handlers are initialized in script.js
        // This ensures handleLogout() is used consistently
    </script>
</head>
<body class="hide-chat-box">
    <!-- Theme Switcher -->
    <div id="theme-switcher"></div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Main Application -->
    <div id="app-section">
        <div class="container">
            <!-- Navigation -->
            <nav class="navbar">
                <div class="nav-brand">
                    <img class="app-logo-small" src="logofmd.jpg" alt="FindMyDocs Logo">
                    <span data-i18n="login.title">FindMyDocs</span>
                </div>
                <div class="nav-links">
                    <select id="language-selector" class="language-selector" aria-label="Selecionar idioma">
                        <option value="pt">üáµüáπ Portugu√™s</option>
                        <option value="en">üá¨üáß English</option>
                        <option value="fr">üá´üá∑ Fran√ßais</option>
                        <option value="zu">üáøüá¶ isiZulu</option>
                        <option value="ts">üá≤üáø Xitsonga</option>
                    </select>
                    <button class="nav-link active" data-section="documentos" aria-label="In√≠cio">
                        <i class="fas fa-home"></i>
                        <span data-i18n="nav.home">In√≠cio</span>
                    </button>
                    <button class="nav-link" data-section="feed" aria-label="Feed">
                        <i class="fas fa-list"></i>
                        <span data-i18n="nav.feed">Feed</span>
                    </button>
                    <!-- (Removed: Scanner, Chat Inteligente, Geofencing nav buttons) -->
                    <button class="nav-link" data-section="relatar-perda" aria-label="Relatar Perda">
                        <i class="fas fa-search"></i>
                        <span data-i18n="nav.report_lost">Relatar Perda</span>
                    </button>
                    <button class="nav-link" data-section="relatar-encontrado" aria-label="Relatar Encontrado">
                        <i class="fas fa-map-marker-alt"></i>
                        <span data-i18n="nav.report_found">Relatar Encontrado</span>
                    </button>
                    <button class="nav-link" data-section="notificacoes" aria-label="Notifica√ß√µes" id="notifications-btn">
                        <i class="fas fa-bell"></i>
                        <span data-i18n="nav.notifications">Notifica√ß√µes</span>
                        <span class="notification-badge" id="notification-count">0</span>
                    </button>
                    <button class="nav-link" data-section="perfil" aria-label="Perfil">
                        <i class="fas fa-user"></i>
                        <span data-i18n="nav.profile">Perfil</span>
                    </button>
                    <button class="nav-link logout-btn" id="nav-logout-btn" aria-label="Sair">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Sair</span>
                    </button>
                    <button id="theme-toggle" class="btn secondary small" aria-label="Alternar tema" data-i18n="[aria-label]nav.toggle_theme">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </nav>

            <style>
                /* Enhanced Feed Filters Styling */
                .feed-filters-container {
                    background: var(--card-bg, #fff);
                    border: 1px solid var(--border-color, #e0e0e0);
                    border-radius: 12px;
                    padding: 12px; /* compacted */
                    margin-bottom: 16px; /* reduced spacing to free space for feed */
                    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
                }
                
                .filters-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 12px;
                    padding-bottom: 8px;
                    border-bottom: 1px solid var(--border-color, #e0e0e0);
                }
                
                .filters-header h3 {
                    margin: 0;
                    color: var(--text-color, #333);
                    font-size: 1.1rem;
                    font-weight: 600;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                }
                
                .filters-header i {
                    color: var(--primary-color, #007bff);
                }
                
                .search-section {
                    margin-bottom: 12px;
                }
                
                .search-input-container {
                    position: relative;
                    display: flex;
                    align-items: center;
                }
                
                .search-icon {
                    position: absolute;
                    left: 12px;
                    color: var(--text-muted, #666);
                    z-index: 1;
                }
                
                .search-input {
                    width: 100%;
                    padding: 12px 48px 12px 40px;
                    border: 2px solid var(--border-color, #e0e0e0);
                    border-radius: 8px;
                    font-size: 1rem;
                    transition: border-color 0.2s ease;
                }
                
                .search-input:focus {
                    outline: none;
                    border-color: var(--primary-color, #007bff);
                    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
                }
                
                .search-button {
                    position: absolute;
                    right: 8px;
                    background: var(--primary-color, #007bff);
                    color: white;
                    border: none;
                    padding: 8px 12px;
                    border-radius: 6px;
                    cursor: pointer;
                    transition: background-color 0.2s ease;
                }
                
                .search-button:hover {
                    background: var(--primary-dark, #0056b3);
                }
                
                .filters-grid {
                    display: none; /* Hidden by default, shown after clicking search */
                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                    gap: 20px;
                    margin-top: 16px;
                    animation: slideDown 0.3s ease-out;
                }
                
                .filters-grid.show {
                    display: grid;
                }
                
                @keyframes slideDown {
                    from {
                        opacity: 0;
                        transform: translateY(-10px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
                
                .filter-group {
                    display: flex;
                    flex-direction: column;
                    gap: 8px;
                }
                
                .filter-group label {
                    font-weight: 500;
                    color: var(--text-color, #333);
                    font-size: 0.9rem;
                }
                
                .filter-select, .filter-input {
                    padding: 10px 12px;
                    border: 1px solid var(--border-color, #e0e0e0);
                    border-radius: 6px;
                    font-size: 0.95rem;
                    background: var(--input-bg, #fff);
                    transition: border-color 0.2s ease;
                }
                
                .filter-select:focus, .filter-input:focus {
                    outline: none;
                    border-color: var(--primary-color, #007bff);
                    box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.1);
                }
                
                .location-input-container {
                    position: relative;
                    display: flex;
                    align-items: center;
                }
                
                .location-icon {
                    position: absolute;
                    left: 12px;
                    color: var(--text-muted, #666);
                    z-index: 1;
                }
                
                .location-input-container .filter-input {
                    padding-left: 36px;
                }
                
                .feed-content-wrapper {
                    margin-top: 20px; /* slightly reduced to tighten layout */
                }
                
                .feed-content {
                    display: grid;
                    gap: 16px; /* compacted */
                }
                
                .feed-item {
                    background: var(--card-bg, #fff);
                    border: 1px solid var(--border-color, #e0e0e0);
                    border-radius: 12px;
                    padding: 16px; /* reduced padding for denser layout */
                    transition: all 0.18s ease;
                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
                }
                
                    .feed-item:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08);
                    border-color: var(--primary-color, #007bff);
                }

                /* Profile badges and subscription styling */
                .profile-badges {
                    display: flex;
                    gap: 8px;
                    align-items: center;
                }

                .plan-badge {
                    padding: 4px 8px;
                    border-radius: 12px;
                    font-weight: 600;
                    font-size: 0.85rem;
                    background: var(--badge-bg, #f1f5f9);
                    color: var(--text-color, #222);
                    border: 1px solid rgba(0,0,0,0.06);
                }

                .subscription-info .subscription-name {
                    display: inline-block;
                    padding: 4px 8px;
                    background: rgba(0,123,255,0.08);
                    color: var(--primary-color, #007bff);
                    border-radius: 999px;
                    font-weight: 600;
                    margin-left: 6px;
                    border: 1px solid rgba(0,123,255,0.12);
                }

                /* Chats list layout */
                .chats-toolbar {
                    display: flex;
                    justify-content: flex-end;
                    margin: 8px 0 12px 0;
                }
                .chats-search {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                }
                .chats-search input {
                    padding: 8px 10px;
                    border: 1px solid var(--border-color, #e0e0e0);
                    border-radius: 6px;
                    min-width: 240px;
                }
                .chats-list-header {
                    display: none; /* Hidden - using card layout instead */
                }
                .chats-container .chat-item {
                    display: grid;
                    grid-template-columns: 60px 1fr auto;
                    gap: 16px;
                    align-items: center;
                    padding: 16px;
                    margin-bottom: 8px;
                    background: var(--card-bg, #fff);
                    border: 1px solid var(--border-color, #e0e0e0);
                    border-radius: 12px;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
                }
                .chats-container .chat-item:hover {
                    background: var(--hover-bg, #f8f9fa);
                    transform: translateY(-2px);
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                    border-color: var(--primary-color, #007bff);
                }
                .chats-container .chat-item.has-unread {
                    background: var(--unread-bg, #f0f7ff);
                    border-color: var(--primary-color, #007bff);
                    border-width: 2px;
                }
                .chat-avatar-container {
                    position: relative;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                .chats-container .chat-avatar {
                    width: 48px;
                    height: 48px;
                    border-radius: 50%;
                    object-fit: cover;
                    border: 2px solid var(--border-color, #e0e0e0);
                }
                .chat-status-dot {
                    position: absolute;
                    bottom: 2px;
                    right: 2px;
                    width: 12px;
                    height: 12px;
                    background: var(--primary-color, #007bff);
                    border: 2px solid var(--card-bg, #fff);
                    border-radius: 50%;
                }
                .chats-container .chat-info {
                    display: flex;
                    flex-direction: column;
                    gap: 6px;
                    min-width: 0;
                }
                .chats-container .chat-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    gap: 8px;
                }
                .chats-container .chat-name {
                    margin: 0;
                    font-size: 1rem;
                    font-weight: 600;
                    color: var(--text-color, #333);
                    overflow: hidden;
                    text-overflow: ellipsis;
                    white-space: nowrap;
                }
                .chats-container .chat-item.has-unread .chat-name {
                    color: var(--primary-color, #007bff);
                    font-weight: 700;
                }
                .chats-container .chat-time {
                    color: var(--text-muted, #777);
                    font-size: 0.85rem;
                    white-space: nowrap;
                    flex-shrink: 0;
                }
                .chats-container .chat-details {
                    display: flex;
                    flex-direction: column;
                    gap: 4px;
                }
                .chats-container .chat-preview {
                    margin: 0;
                    color: var(--text-muted, #666);
                    font-size: 0.9rem;
                    overflow: hidden;
                    text-overflow: ellipsis;
                    white-space: nowrap;
                }
                .chats-container .chat-last-message {
                    margin: 0;
                    color: var(--text-color, #555);
                    font-size: 0.85rem;
                    overflow: hidden;
                    text-overflow: ellipsis;
                    white-space: nowrap;
                    font-style: italic;
                }
                .chats-container .chat-meta {
                    display: flex;
                    flex-direction: column;
                    align-items: flex-end;
                    gap: 4px;
                    flex-shrink: 0;
                }
                .chat-unread-badge {
                    background: var(--primary-color, #007bff);
                    color: #fff;
                    border-radius: 12px;
                    padding: 4px 8px;
                    font-size: 0.75rem;
                    font-weight: 600;
                    min-width: 24px;
                    text-align: center;
                }
                .chat-read-indicator {
                    color: var(--text-muted, #999);
                    font-size: 0.85rem;
                }

                /* Loading and empty states improvements */
                .loading-state {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    padding: 2rem;
                    color: var(--text-light, #666);
                }
                
                .loading-state i {
                    font-size: 2rem;
                    margin-bottom: 0.5rem;
                    animation: spin 1s linear infinite;
                }
                
                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
                
                .error-state {
                    text-align: center;
                    padding: 2rem;
                    color: var(--error-color, #dc3545);
                }
                
                .error-state i {
                    font-size: 2rem;
                    margin-bottom: 0.5rem;
                }
                
                .error-state button {
                    margin-top: 1rem;
                }
                
                .notification-action {
                    display: inline-block;
                    margin-top: 0.5rem;
                    color: var(--primary-color, #007bff);
                    text-decoration: none;
                    font-weight: 500;
                    font-size: 0.875rem;
                    transition: color 0.2s;
                }
                
                .notification-action:hover {
                    text-decoration: underline;
                    color: var(--primary-dark, #0056b3);
                }
                
                .notification-item.has-unread {
                    border-left: 4px solid var(--primary-color, #007bff);
                    background: var(--bg-light, #f8f9fa);
                    animation: slideIn 0.3s ease-out;
                }
                
                .notification-item {
                    transition: all 0.2s ease;
                }
                
                .notification-item:hover {
                    background: var(--hover-bg, #f0f0f0);
                    transform: translateX(4px);
                }
                
                @keyframes slideIn {
                    from {
                        opacity: 0;
                        transform: translateY(-10px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
                
                @media (max-width: 768px) {
                    .chats-container .chat-item {
                        grid-template-columns: 48px 1fr auto;
                        padding: 12px;
                        gap: 12px;
                    }
                    .chats-container .chat-time {
                        font-size: 0.75rem;
                    }
                    .chats-container .chat-last-message {
                        display: none;
                    }
                }
                
                /* Mobile Responsiveness */
                @media (max-width: 768px) {
                    .feed-filters-container {
                        padding: 16px;
                        margin-bottom: 24px;
                    }
                    
                    .filters-grid {
                        grid-template-columns: 1fr;
                        gap: 16px;
                    }
                    
                    .filters-header {
                        flex-direction: column;
                        align-items: flex-start;
                        gap: 12px;
                    }
                    
                    .search-input {
                        font-size: 16px; /* Prevent zoom on iOS */
                    }
                    
                    .feed-content {
                        gap: 16px;
                    }
                    
                    .feed-item {
                        padding: 16px;
                    }
                    
                    .profile-actions {
                        display: flex;
                        flex-direction: column;
                        gap: 10px;
                        margin-top: 15px;
                    }
                    
                    .profile-actions .btn {
                        width: 100%;
                        margin: 0;
                    }
                    
                    #profile-add-document {
                        order: -1; /* Move to top */
                        margin-bottom: 10px;
                    }
                }
                
                @media (max-width: 480px) {
                    .filters-grid {
                        grid-template-columns: 1fr;
                    }
                    
                    .search-input-container {
                        flex-direction: column;
                    }
                    
                    .search-button {
                        position: static;
                        width: 100%;
                        margin-top: 8px;
                    }
                }
            </style>

            <!-- Home/Documentos Section -->
            <section id="documentos" class="content-section active">
                <div class="section-header">
                    <h2 data-i18n="documents.title">Seus Documentos</h2>
                    <span id="document-count" class="document-count">0 total</span>
                </div>
                
                <div id="welcome-tips" class="welcome-section">
                    <div class="quick-actions">
                        <button class="btn primary" onclick="showSection('relatar-perda')">
                            <i class="fas fa-search-minus"></i> 
                            <span data-i18n="nav.report_lost">Reportar Documento Perdido</span>
                        </button>
                        <button class="btn success" onclick="showSection('relatar-encontrado')">
                            <i class="fas fa-search-plus"></i> 
                            <span data-i18n="nav.report_found">Reportar Documento Encontrado</span>
                        </button>
                    </div>
                    
                    <div class="mobile-upload-tip">
                        <i class="fas fa-exclamation-triangle"></i> 
                        <span data-i18n="tips.mobile_upload">Para enviar fotos pelo app, permita acesso √† c√¢mera e arquivos quando solicitado.</span>
                    </div>
                    
                        <h2 data-i18n="welcome.title" id="welcome-title">Bem-vindo!</h2>
                    
                    <div class="tip-card" style="padding:12px; margin-bottom:12px; border-radius:10px;">
                        <i class="fas fa-clock"></i>
                        <h4 data-i18n="tip.report_immediately.title">Reporte Imediatamente</h4>
                        <p data-i18n="tip.report_immediately.description">Reporte documentos perdidos ou encontrados o mais r√°pido poss√≠vel para aumentar as chances de recupera√ß√£o.</p>
                        <button class="tip-close" aria-label="Fechar dica">&times;</button>
                    </div>
                    
                    <div class="tip-card">
                        <i class="fas fa-camera"></i>
                        <h4 data-i18n="tip.photo_safety.title">Seguran√ßa de Fotos</h4>
                        <p data-i18n="tip.photo_safety.description">Ao enviar fotos de documentos, cubra ou desfoque qualquer informa√ß√£o pessoal.</p>
                        <button class="tip-close" aria-label="Fechar dica">&times;</button>
                    </div>
                    
                    <div class="tip-card">
                        <i class="fas fa-star"></i>
                        <h4 data-i18n="tip.earn_points.title">Ganhe Mais Pontos</h4>
                        <p data-i18n="tip.earn_points.description">Complete seu perfil, reporte documentos encontrados e ajude outros para ganhar mais pontos.</p>
                        <button class="tip-close" aria-label="Fechar dica">&times;</button>
                    </div>
                    
                    <button id="add-document" class="btn primary full-width" data-i18n="home.add_new_document">
                        <i class="fas fa-plus"></i>
                        Adicionar Novo Documento
                    </button>
                    
                </div>

                <div id="documents-grid" class="documents-grid">
                    <!-- Documents will be loaded here -->
                </div>
            </section>

            <!-- Feed Section -->
            <section id="feed" class="content-section">
                <div class="section-header">
                    <h2 data-i18n="nav.feed">Feed de Documentos</h2>
                </div>
                
                <!-- Enhanced Filters Section -->
                <div class="feed-filters-container">
                    <div class="filters-header">
                        <h3><i class="fas fa-filter"></i> <span data-i18n="filters.title">Filtros de Pesquisa</span></h3>
                        <button id="clear-filters" class="btn secondary small">
                            <i class="fas fa-times"></i> <span data-i18n="filters.clear">Limpar</span>
                        </button>
                    </div>
                    
                    <!-- Search Bar - Full Width -->
                    <div class="search-section">
                        <div class="search-field">
                            <label for="search-input" data-i18n="feed.search_placeholder">Pesquisar documentos</label>
                            <div class="search-input-container">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" id="search-input" class="search-input" data-i18n="[placeholder]feed.search_placeholder" placeholder="Pesquisar por t√≠tulo, n√∫mero ou descri√ß√£o...">
                                <button id="search-btn" class="search-button" type="button">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                            <div id="search-suggestions" class="search-suggestions" style="display: none;"></div>
                        </div>
                    </div>
                    
                    <!-- Filter Grid -->
                    <div class="filters-grid">
                        <div class="filter-group">
                            <label for="feed-filter-type" data-i18n="filters.type">Tipo de Documento</label>
                            <select id="feed-filter-type" class="filter-select">
                                <option value="" data-i18n="filters.all_types">Todos os tipos</option>
                                <option value="ID card" data-i18n="document_types.id_card">BI (Bilhete de Identidade)</option>
                                <option value="Passport" data-i18n="document_types.passport">Passaporte</option>
                                <option value="DIRE" data-i18n="document_types.dire">DIRE</option>
                                <option value="Driving License">Carta de Condu√ß√£o</option>
                                <option value="Bank Card">Cart√£o Banc√°rio</option>
                                <option value="Bank Doc">Documento Banc√°rio</option>
                                <option value="Student Card">Cart√£o de Estudante</option>
                                <option value="Voter Card">Cart√£o de Eleitor</option>
                                <option value="Birth Certificate">Certid√£o de Nascimento</option>
                                <option value="Marriage Certificate">Certid√£o de Casamento</option>
                                <option value="Death Certificate">Certid√£o de √ìbito</option>
                                <option value="NUIT">NUIT (N√∫mero √önico de Identifica√ß√£o Tribut√°ria)</option>
                                <option value="Work Card">Cart√£o de Trabalhador</option>
                                <option value="Health Card">Cart√£o de Sa√∫de</option>
                                <option value="Other">Outros</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="feed-filter-status" data-i18n="filters.status">Status</label>
                            <select id="feed-filter-status" class="filter-select">
                                <option value="" data-i18n="filters.all_status">Todos os status</option>
                                <option value="lost" data-i18n="filters.lost">Perdidos</option>
                                <option value="found" data-i18n="filters.found">Encontrados</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="feed-filter-location" data-i18n="filters.location">Localiza√ß√£o</label>
                            <div class="location-input-container">
                                <i class="fas fa-map-marker-alt location-icon"></i>
                                <input type="text" id="feed-filter-location" class="filter-input" data-i18n="[placeholder]filters.location" placeholder="Cidade ou regi√£o">
                        </div>
                        </div>
                        
                        <div class="filter-group">
                            <label for="feed-filter-distance" data-i18n="filters.distance">Dist√¢ncia</label>
                            <select id="feed-filter-distance" class="filter-select">
                                <option value="" data-i18n="filters.any_distance">Qualquer dist√¢ncia</option>
                                <option value="5" data-i18n="filters.distance_5">At√© 5 km</option>
                                <option value="10" data-i18n="filters.distance_10">At√© 10 km</option>
                                <option value="25" data-i18n="filters.distance_25">At√© 25 km</option>
                                <option value="50" data-i18n="filters.distance_50">At√© 50 km</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="feed-filter-document-number" data-i18n="documents.document_number">N√∫mero do Documento</label>
                            <input type="text" id="feed-filter-document-number" class="filter-input" data-i18n="[placeholder]documents.document_number" placeholder="N√∫mero do documento">
                        </div>
                    </div>
                </div>
                
                <!-- Feed Content with Better Spacing -->
                <div class="feed-content-wrapper">
                <div id="feed-content" class="feed-content">
                    <!-- Feed items will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Relatar Perda Section -->
            <section id="relatar-perda" class="content-section">
                <div class="section-header">
                    <h2 data-i18n="nav.report_lost">Relatar Documento Perdido</h2>
                </div>
                <form id="lost-form" class="document-form">
                    <div class="form-group">
                        <label for="lost-type" data-i18n="documents.type_label">Tipo de Documento</label>
                        <select id="lost-type" required>
                            <option value="">Selecione o tipo</option>
                            <option value="ID card">BI (Bilhete de Identidade)</option>
                            <option value="Passport">Passaporte</option>
                            <option value="DIRE">DIRE</option>
                            <option value="Driving License">Carta de Condu√ß√£o</option>
                            <option value="Bank Card">Cart√£o Banc√°rio</option>
                            <option value="Bank Doc">Documento Banc√°rio</option>
                            <option value="Student Card">Cart√£o de Estudante</option>
                            <option value="Voter Card">Cart√£o de Eleitor</option>
                            <option value="Birth Certificate">Certid√£o de Nascimento</option>
                            <option value="Marriage Certificate">Certid√£o de Casamento</option>
                            <option value="Death Certificate">Certid√£o de √ìbito</option>
                            <option value="NUIT">NUIT (N√∫mero √önico de Identifica√ß√£o Tribut√°ria)</option>
                            <option value="Work Card">Cart√£o de Trabalhador</option>
                            <option value="Health Card">Cart√£o de Sa√∫de</option>
                            <option value="Other">Outros</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="lost-document-number" data-i18n="documents.document_number">N√∫mero do Documento</label>
                        <input type="text" id="lost-document-number" required 
                               placeholder="Digite o n√∫mero do documento"
                               pattern="[A-Za-z0-9]+" 
                               title="Apenas letras e n√∫meros s√£o permitidos">
                        <small class="form-hint">Este n√∫mero ser√° usado para encontrar correspond√™ncias</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="lost-title" data-i18n="documents.title_label">Nome/T√≠tulo do Documento</label>
                        <input type="text" id="lost-title" required placeholder="Ex: BI de Jo√£o Silva">
                    </div>
                    
                    <div class="form-group">
                        <label for="lost-location" data-i18n="lost.where_lost">Onde foi perdido?</label>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <input type="text" id="lost-location" required placeholder="Localiza√ß√£o onde o documento foi perdido" style="flex:1">
                        <button type="button" class="btn secondary small" id="pick-lost-location" title="Selecionar no mapa em tela cheia"><i class="fas fa-map-marker-alt"></i></button>
                        <button type="button" class="btn secondary small" id="lost-use-current" title="Usar minha localiza√ß√£o"><i class="fas fa-location-arrow"></i></button>
                    </div>
                    <input type="hidden" id="lost-lat">
                    <input type="hidden" id="lost-lng">
                    <div id="lost-map" style="width:100%; height: 220px; margin-top:8px; border-radius:8px;"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="lost-description" data-i18n="documents.description_optional">Descri√ß√£o adicional</label>
                        <textarea id="lost-description" placeholder="Descreva detalhes que possam ajudar na identifica√ß√£o"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="lost-contact" data-i18n="documents.phone_number">Informa√ß√µes de contato</label>
                        <input type="tel" id="lost-contact" required placeholder="+258 XX XXX XXXX">
                    </div>
                    
                    <button type="submit" class="btn primary">
                        <i class="fas fa-exclamation-triangle"></i>
                        Reportar como Perdido
                    </button>
                </form>
            </section>

            <!-- Relatar Encontrado Section -->
            <section id="relatar-encontrado" class="content-section">
                <div class="section-header">
                    <h2 data-i18n="nav.report_found">Relatar Documento Encontrado</h2>
                </div>
                <form id="found-form" class="document-form">
                    <div class="form-group">
                        <label for="found-type" data-i18n="documents.type_label">Tipo de Documento</label>
                        <select id="found-type" required>
                            <option value="">Selecione o tipo</option>
                            <option value="ID card">BI (Bilhete de Identidade)</option>
                            <option value="Passport">Passaporte</option>
                            <option value="DIRE">DIRE</option>
                            <option value="Driving License">Carta de Condu√ß√£o</option>
                            <option value="Bank Card">Cart√£o Banc√°rio</option>
                            <option value="Bank Doc">Documento Banc√°rio</option>
                            <option value="Student Card">Cart√£o de Estudante</option>
                            <option value="Voter Card">Cart√£o de Eleitor</option>
                            <option value="Birth Certificate">Certid√£o de Nascimento</option>
                            <option value="Marriage Certificate">Certid√£o de Casamento</option>
                            <option value="Death Certificate">Certid√£o de √ìbito</option>
                            <option value="NUIT">NUIT (N√∫mero √önico de Identifica√ß√£o Tribut√°ria)</option>
                            <option value="Work Card">Cart√£o de Trabalhador</option>
                            <option value="Health Card">Cart√£o de Sa√∫de</option>
                            <option value="Other">Outros</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="found-document-number" data-i18n="documents.document_number">N√∫mero do Documento</label>
                        <input type="text" id="found-document-number" required 
                               placeholder="Digite o n√∫mero do documento encontrado"
                               pattern="[A-Za-z0-9]+" 
                               title="Apenas letras e n√∫meros s√£o permitidos">
                        <small class="form-hint">Este n√∫mero ser√° usado para encontrar o dono</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="found-title" data-i18n="documents.title_label">Nome/T√≠tulo do Documento</label>
                        <input type="text" id="found-title" required placeholder="Ex: BI encontrado">
                    </div>
                    
                    <div class="form-group">
                        <label for="found-location" data-i18n="found.where_found">Onde foi encontrado?</label>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <input type="text" id="found-location" required placeholder="Localiza√ß√£o onde encontrou o documento" style="flex:1">
                        <button type="button" class="btn secondary small" id="pick-found-location" title="Selecionar no mapa em tela cheia"><i class="fas fa-map-marker-alt"></i></button>
                        <button type="button" class="btn secondary small" id="found-use-current" title="Usar minha localiza√ß√£o"><i class="fas fa-location-arrow"></i></button>
                    </div>
                    <input type="hidden" id="found-lat">
                    <input type="hidden" id="found-lng">
                    <div id="found-map" style="width:100%; height: 220px; margin-top:8px; border-radius:8px;"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="found-description" data-i18n="documents.description_optional">Descri√ß√£o do documento</label>
                        <textarea id="found-description" placeholder="Descreva o documento encontrado (sem revelar informa√ß√µes sens√≠veis)"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="found-contact" data-i18n="documents.phone_number">Suas informa√ß√µes de contato</label>
                        <input type="tel" id="found-contact" required placeholder="+258 XX XXX XXXX">
                    </div>
                    
                    <button type="submit" class="btn success">
                        <i class="fas fa-hand-holding"></i>
                        Reportar como Encontrado
                    </button>
                </form>
            </section>

            <!-- Profile Section Unificada -->
            <section id="perfil" class="content-section">
                <div id="profile-loading" class="loading-state" style="display: none;">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p data-i18n="profile.loading">Carregando perfil...</p>
                </div>
                
                <!-- Profile Header -->
                <div class="profile-header">
                    <div class="profile-user-info">
                        <div class="profile-avatar">
                            <img id="profile-avatar" src="data:image/svg+xml,%3csvg width='80' height='80' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='80' height='80' fill='%23ddd'/%3e%3ctext x='50%25' y='50%25' font-size='30' text-anchor='middle' alignment-baseline='middle'%3eüë§%3c/text%3e%3c/svg%3e" alt="Avatar do usu√°rio">
                            <button id="avatar-upload-btn" class="avatar-upload-btn" title="Alterar foto do perfil">
                                <i class="fas fa-camera"></i>
                            </button>
                        </div>
                        <div class="profile-details">
                            <h2 id="profile-name">Carregando...</h2>
                            <span id="profile-country-flag" class="country-flag"></span>
                            <p id="profile-email">Carregando...</p>
                            <div class="profile-badges">
                                <span id="profile-plan" class="plan-badge">free</span>
                                <span id="profile-rank" class="rank-badge">Novato</span>
                            </div>
                            <div id="profile-subscription" class="subscription-info" style="margin-top:6px; font-size:0.95rem; color:var(--text-muted);">
                                Plano atual: <span id="profile-subscription-name">free</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Control Panel -->
                <div class="profile-control-panel">
                    <div class="profile-stats">
                        <div class="stat-item">
                            <span class="stat-number" id="profile-doc-count">0</span>
                            <span class="stat-label" data-i18n="profile.stats.documents">Documentos</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="profile-points">250</span>
                            <span class="stat-label" data-i18n="profile.stats.points">Pontos</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="profile-helped">3</span>
                            <span class="stat-label" data-i18n="profile.stats.helped">Ajudou</span>
                        </div>
                    </div>
                </div>

                <!-- Profile actions moved below displayed user data -->
                <div class="profile-actions" style="margin-top:12px; display:flex; gap:8px;">
                    <button id="view-ranking-progress" class="btn secondary" title="Ver progresso de ranking" data-i18n="profile.ranking">
                        <i class="fas fa-trophy"></i>
                        Ranking
                    </button>
                    <button id="profile-add-document" class="btn primary" data-i18n="profile.add_document">
                        <i class="fas fa-plus"></i>
                        Adicionar Documento
                    </button>
                </div>

                <!-- Profile Documents List -->
                <div class="profile-documents-section">
                    <h3 data-i18n="profile.my_documents">Meus Documentos</h3>
                    <div id="profile-documents-grid" class="documents-grid">
                        <!-- Documents will be loaded here -->
                    </div>
                </div>

                <!-- Ranking Section (rendered when user clicks Ranking) -->
                <section id="ranking" class="content-section">
                    <div class="section-header">
                        <h2><i class="fas fa-trophy"></i> Ranking Gamificado</h2>
                        <button class="btn secondary small ranking-reload-btn" style="display: none;" title="Recarregar Ranking">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                    <div id="ranking-content" class="ranking-gamified-container">
                        <!-- Ranking content is populated by renderRankingSection() -->
                    </div>
                </section>

                <!-- Subscription Plans Section -->
                <div class="profile-section">
                    <h3>Planos de Subscri√ß√£o</h3>
                    <div class="plans-container">
                        <div class="plan-card">
                            <h4>Gr√°tis</h4>
                            <p class="price">0 MT<span>/m√™s</span></p>
                            <ul>
                                <li><i class="fas fa-check"></i> Upload apenas de B.I.</li>
                                <li><i class="fas fa-check"></i> Suporte b√°sico</li>
                                <li><i class="fas fa-check"></i> Com an√∫ncios</li>
                            </ul>
                            <div class="payment-options">
                                <button class="btn primary small" disabled>Plano Atual</button>
                            </div>
                        </div>
                        <div class="plan-card recommended">
                            <span class="recommended-badge">Recomendado</span>
                            <h4>Premium Mensal</h4>
                            <p class="price">10 MT<span>/m√™s</span></p>
                            <ul>
                                <li><i class="fas fa-check"></i> Upload de todos os documentos</li>
                                <li><i class="fas fa-check"></i> Suporte priorit√°rio</li>
                                <li><i class="fas fa-check"></i> Sem an√∫ncios</li>
                            </ul>
                            <div class="payment-options">
                                <button class="btn success small payment-btn" data-method="mpesa" data-plan="monthly"><i class="fas fa-mobile-alt"></i> Pagar com M-Pesa</button>
                                <button class="btn warning small payment-btn" data-method="emola" data-plan="monthly"><i class="fas fa-mobile-alt"></i> Pagar com e-Mola</button>
                            </div>
                        </div>
                        <div class="plan-card">
                            <h4>Premium Anual</h4>
                            <p class="price">96 MT<span>/ano</span></p>
                            <p class="discount-badge">Economize 20%</p>
                            <ul>
                                <li><i class="fas fa-check"></i> Todas as vantagens do Premium</li>
                                <li><i class="fas fa-check"></i> Economize 24 MT/ano</li>
                                <li><i class="fas fa-check"></i> Acesso antecipado a recursos</li>
                            </ul>
                            <div class="payment-options">
                                <button class="btn success small payment-btn" data-method="mpesa" data-plan="yearly"><i class="fas fa-mobile-alt"></i> Pagar com M-Pesa</button>
                                <button class="btn warning small payment-btn" data-method="emola" data-plan="yearly"><i class="fas fa-mobile-alt"></i> Pagar com e-Mola</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data Management Section -->
                <div class="profile-section">
                    <h3>Gerir Dados</h3>
                    <div class="data-management-card">
                        <p>Fa√ßa o download de todos os seus documentos enviados num √∫nico arquivo .zip.</p>
                        <button id="download-all-docs" class="btn primary">
                            <i class="fas fa-download"></i> Baixar Meus Documentos
                            <span id="download-spinner" class="loading-spinner" style="display: none; margin-left: 8px;">
                                <i class="fas fa-spinner fa-spin"></i>
                            </span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- AI Assistant Section -->
            <section id="assistente" class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-robot"></i> Assistente de Documentos</h2>
                    <p>Obtenha ajuda com seus documentos perdidos ou encontrados</p>
                </div>
                <div class="assistant-container">
                    <div class="assistant-frame">
                        <iframe 
                            src="https://www.yeschat.ai/i/gpts-9t55QZcBmNu-Sewing-Pattern-Master" 
                            width="100%" 
                            height="600" 
                            style="border: 1px solid #e0e0e0; border-radius: 8px;"
                            allowfullscreen>
                        </iframe>
                    </div>
                </div>
            </section>

            <!-- Notifications Section -->
            <section id="notificacoes" class="content-section">
                <div class="tabs">
                    <button class="tab-btn active" data-tab="notifications-tab" data-i18n="notifications.notifications">Notifica√ß√µes</button>
                    <button class="tab-btn" data-tab="chats-tab" data-i18n="notifications.chats">Conversas</button>
                </div>
                
                <div id="notifications-tab" class="tab-content active">
                    <div class="section-header">
                        <h2 data-i18n="notifications.title">Notifica√ß√µes</h2>
                        <button id="mark-all-read" class="btn secondary small" data-i18n="notifications.mark_all_read">Marcar todas como lidas</button>
                    </div>
                    <div id="notifications-container" class="notifications-container">
                        <div class="notifications-list" id="notifications-list">
                            <div class="empty-state">
                                <i class="fas fa-bell-slash"></i>
                                <p data-i18n="notifications.empty">Nenhuma notifica√ß√£o no momento</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="chats-tab" class="tab-content">
                    <div class="section-header">
                        <h2 data-i18n="notifications.chats">Conversas</h2>
                    </div>
                    <!-- Chats toolbar and headers -->
                    <div class="chats-toolbar" role="region" aria-label="Ferramentas de Conversas">
                        <div class="chats-search">
                            <i class="fas fa-search" aria-hidden="true"></i>
                            <input type="text" id="chat-search" placeholder="Pesquisar por pessoa ou documento" aria-label="Pesquisar conversas">
                            <button id="chat-refresh" class="btn secondary small" type="button" aria-label="Recarregar conversas"><i class="fas fa-rotate"></i></button>
                        </div>
                    </div>
                    <div class="chats-list-header" role="row">
                        <div class="col-user" role="columnheader">Utilizador</div>
                        <div class="col-title" role="columnheader">Documento/Assunto</div>
                        <div class="col-last" role="columnheader">√öltima Mensagem</div>
                        <div class="col-time" role="columnheader">Quando</div>
                    </div>
                    <div id="chats-container" class="chats-container" role="list">
                        <div class="empty-state">
                            <i class="fas fa-comments"></i>
                            <p data-i18n="notifications.no_chats">Nenhuma conversa recente</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- UI Examples Section -->
            <main class="p-4 space-y-8">
            <!-- Removed: Scanner, Geofencing & Chat Inteligente sections per request -->
            </main>
        </div>
    </div>

    <!-- Document Upload Modal -->
    <div id="upload-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="upload-modal-title">
        <div class="modal-content" style="max-width: 700px; max-height: 85vh; overflow: auto;" tabindex="-1">
            <div class="modal-header">
                <h3 id="upload-modal-title">Carregar Documento</h3>
                <button class="close-btn" id="close-upload-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="upload-form">
                    <!-- Title -->
                    <div class="form-group">
                        <label for="document-title" data-i18n="documents.title_label">T√≠tulo do Documento *</label>
                        <input type="text" id="document-title" class="form-control" required placeholder="Ex: BI de Jo√£o Silva">
                    </div>
                    <!-- Document Type Selection -->
                    <div class="form-group">
                        <label for="document-type" data-i18n="documents.type_label">Tipo de Documento *</label>
                        <select id="document-type" class="form-control" required>
                            <option value="">Selecione o tipo de documento</option>
                            <option value="ID card">B.I (Bilhete de Identidade)</option>
                            <option value="Passport">Passaporte</option>
                            <option value="DIRE">DIRE</option>
                            <option value="Driving License">Carta de Condu√ß√£o</option>
                            <option value="Bank Card">Cart√£o Banc√°rio</option>
                            <option value="Bank Doc">Documento Banc√°rio</option>
                            <option value="Student Card">Cart√£o de Estudante</option>
                            <option value="Voter Card">Cart√£o de Eleitor</option>
                            <option value="Birth Certificate">Certid√£o de Nascimento</option>
                            <option value="Marriage Certificate">Certid√£o de Casamento</option>
                            <option value="Death Certificate">Certid√£o de √ìbito</option>
                            <option value="NUIT">NUIT (N√∫mero √önico de Identifica√ß√£o Tribut√°ria)</option>
                            <option value="Work Card">Cart√£o de Trabalhador</option>
                            <option value="Health Card">Cart√£o de Sa√∫de</option>
                            <option value="Other">Outros</option>
                        </select>
                    </div>

                    <!-- Document Number -->
                    <div class="form-group">
                        <label for="document-number" data-i18n="documents.document_number">N√∫mero do Documento *</label>
                        <input type="text" id="document-number" class="form-control" required
                               placeholder="Ex: 1234567890A123" 
                               pattern="[A-Za-z0-9]+"
                               title="Apenas letras e n√∫meros s√£o permitidos">
                        <small class="form-text text-muted">N√∫mero de identifica√ß√£o principal do documento</small>
                    </div>

                    <!-- Document Details Row -->
                    <div class="form-row">
                        <!-- Issue Date -->
                        <div class="form-group col-md-6">
                        <label for="issue-date" data-i18n="documents.issue_date">Data de Emiss√£o</label>
                            <input type="date" id="issue-date" class="form-control">
                        </div>
                        
                        <!-- Expiry Date -->
                        <div class="form-group col-md-6">
                        <label for="expiry-date" data-i18n="documents.expiry_date">Data de Validade</label>
                            <input type="date" id="expiry-date" class="form-control">
                        </div>
                    </div>

                    <!-- Issue Location -->
                    <div class="form-group">
                        <label for="issue-location" data-i18n="documents.issue_place">Local de Emiss√£o *</label>
                        <input type="text" id="issue-location" class="form-control" required
                               placeholder="Ex: Maputo, Mo√ßambique">
                    </div>

                    <!-- Issuing Authority -->
                    <div class="form-group">
                        <label for="issuing-authority" data-i18n="documents.issuing_authority">Entidade Emissora</label>
                        <input type="text" id="issuing-authority" class="form-control" placeholder="Ex: Conservat√≥ria">
                    </div>

                    <!-- File Upload Section -->
                    <div class="form-group">
                        <label>Documento Digitalizado *</label>
                        <div id="drop-zone" class="file-dropzone">
                            <div class="drop-zone-message">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Arraste e solte o seu documento aqui</p>
                                <span class="muted">ou</span>
                                <button type="button" id="browse-btn" class="btn btn-secondary small">Procurar Arquivo</button>
                                <input type="file" id="file-input" style="display: none;" accept=".pdf,.jpg,.jpeg,.png" required>
                            </div>
                            <div id="file-preview" class="file-preview-container"></div>
                        </div>
                        <small class="form-text text-muted">Formatos aceites: PDF, JPG, PNG (m√°x. 10MB)</small>
                    </div>

                    <!-- Additional Notes -->
                    <div class="form-group">
                        <label for="document-notes" data-i18n="documents.description_optional">Descri√ß√£o (opcional)</label>
                        <textarea id="document-notes" class="form-control" rows="3" 
                                  placeholder="Informa√ß√µes adicionais sobre o documento"></textarea>
                    </div>

                    <div class="form-group form-check">
                        <input type="checkbox" class="form-check-input" id="document-public">
                        <label class="form-check-label" for="document-public">
                            Tornar este documento p√∫blico
                        </label>
                        <small class="form-text text-muted">Documentos p√∫blicos podem ser vistos por outros usu√°rios</small>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" id="cancel-upload" data-i18n="chat.cancel">Cancelar</button>
                        <button type="submit" class="btn btn-primary" id="submit-document" data-i18n="upload.submit">
                            <span id="upload-spinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                            Guardar Documento
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Chat Modal -->
    <div id="chat-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="chat-modal-title">
        <div class="modal-content" tabindex="-1">
            <div class="modal-header" style="display: flex; align-items: center; gap: 12px; padding: 12px 20px;">
                <div id="chat-user-avatar" class="chat-avatar" style="width: 40px; height: 40px; border-radius: 50%; overflow: hidden; flex-shrink: 0;">
                    <img src="data:image/svg+xml,%3csvg width='40' height='40' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='40' height='40' fill='%23ddd'/%3e%3ctext x='50%25' y='50%25' font-size='20' text-anchor='middle' alignment-baseline='middle'%3eüë§%3c/text%3e%3c/svg%3e" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover;">
                </div>
                <div style="flex-grow: 1;">
                    <h3 id="chat-modal-title" style="margin: 0; font-size: 1.1rem;">Chat</h3>
                    <div id="chat-user-status" style="font-size: 0.8rem; color: #666; display: flex; align-items: center; gap: 4px;">
                        <span class="status-dot" style="display: inline-block; width: 8px; height: 8px; border-radius: 50%; background-color: #ccc;"></span>
                        <span>Offline</span>
                    </div>
                </div>
                <div style="display:flex; align-items:center; gap:8px;">
                    <button id="chat-open-maps" class="btn secondary small" title="Abrir no Maps" type="button"><i class="fas fa-map"></i></button>
                    <button id="chat-share-location" class="btn secondary small" title="Partilhar minha localiza√ß√£o" type="button"><i class="fas fa-location-arrow"></i></button>
                    <button class="close" title="Fechar" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">&times;</button>
                </div>
            </div>
            <div id="chat-messages" class="chat-messages">
                <!-- Messages will be loaded here -->
            </div>
            <div class="chat-input">
                <input type="text" id="chat-input-field" placeholder="Digite sua mensagem...">
                <button id="send-message" class="btn primary">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

 

    <!-- App Initializer - Must be loaded first to fix click issues -->
    <script src="js/app-initializer.js"></script>
    <!-- Map helpers (depends on Leaflet) -->
    <script src="map.js"></script>
    
    <!-- Load Supabase library first -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <!-- Initialize our Supabase client and APIs -->
    <script src="supabaseClient.js"></script>
    
    <!-- Load auth manager -->
    <script src="auth.js"></script>
    
    <!-- Translations (must be before main script) -->
    <script src="translations.js"></script>

    <!-- Enhanced Features Scripts -->
    <style>
        /* Chat message styles with avatars */
        .chat-message {
            display: flex;
            margin-bottom: 16px;
            padding: 0 16px;
        }
        
        .chat-message.self {
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            overflow: hidden;
            flex-shrink: 0;
            margin-right: 12px;
            background-color: #f0f0f0;
        }
        
        .chat-message.self .message-avatar {
            margin-right: 0;
            margin-left: 12px;
        }
        
        .message-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .message-content {
            max-width: 70%;
        }
        
        .message-bubble {
            padding: 10px 14px;
            border-radius: 18px;
            background: #f0f0f0;
            color: #333;
            font-size: 0.95rem;
            line-height: 1.4;
            word-break: break-word;
        }
        
        .chat-message.self .message-bubble {
            background: #007bff;
            color: white;
            border-bottom-right-radius: 4px;
        }
        
        .chat-message:not(.self) .message-bubble {
            border-bottom-left-radius: 4px;
        }
        
        .message-info {
            font-size: 0.75rem;
            color: #888;
            margin-top: 4px;
            display: flex;
            align-items: center;
        }
        
        .chat-message.self .message-info {
            justify-content: flex-end;
        }
        
        .message-time {
            margin-left: 8px;
        }
        
        .chat-message.self .message-time {
            margin-left: 0;
            margin-right: 8px;
            order: -1;
        }
        
        /* Responsive adjustments */
        @media (max-width: 480px) {
            .message-content {
                max-width: 80%;
            }
            
            .message-avatar {
                width: 32px;
                height: 32px;
            }
        }
    </style>
    
    <script type="module" src="js/error-handler.js"></script>
    <script type="module" src="js/loading-manager.js"></script>
    <script type="module" src="js/app-state.js"></script>
    <script type="module" src="js/ui/bottom-nav.js"></script>
    <script type="module" src="js/camera-ocr.js"></script>
    <script type="module">
        // Import and expose document-matching functions globally
        import { checkFoundDocumentMatches, checkLostDocumentMatches, suggestMatch, findSimilarDocuments } from './js/document-matching.js';
        window.checkFoundDocumentMatches = checkFoundDocumentMatches;
        window.checkLostDocumentMatches = checkLostDocumentMatches;
        window.suggestMatch = suggestMatch;
        window.findSimilarDocuments = findSimilarDocuments;
    </script>
    <script type="module" src="js/dashboard.js"></script>
    <script type="module" src="js/biometric-auth.js"></script>
    <script type="module" src="js/document-timeline.js"></script>
    <script type="module" src="js/chat/chat-controller.js"></script>
    <script type="module" src="js/qr-code.js"></script>
    <script type="module" src="js/skins.js"></script>
    <script type="module" src="js/notifications.js"></script>
    <script type="module" src="js/pwa-offline.js"></script>
    <script type="module" src="js/ui/modals.js"></script>
    <script type="module" src="js/ui/skeleton.js"></script>
    <script type="module" src="js/ui/toasts.js"></script>
    <script type="module" src="js/ui/theme-switcher.js"></script>
    
    <!-- Integration script removed: functionality is provided by modules loaded above (e.g. js/app-state.js, js/chat/chat-controller.js). -->
    
    <!-- Main Application Script -->
    <!-- Legacy global chat module (provides window.chat) -->
    <script src="chat.js"></script>
    <script src="script.js"></script>
    <!-- ...existing code... -->
</body>
</html>
